var RD_UUID='';var CURRENT_WARD_LIST=[],CURRENT_STREET_LIST=[];shop.cart={conf:{nbReceiveOptions:2,BUY_TYPE:'v201404',meta:{size:[],color:[]},metaInfo:[],plane:{meta_id:4346,nbParent:0,nbChildren:0,nbBaby:0,parents:[],children:[],baby:[]},extra:{},user:{fullname:'',email:'',mobile_phone:'',type:'guest',address:'',street:'',ward:'',city:0,district:'',note:'',cod_at:'',district_id:0},customer:{},userInfo:1,userAddress:1,cart:null,tour:null,card:[50000,100000,200000,300000,500000],card_rate:9/10,shipping:{active:false,COD:false,fee:0,fee_f:'0 đ',note:'',check:false,code:'SHIP',codShipType:'',office:'',in_area:1,more_fee:20000},addbook:false,office:null,store:[],office_id:0,go_office_id:0,gold_only:false,no_cod:false,dis_cod:false,only_coo:false,province_active:{},disableWeek:{},disableDay:{},error_city:false,isAdminAddOrder:false,isAdminAddOrderGold:false,LockSale:0,PauseTime:0,TotalStore:0,Expired:0,Buyer:0,BuyerNeed:0,IsEnd:0,SelectedOffice:0,setTypeShow:'hover'},isValidName:function(name){return name.match(/^[a-z0-9 àáạảãâầấậẩẫăằắặẳẵèéẹẻẽêềếệểễìíịỉĩòóọỏõôồốộổỗơờớợởỡùúụủũưừứựửữỳýỵỷỹđÀÁẠẢÃÂẦẤẬẨẪĂẰẮẶẲẴÈÉẸẺẼÊỀẾỆỂỄÌÍỊỈĨÒÓỌỎÕÔỒỐỘỔỖƠỜỚỢỞỠÙÚỤỦŨƯỪỨỰỬỮỲÝỴỶỸĐ]{3,}$/i)?true:false;},calculateMoney:function(forForm){if(typeof forForm==='undefined'){forForm='';}
var sanpham=shop.cart.conf.cart.cart;var tongtienNum=0,tongtienText='0đ';var price=parseInt(sanpham.price);var vat=parseInt(sanpham.vat),oneVat=0;if(vat>0&&sanpham.vat_type==0){oneVat=vat*price/100;oneVat=oneVat%500==0?oneVat:((Math.floor(oneVat/500)+1)*500);}else if(shop.cart.conf.cart.cart.fee_ncc>0){oneVat=shop.cart.conf.cart.cart.fee_ncc;}
if(forForm=='vanphong'){var quantity=parseInt($('#soluongVer1404').val());shop.cart.conf.cart.numberOtp=quantity;tongtienNum=(price+oneVat)*quantity;tongtienText=shop.numberFormat(tongtienNum)+'đ';$('#tongtienVer1404').text(tongtienText);if(shop.cart.isSizeColorDeal()){shop.cart.conf.metaInfo[0].quantity=quantity;if(shop.cart.conf.meta.size.length==1){shop.cart.conf.meta.size[0].quantity=quantity;}
if(shop.cart.conf.meta.color.length==1){shop.cart.conf.meta.color[0].quantity=quantity;}}}else if(forForm=='xac-nhan'){var quantity=parseInt($('#soluongBuocCuoi').val());shop.cart.conf.cart.numberOtp=quantity;tongtienNum=(price+parseInt($('#shipBuocCuoi').val()))*quantity;tongtienText=shop.numberFormat(tongtienNum)+'đ';$('#tongtienBuocCuoi').text(tongtienText);if(shop.cart.isSizeColorDeal()){shop.cart.conf.metaInfo[0].quantity=quantity;if(shop.cart.conf.meta.size.length==1){shop.cart.conf.meta.size[0].quantity=quantity;}
if(shop.cart.conf.meta.color.length==1){shop.cart.conf.meta.color[0].quantity=quantity;}}
if(shop.cart.conf.cart.payment_id=='mcard'){var hasEnoughGold=(shop.cart.conf.customer.gold-tongtienNum)>=0;var textGoldAfterOrder=shop.numberFormat(shop.cart.conf.customer.gold-tongtienNum)+'đ';var html='';if(hasEnoughGold){$('#goldRechargeButton').hide();html=('<div class="bl_3_StepInfoConfirm_remaining">Số tiền còn lại sau khi thanh toán: <span>'+textGoldAfterOrder+'</span></div>');$('#goldInfo').html(html);}else{html=('<div class="bl_3_StepInfoConfirm_remaining" style="color:red">Bạn cần nạp thêm tiền vào ví để mua sản phẩm này</div>');$('#goldInfo').html(html);$('#goldRechargeButton').show();}}}},activeAdminAddItem:function(isActive,isActiveGold){shop.cart.conf.isAdminAddOrder=isActive;shop.cart.conf.isAdminAddOrderGold=isActiveGold;},setValueItemForCheck:function(pause_time,lock_sale,totalstore,expired,is_end){shop.cart.conf.LockSale=lock_sale;shop.cart.conf.PauseTime=pause_time;shop.cart.conf.TotalStore=totalstore;shop.cart.conf.Expired=expired;shop.cart.conf.IsEnd=is_end;},setTypeShow:function(Type){shop.cart.conf.setTypeShow=Type;},addItem:function(id,start,end,buyer,buyer_need,type,extra){if($('.show-alert-temp-active').size()>0&&$('#continue_buy').size()<1){showTipErr();}else{var msg='';if(shop.cart.conf.IsEnd){if(shop.cart.conf.Expired>TIME_NOW&&shop.cart.conf.PauseTime==0){if(shop.cart.conf.LockSale==0){msg='Rất tiếc! Sản phẩm chỉ còn bán tại Cửa Hàng MuaChung. Xin Quý khách vui lòng tới <div  style="display: inline-block" class="wrap-shop-address" ><a id="show-dialog-province">cửa hàng</a> <div id="showProvincecopy"></div></div> để chọn mua sản phẩm này.';}else{if(buyer>=buyer_need)
msg='Rất tiếc! Sản phầm đã được bán hết. Xin Quý khách vui lòng chọn sản phẩm khác.';else
msg='Rất tiếc! Đã quá thời hạn bán sản phẩm. Xin Quý khách vui lòng chọn sản phẩm khác.';}}else{if(shop.cart.conf.PauseTime>0){msg='Rất tiếc! Sản phẩm tạm thời hết hàng. Xin Quý khách vui lòng chọn sản phẩm khác.';}else{if(buyer>=buyer_need)
msg='Rất tiếc! Sản phầm đã được bán hết. Xin Quý khách vui lòng chọn sản phẩm khác.';else
msg='Rất tiếc! Đã quá thời hạn bán sản phẩm. Xin Quý khách vui lòng chọn sản phẩm khác.';}}}else{if(shop.cart.conf.PauseTime>0){msg='Rất tiếc! Sản phẩm tạm thời hết hàng. Xin Quý khách vui lòng chọn sản phẩm khác.';}}
if(start>TIME_NOW){var d=new Date(start*1000),hour=d.getHours(),min=d.getMinutes(),day=d.getDate(),month=d.getMonth()+1;msg='Rất tiếc! Chưa đến thời hạn bán sản phẩm. Sản phẩm sẽ được bán vào lúc <b style="font-size:16px">'+((hour>9?'':'0')+(hour>0?hour:0)+'h'+(min>9?'':'0')+(min>0?min:0)+' ngày '+(day>9?'':'0')+(day>0?day:0)+'/'+(month>9?'':'0')+(month>0?month:0)+'/'+d.getFullYear())+'</b>';}
if(msg!=''){shop.cTheme.systemAlert(msg);}else{if(shop.cLib.isMultiPrice(id,shop.cart)){shop.cart.showExtra(id,shop.cart.conf.extra[id]);}else{shop.cart.doAddItem(id,type);}}}},doAddItem:function(id,type,idx){var city=shop.cookie.get(shop.header.city.conf.city_cookie);if(city==''||city==0){shop.header.ads.conf.email=0;shop.header.city.start();return false;}
$('#tipWarningColor').hide();$('#tipWarningSize').hide();if($('div.v7_BD_BuyNow a').attr('data-sc-notready')=='1'){return;}
if($('div.v7_BD_BuyOffice a').attr('data-sc-notready')=='1'){return;}
if($('#planeTour').length>0){var metaId=parseInt($('#planeTour').val());if(isNaN(metaId)||metaId==0){alert('Quý khách chọn ngày đi sau đó bấm Đặt chỗ');return;}
shop.cart.conf.plane.meta_id=metaId;}
var nbQuantity=0;if($('#oneItemQuantityInput').length>0){nbQuantity=parseInt($('#oneItemQuantityInput').val());var vq_min=$('option:first',$('#oneItemQuantity')).val();var vq_max=$('option:last',$('#oneItemQuantity')).val();if(isNaN(nbQuantity)||nbQuantity<=0){alert('Size/màu này đã hết!');return;}else if(nbQuantity>vq_max||nbQuantity<vq_min){alert('Số lượng tối đa là '+vq_max+', tối thiểu là '+vq_min);return;}else{$('#oneItemQuantity').val(nbQuantity);}}
if($('#oneItemQuantity').length>0){nbQuantity=parseInt($('#oneItemQuantity').val());if(isNaN(nbQuantity)||nbQuantity<=0){alert('Size/màu này đã hết!');return;}}
shop.cart.cleanCookieAutoPopupOrder();shop.cart.conf.meta.size=[];shop.cart.conf.meta.color=[];shop.cart.conf.metaInfo=[];var metaColorId=0;var metaSizeId=0;var sizeColorText='';metaColorId=$('#metaColorId').val();metaSizeId=$('#metaSizeId').val();var metaSizeColorRequire=$('#metaSizeColorRequire').val();var metaSizeRequire=$('#metaSizeRequire').val();var metaColorRequire=$('#metaColorRequire').val();if(metaColorRequire||metaSizeRequire){if(metaSizeColorRequire){if($('#metaSizeColor-'+metaColorId+'-'+metaSizeId).length==0){$('#tipWarningColorText').html('Vui lòng chọn màu');if(1>2){if(metaColorId==0){$('#tipWarningColor').show();}else{$('#tipWarningSize').show();}}else{showTipErr();}
return;}}
if(metaSizeRequire&&(typeof metaSizeId=='undefined'||metaSizeId=='0')){if(1>2){$('#tipWarningSize').show();}else{showTipErr();}
return;}
if(metaColorRequire&&(typeof metaColorId=='undefined'||metaColorId=='0')){if(1>2){$('#tipWarningColorText').html('Vui lòng chọn màu');$('#tipWarningColor').show();}else{showTipErr();}
return;}
var quantity=$('#oneItemQuantity').val();quantity=parseInt(quantity);if(isNaN(quantity))quantity=0;if(quantity<1){alert('Vui lòng chọn số lượng');shop.cart.scrollToSelectSizeColor();return;}
if(metaSizeId>0){shop.cart.conf.meta.size.push({id:parseInt(metaSizeId),quantity:parseInt(quantity)});}
if(metaColorId>0){shop.cart.conf.meta.color.push({id:parseInt(metaColorId),quantity:parseInt(quantity)});}
if(metaSizeId>0||metaColorId>0){var sizeText=metaSizeId>0?$('#metaSizeId-'+metaSizeId).attr('title'):'';var colorText=metaColorId>0?$('#metaColorId-'+metaColorId).attr('title'):'';if(colorText!=''){sizeColorText='Màu: '+colorText;}
if(sizeText!=''){sizeColorText+=sizeColorText!=''?(' - Cỡ: '+sizeText):sizeText;}
shop.cart.conf.metaInfo.push({sizecolor:sizeColorText,quantity:quantity});}}
if(IS_CUSTOMER_LOGIN==0){shop.cookie.set('meta_size',JSON.stringify(shop.cart.conf.meta.size),86400,'/');shop.cookie.set('meta_color',JSON.stringify(shop.cart.conf.meta.color),86400,'/');}
shop.cLib.guest.restore(shop.cart);var dataPost={};if(shop.cart.isSizeColorDeal()){dataPost={id:id,number:1,extra:idx,meta:JSON.stringify(shop.cart.conf.meta)};}else{dataPost={id:id,number:1,extra:idx};}
shop.ajax_popup("act=cart&code=order",'POST',dataPost,function(json){if(json.err==0){shop.cart.conf.DisableCODProvinces=json.order.cart.stop_cod_province;shop.cart.conf.ChangeProvinces=json.order.cart.change_provinces;var office=json.order.cart.cod_office;shop.cart.conf.shipping.fee=parseInt(json.order.cart.fee_shipping);shop.cart.conf.shipping.fee_f=json.order.cart.fee_shipping_f;shop.cart.conf.shipping.note=json.order.cart.note;shop.cart.conf.shipping.office=office.split(',');shop.cart.conf.shipping.active=(shop.cart.conf.shipping.fee>=0)&&(shop.cart.conf.shipping.note!='');shop.cart.conf.gold_only=(json.order.cart.is_gold==1);shop.cart.conf.dis_cod=(json.order.cart.dis_cod==1);shop.cart.conf.no_cod=(json.order.cart.no_cod==1);shop.cart.conf.only_coo=(json.order.cart.only_coo==1);shop.cart.conf.cart=json.order;if(shop.cart.isSizeColorDeal()){shop.cart.conf.cart.numberOtp=shop.cart.getSizeColorQuantity();}else if($('#oneItemQuantity').length>0){shop.cart.conf.cart.numberOtp=parseInt($('#oneItemQuantity').val());if(IS_CUSTOMER_LOGIN==0){shop.cookie.set('item_quantity',shop.cart.conf.cart.numberOtp,86400,'/');}}else{shop.cart.conf.cart.numberOtp=1;if(IS_CUSTOMER_LOGIN==0){shop.cookie.set('item_quantity',1,86400,'/');}}
shop.cart.conf.office=json.office;shop.cart.conf.store=json.store;shop.cLib.guest.update(json.user,shop.cart);if(json.user.type=='customer'){shop.cart.conf.customer=json.user;shop.cart.conf.customer.gold=parseInt(shop.cart.conf.customer.gold);shop.cart.conf.card_rate=json.card_rate;}
if((type=='visa')||(type=='atmOnline')||(type=='cod')||(type=='coo')||(type=='mcard'&&shop.cLib.isGOLD(shop.cart))){shop.cart.conf.cart.payment_id=type;}
shop.cart.conf.user.note='';try{_cpabd.cpabd_param.s='1';_cpabd.cpabd_param.iid='70';_cpabd.cpabd_param.value='20';_cpabd.start();}catch(e){}
if(shop.cart.conf.isAdminAddOrder){shop.cart.conf.BUY_TYPE='v201404';}
if(shop.cart.conf.BUY_TYPE=='vanphong'){shop.cart.stepLenVanPhong(1);}else if(shop.cart.conf.BUY_TYPE=='v201404'){shop.cart.stepOneV201404();}else{alert('Cách thức đặt mua không được hỗ trợ!');}}else{switch(json.msg){case'lock_sale':shop.cTheme.systemAlert('Rất tiếc! Sản phẩm tạm thời chỉ bán tại văn phòng. Xin Quý khách vui lòng chọn sản phẩm khác.');break;case'pause':shop.cTheme.systemAlert('Rất tiếc! Sản phẩm tạm thời hết hàng. Xin Quý khách vui lòng chọn sản phẩm khác.');break;case'full':shop.cTheme.systemAlert('Rất tiếc! Sản phẩm đã được mua hết hoặc thời hạn bán sản phẩm không hợp lệ. Xin Quý khách vui lòng chọn sản phẩm khác.');break;case'miss':var miss='';if(shop.is_exists(json.miss.phone)){miss+=' <b>- Số điện thoại</b>';}
shop.cTheme.systemAlert('Rất tiếc! Quý khách chưa điền đủ thông tin cá nhân nên không thể tiếp tục mua hàng. Xin Quý khách vui lòng vào <a href="'+json.link_profile+'">sửa thông tin cá nhân</a> và bổ sung thêm: '+miss);break;case'size_full':case'color_full':case'sizecolor_full':case'sizecolor_not_enough':if(typeof json.detail!=='undefined'){alert(json.detail);}else{alert('Số lượng sản phẩm không đủ');}
break;case'invalid_sizecolor':alert('Sản phẩm không có cỡ màu tương ứng');break;case'invalid_max':alert('Quý khách chỉ được mua tối đa '+json.max+' sản phẩm');break;case'invalid_min':alert('Quý khách phải mua tối thiểu '+json.min+' sản phẩm');break;default:alert('Có lỗi xảy ra. Vui lòng thử lại sau!');break;}}});shop.cart.loadBookAdress();},loadBookAdress:function(){if(IS_CUSTOMER_LOGIN>0){shop.ajax_popup('act=cart&code=loadbook',"GET",{},function(j){if(j.err!=0){shop.cAddress.conf.currentAddress=shop.cart.conf.user;shop.cAddress.conf.currentAddress.phone=shop.cart.conf.user.mobile_phone;if(shop.cAddress.conf.currentAddress.city==0||shop.cAddress.conf.currentAddress.city=='0'){shop.cAddress.conf.currentAddress.city=shop.cookie.get(shop.header.city.conf.city_cookie);}}else{shop.cAddress.conf.book=j.data;if(Object.keys(shop.cAddress.conf.book).length>0){for(var first in shop.cAddress.conf.book)break;shop.cAddress.conf.currentAddress=shop.cAddress.conf.book[first];}else{shop.cAddress.conf.currentAddress=shop.cart.conf.user;shop.cAddress.conf.currentAddress.phone=shop.cart.conf.user.mobile_phone;if(shop.cAddress.conf.currentAddress.city==0||shop.cAddress.conf.currentAddress.city=='0'){shop.cAddress.conf.currentAddress.city=shop.cookie.get(shop.header.city.conf.city_cookie);}}}});}else{if(shop.cart.conf.user.email!=''){shop.cAddress.conf.currentAddress=shop.cart.conf.user;shop.cAddress.conf.currentAddress.phone=shop.cart.conf.user.mobile_phone;if(shop.cAddress.conf.currentAddress.city==0||shop.cAddress.conf.currentAddress.city=='0'){shop.cAddress.conf.currentAddress.city=shop.cookie.get(shop.header.city.conf.city_cookie);}}else{shop.cAddress.conf.currentAddress.city=shop.cookie.get(shop.header.city.conf.city_cookie);}}},showExtra:function(id,extra){shop.show_overlay_popup('cart-extra','Chọn mua',shop.cart.theme.extra('cart-extra','Chọn mua',extra,id),{background:{'background-color':'transparent'},border:{'background-color':'transparent','padding':'0px'},title:{'display':'none'},content:{'padding':'0px','width':'650px','font-size':'12px'}});},isFreeDeal:function(){return typeof shop.cart.conf.cart.cart.free_deal!='undefined'&&shop.cart.conf.cart.cart.free_deal==1;},isPlaneDeal:function(){return typeof shop.cart.conf.cart.cart.price_baby!='undefined'&&shop.cart.conf.cart.cart.price_baby>0;},isSizeColorDeal:function(){return shop.cart.conf.meta.size.length>0||shop.cart.conf.meta.color.length>0;},getSizeColorQuantity:function(){var t=0,i=0;var n=shop.cart.conf.metaInfo.length;for(i=0;i<n;i++){t+=shop.cart.conf.metaInfo[i].quantity;}
return t;},stepTwo:function(district_id,city_id){shop.district.hideWardForCity(shop.cart.conf.user.city);if(shop.cart.conf.user.address==''||shop.cart.conf.user.address==null||shop.cart.conf.user.address=='undefined'||shop.cart.conf.user.address==undefined||shop.cart.conf.user.street==''||shop.cart.conf.user.street==null||shop.cart.conf.user.street=='undefined'||shop.cart.conf.user.street==undefined)
{if(district>0){alert('Thông tin địa chỉ chưa chính xác! Quý khách vui lòng nhập lại');return;}}
if(shop.cart.conf.cart.payment_id=='coo'&&typeof $('div.currentBg').attr('id')!=='undefined'&&$('#cart_city').val()!=$('div.currentBg').attr('id')){alert('Vui lòng kiểm tra lại tỉnh thành lên văn phòng lấy hàng');return;}
if(district_id>0){if(shop.cart.conf.cart.payment_id=='coo'){var district=district_id;for(var i in shop.cart.conf.shipping.office){if(shop.cart.conf.shipping.office[i]==district){district=0;break;}}
if(district>0){alert('Quận/Huyện Quý khách đã chọn không hỗ trợ hình thức nhận hàng tại Văn Phòng');return;}}
var dealCity=shop.cLib.getCity(true,shop.cart.conf.cart.cart.province_id);if(shop.cart.conf.cart.payment_id=='cod'&&dealCity!=city_id){alert('Sản phẩm này không áp dụng thu tiền tận nơi tại địa chỉ của Quý khách.\nVui lòng chọn hình thức thanh toán khác.');return;}
if(!shop.is_exists(shop.district.listDistrictDropdown[district_id])){shop.district.loadDistrict(city_id,function(){shop.cart.conf.shipping.in_area=shop.district.listDistrictDropdown[district_id].in_area;shop.cart.stepTwo();});return;}else{shop.cart.conf.shipping.in_area=shop.district.listDistrictDropdown[district_id].in_area;}}
if(!shop.cart.conf.shipping.active&&shop.cart.conf.cart.payment_id=='cod'&&shop.cart.conf.shipping.in_area==0){alert("Quận/Huyện Quý khách đang ở không hỗ trợ hình thức giao phiếu tận nơi");return;}
var canBuyProduct=false;var reasonCannotBuyProduct='Không xác định!';var orderProvince=shop.cart.conf.user.city;if(shop.cart.conf.cart.cart.province_id>0){if(orderProvince!=shop.cart.conf.cart.cart.province_id){reasonCannotBuyProduct='Rất tiếc. Sản phẩm chỉ bán ở '+city_list[shop.cart.conf.cart.cart.province_id]['title'];}else{canBuyProduct=true;}}else if(shop.cart.conf.cart.cart.province_id==0){var enable_province=[];var enableProvinceNameList=[];var tmp_disable_province=shop.cart.conf.cart.cart.disable_province;var nbDisableProvince=0;for(var pop in tmp_disable_province){nbDisableProvince++;break;}
if(nbDisableProvince>0){for(var tmpKey in city_list){if(city_list[tmpKey]['status']==1){var id=city_list[tmpKey].id;var isDisableProvince=false;for(var pop in tmp_disable_province){if(tmp_disable_province[pop]==id){isDisableProvince=true;break;}}
if(!isDisableProvince){enable_province.push(id);enableProvinceNameList.push(city_list[id].title);}}}
for(tmpKey in enable_province){if(enable_province[tmpKey]==orderProvince){canBuyProduct=true;break;}}
if(!canBuyProduct){reasonCannotBuyProduct='Rất tiếc. Sản phẩm chỉ bán ở '+enableProvinceNameList.join(', ');}}else{canBuyProduct=true;}}else if(shop.cart.conf.cart.cart.province_id<0){reasonCannotBuyProduct='Có lỗi xảy ra';}
if(!canBuyProduct){shop.hide_overlay_popup('pop-CHON-HTTT-v201404');shop.cTheme.systemAlert(reasonCannotBuyProduct);return;}
var orderDistrict=shop.cart.conf.user.district_id;if(shop.cart.conf.cart.payment_id=='cod'){if(shop.district.listDistrictDropdown[orderDistrict].in_area!=1){var districtSupportCOD='';for(i in shop.district.listDistrictDropdown){if(shop.district.listDistrictDropdown[i].in_area==1){districtSupportCOD+=shop.district.listDistrictDropdown[i].title+', ';}}
if(districtSupportCOD.length>0){districtSupportCOD=districtSupportCOD.substr(0,districtSupportCOD.length-2);}
if(districtSupportCOD==''){reasonCannotBuyProduct='Tại tỉnh thành của quý khách, hiện chưa có quận/huyện nào MuaChung hỗ trợ thu tiền tận nơi';}else{reasonCannotBuyProduct='Quận/huyện quý khách vừa chọn không hỗ trợ thu tiền tận nơi. Vui lòng chọn '+districtSupportCOD;}
canBuyProduct=false;}}
if(!canBuyProduct){shop.hide_overlay_popup('pop-CHON-HTTT-v201404');shop.cTheme.systemAlert(reasonCannotBuyProduct);return;}
if(shop.cart.conf.cart.payment_id!='coo'){if(orderProvince==14){if(',395,397,399,'.indexOf(','+orderDistrict+',')==-1){reasonCannotBuyProduct='Tại Cần Thơ chỉ hỗ trợ các quận Ninh Kiều, Cái Răng, Bình Thủy';canBuyProduct=false;}}}
if(!canBuyProduct){shop.hide_overlay_popup('pop-CHON-HTTT-v201404');shop.cTheme.systemAlert(reasonCannotBuyProduct);return;}
if(shop.cart.conf.shipping.active){if(shop.district.listDistrictDropdown[orderDistrict].in_area!=1){districtSupportCOD='';for(i in shop.district.listDistrictDropdown){if(shop.district.listDistrictDropdown[i].in_area==1){districtSupportCOD+=shop.district.listDistrictDropdown[i].title+', ';}}
if(districtSupportCOD.length>0){districtSupportCOD=districtSupportCOD.substr(0,districtSupportCOD.length-2);}
if(districtSupportCOD==''){reasonCannotBuyProduct='Tại tỉnh thành của quý khách, hiện chưa có quận/huyện nào MuaChung hỗ trợ giao hàng';}else{reasonCannotBuyProduct='Quận/huyện quý khách vừa chọn không hỗ trợ giao hàng. Vui lòng chọn '+districtSupportCOD;}
canBuyProduct=false;}}
if(!canBuyProduct){shop.hide_overlay_popup('pop-CHON-HTTT-v201404');shop.cTheme.systemAlert(reasonCannotBuyProduct);return;}
var tpl=shop.cart.theme.stepTwo('cart-check-out-step2','Mua hàng');if(tpl!=''){shop.show_overlay_popup('cart-check-out-step2','Mua hàng',tpl,{background:{'background-color':'transparent'},border:{'background-color':'transparent','padding':'0px'},title:{'display':'none'},content:{'padding':'0px','width':'660px','font-size':'12px'},release:function(){if(shop.cart.isPlaneDeal()){jQuery('.jNice').jNice();}else if(shop.cart.isSizeColorDeal()){jQuery('.jNice').jNice();}else{jQuery('#formQuantity').jNice();}
if(shop.cart.conf.cart.payment_id!='coo'){jQuery('.radio_ship').click(function(){shop.cart.theme.newPrice(this.value,true)});}else{shop.JT_init();}
jQuery('.rightInfo').hover(function(){jQuery(this).addClass('rightInfoActive');},function(){jQuery(this).removeClass('rightInfoActive');}).click(function(){if(shop.cart.conf.cart.payment_id!='coo'){shop.cart.theme.newPrice(this.id,false)}else{jQuery('#office'+this.id).attr('checked','checked');}
if(!jQuery(this).hasClass('rightInfoClicked')){jQuery('.rightInfoClicked').removeClass('rightInfoClicked');jQuery(this).addClass('rightInfoClicked');}});}});}},stepThree:function(){var title='Thanh Toán';if(shop.cart.isFreeDeal()){title='Đăng Ký';}
shop.show_overlay_popup('cart-confirm',title,shop.cart.theme.stepThree('cart-confirm',title),{background:{'background-color':'transparent'},border:{'background-color':'transparent','padding':'0px'},title:{'display':'none'},content:{'padding':'0px','width':'815px','font-size':'12px'}});},stepFinish:function(){var title='Cám ơn Quý khách đã mua hàng';shop.show_overlay_popup('cart-step-finish',title,shop.cTheme.finish_v_new('cart-step-finish',title),{background:{'background-color':'transparent'},border:{'background-color':'transparent','padding':'0px'},title:{'display':'none'},content:{'padding':'0px','width':'520px','font-size':'12px'}});},processExtra:function(id,idx){if(shop.cLib.isMultiPrice(id,shop.cart)){shop.cart.doAddItem(id,'',idx);}},processStepOne:function(){var frm=document.cartRegisterForm,fname='',id='',tel='',email='',address='',city=0,district='',street='',ward='';var ward='';var isAdminAdd=shop.cart.conf.isAdminAddOrder;var widthError=550;if(shop.cart.conf.BUY_TYPE!=''){var widthError=415;}
if(shop.cart.conf.BUY_TYPE==''){var cod_at=$('#cartRegisterForm input[name="cart_cod_at"]:checked').val();if(typeof cod_at=='undefined'||cod_at==''){var msg='Chưa chọn loại địa chỉ';var browseCity=shop.cLib.getCity(true,0);if(browseCity==22){msg='Chưa chọn thời gian nhận';}
shop.error.set('#'+frm.cart_cod_at.name,msg,widthError,'.reg_cart_form');return;}else{shop.error.close('#'+frm.cart_cod_at.name,'.reg_cart_form');}}
if(frm.cart_fullname){fname=shop.util_trim(frm.cart_fullname.value);if(fname==''){shop.error.set('#'+frm.cart_fullname.id,'Chưa nhập họ tên',widthError,'.reg_cart_form');return;}else if(fname.length<3){shop.error.set('#'+frm.cart_fullname.id,'Họ tên tối thiểu là 3 kí tự',widthError,'.reg_cart_form');return;}
else if(fname.match(/[\.,',",>,<,=,&,?,!,~,%,+,{,},\[,\],|,`,(,),@,#,$,^,*,-,\/,\\,\,]/i)!=null){shop.error.set('#'+frm.cart_fullname.id,'Họ tên không chứa các kí tự đặc biệt',widthError,'.reg_cart_form');return;}
else{shop.error.close('#'+frm.cart_fullname.id,'.reg_cart_form');}}
if(frm.cart_tel){tel=shop.util_trim(frm.cart_tel.value);if(tel==''){shop.error.set('#'+frm.cart_tel.id,'Chưa nhập Số điện thoại',widthError,'.reg_cart_form');return;}
else if(!shop.is_phone(frm.cart_tel.value)){shop.error.set('#'+frm.cart_tel.id,'Số điện thoại di động không hợp lệ',widthError,'.reg_cart_form');return;}
else{shop.error.close('#'+frm.cart_tel.id,'.reg_cart_form');}}
if(frm.cart_email){email=shop.util_trim(frm.cart_email.value);if(email==''){textError='Chưa nhập địa chỉ email';if(shop.cart.conf.isAdminAddOrder||shop.cart.conf.isAdminAddOrderGold){textError='Nếu khách chưa có tài khoản. Lấy địa chỉ '+frm.cart_tel.value+'@muachung.vn để thay tạm';}
shop.error.set('#'+frm.cart_email.id,textError,widthError,'.reg_cart_form');return;}else if(!shop.is_email(email)){shop.error.set('#'+frm.cart_email.id,'Địa chỉ email không hợp lệ',widthError,'.reg_cart_form');return;}
else{shop.error.close('#'+frm.cart_email.id,'.reg_cart_form');}}
data_email=(shop.cart.conf.isAdminAddOrder)?frm.cart_email.value:'';if(shop.cart.conf.cart.cart.type==1&&(shop.cart.conf.cart.payment_id=='mcard'||shop.cart.conf.cart.payment_id=='visa')){}else{if(frm.cart_address){address=shop.util_trim(frm.cart_address.value);if(address==''||address==null||address=='undefined'||address==undefined){shop.error.set('#'+frm.cart_address.id,'Chưa nhập Địa chỉ',widthError,'.reg_cart_form');return;}else if(address.match(/[<>]/i)!=null){shop.error.set('#'+frm.cart_address.id,'Kí tự "<" & ">" không hợp lệ, vui lòng nhập lại',widthError,'.reg_cart_form');return;}else{shop.error.close('#'+frm.cart_address.id,'.reg_cart_form');}}
if(frm.cart_street){street=shop.util_trim(frm.cart_street.value);if(street==''||street==null||street=='undefined'||street==undefined){shop.error.set('#'+frm.cart_street.id,'Chưa nhập Đường/Phố',widthError,'.reg_cart_form');return;}else if(street.match(/[<>]/i)!=null){shop.error.set('#'+frm.cart_street.id,'Kí tự "<" & ">" không hợp lệ, vui lòng nhập lại',widthError,'.reg_cart_form');return;}else{shop.error.close('#'+frm.cart_street.id,'.reg_cart_form');}}
if(frm.cart_city){city=parseInt(frm.cart_city.value);if(city<=0){shop.error.set('#'+frm.cart_city.id,'Chưa chọn Tỉnh/Thành',widthError,'.reg_cart_form');return;}else{shop.error.close('#'+frm.cart_city.id,'.reg_cart_form');}}
if(frm.district){district=shop.util_trim(frm.district.value);if(district<=0){shop.error.set('#'+frm.district.id,'Chưa chọn Quận/Huyện',widthError,'.reg_cart_form');return;}else{shop.error.close('#'+frm.district.id,'.reg_cart_form');}}
if(frm.cart_newWard){ward=frm.cart_newWard.value;ward=ward.replace(/</g,'&gt;');ward=shop.util_trim(ward);if(ward==''&&!shop.district.isCityNotRequireWardInfo(frm.cart_city.value)){shop.error.set('#'+frm.cart_newWard.id,'Chưa nhập Xã/Phường',widthError,'.reg_cart_form');return;}else{shop.error.close('#'+frm.cart_newWard.id,'.reg_cart_form');}}
if((city=='22'&&shop.cart.conf.cart.payment_id!='coo'&&shop.cart.conf.cart.payment_id!='go2tour')||isAdminAdd){var stop=false;shop.show_loading();$.ajax({async:false,type:"POST",url:"ajax.php?act=customer&code=getStreetId",data:{street:street,district_id:frm.district.value,email:data_email,phone:tel},timeout:4000,cache:true,dataType:"json",success:function(obj){if(city=='22'){if(obj.err==0){if(obj.id==0)stop=true;}else{stop=true;}}
if(shop.cart.conf.isAdminAddOrderGold){shop.cart.conf.customer.gold=obj.customer.gold;}
if((shop.cart.conf.isAdminAddOrder)&&typeof(obj.customer.email)!='undefined'){email=obj.customer.email;frm.cart_email.value=obj.customer.email;}},error:function(){stop=true;}});shop.hide_loading();if(stop){shop.error.set('#'+frm.cart_street.id,'Mời quý khách nhập đúng tên Quận - đường phố để Muachung có thể giao hàng được tận nơi',widthError,'.reg_cart_form');return;}else{shop.error.close('#'+frm.cart_street.id,'.reg_cart_form');}}}
if(shop.cart.conf.cart.cart.type==1&&(shop.cart.conf.cart.payment_id=='mcard'||shop.cart.conf.cart.payment_id=='visa')){shop.cart.conf.user.email=email;shop.cart.conf.user.fullname=fname;shop.cart.conf.user.mobile_phone=tel;}else{shop.cart.conf.user.ward=ward;shop.cart.conf.user.email=email;shop.cart.conf.user.fullname=fname;shop.cart.conf.user.mobile_phone=tel;shop.cart.conf.user.address=address;shop.cart.conf.user.street=street;shop.cart.conf.user.city=city;shop.cart.conf.user.district_id=district;shop.cart.conf.user.district=frm.district.options[frm.district.selectedIndex].innerHTML;}
if(shop.cart.conf.BUY_TYPE==''){shop.cart.conf.user.cod_at=cod_at;}
shop.cAddress.conf.currentAddress=shop.cart.conf.user;shop.cAddress.conf.currentAddress.id=shop.util_trim(frm.cart_id.value);shop.cAddress.conf.currentAddress.phone=shop.cart.conf.user.mobile_phone;shop.cLib.guest.save(shop.cart.conf.user,shop.cart);if(shop.cart.conf.cart.cart.type==1&&(shop.cart.conf.cart.payment_id=='mcard'||shop.cart.conf.cart.payment_id=='visa')){}else{if(shop.is_exists(shop.district.listDistrictDropdown[district].in_area)){shop.cart.conf.shipping.in_area=shop.district.listDistrictDropdown[district].in_area;}}
if(shop.cart.conf.BUY_TYPE==''){shop.cart.stepTwo();}else if(shop.cart.conf.BUY_TYPE=='v201404'){if(shop.cart.conf.cart.payment_id=='cod'){var msg=shop.cart.checkStopBuyProduct();if(msg!=='ok'){alert(msg);return;}}
if(typeof shop.cart.conf.nhap_ttcn_referer==='undefined'||shop.cart.conf.nhap_ttcn_referer==''){shop.cart.stepTwoV201404();}else{shop.cart.conf.nhap_ttcn_referer='';shop.cart.stepThreeV201404();}}},processStepThree:function(step){if(shop.cart.conf.cart.payment_id=='visa'){if(shop.cart.conf.user.type=='guest'&&!shop.get_ele('check-regulations').checked){alert('Quý khách chưa tích vào mục đã đọc và đồng ý các điều khoản và quy định của MuaChung.vn');return;}}
var post,card=shop.cart.conf.cart.payment,note='',city=shop.cart.conf.user.city,district=shop.cart.conf.user.district,address=shop.cart.conf.user.address,street=shop.cart.conf.user.street,ward=shop.cart.conf.user.ward,g_note=shop.cart.conf.user.note,ship_fee=shop.cLib.getShipFee(shop.cart);if(shop.cart.conf.BUY_TYPE=='vanphong'){city=shop.cookie.get(shop.header.city.conf.city_cookie);district='';address='';}
if(shop.cart.conf.BUY_TYPE!='vanphong'&&shop.cart.conf.shipping.codShipType!='coupon'){if(city==0||district==''||address==''){alert('Vui lòng kiểm tra lại thông tin giao hàng.\nHiện tại đang thiếu thông tin: '+(address==''?' Địa chỉ.':'')+(district==''?' Quận/Huyện/Phường.':'')+(city<=0?' Tỉnh/Thành phố.':''));return;}}
if(shop.cart.conf.cart.payment_id=='cod'){note='Ch%E1%BB%8Dn+h%C3%ACnh+th%E1%BB%A9c+chuy%E1%BB%83n+';if(shop.cart.conf.shipping.codShipType!='coupon'){note+='s%E1%BA%A3n+ph%E1%BA%A9m';}else{note+='th%E1%BA%BB+c%C3%A0o';}}else if(shop.cart.conf.cart.payment_id=='coo'){var office=shop.cLib.getOffice(shop.cart.conf.office_id,shop.cart);g_note=office.name+' - ĐC: '+office.address+' - ĐT: '+office.tel;note='Ch%E1%BB%8Dn+h%C3%ACnh+th%E1%BB%A9c+chuy%E1%BB%83n+';}
var stepType=1,stepId=4;if(shop.cart.conf.cart.payment_id){stepType=2;stepId=1;}
shop.cart.logAdmicro('10');var passGold='';if(shop.cart.conf.cart.payment_id=='mcard'){if(!shop.cart.conf.isAdminAddOrder||(shop.cart.conf.isAdminAddOrder&&!shop.cart.conf.isAdminAddOrderGold)){passGold=$('#order_gold_passconfirm').val();if(typeof passGold=='undefined'||passGold==''){alert('Vui lòng nhập mật khẩu tài khoản của bạn');$('#order_gold_passconfirm').focus();return;}}}
var fullname=shop.cart.conf.user.fullname;var email=shop.cart.conf.user.email;if(IS_CUSTOMER_LOGIN==0&&shop.cart.conf.cart.payment_id=='coo'){fullname='';email='';}
if(g_note=='Nếu Quý khách có yêu cầu đặc biệt, vui lòng thêm thông tin để Muachung phục vụ tốt hơn'){g_note='';}
post={fullname:fullname,tel:shop.cart.conf.user.mobile_phone,email:email,item_id:shop.cart.conf.cart.cart.id,paymentType:card,adminNote:note,quantity:shop.cart.conf.cart.numberOtp,city:city,district:district,address:address,street:street,ward:ward,note:g_note,product_type:shop.cart.conf.cart.cart.type,item_type:shop.cart.conf.cart.cart.item_type,shipping:shop.cart.conf.shipping.check?ship_fee:-1,ship_active:(shop.cart.conf.shipping.active||shop.cart.conf.shipping.COD)?1:0,ship_code:shop.cart.conf.shipping.code,codShipType:shop.cart.conf.shipping.codShipType,office_id:shop.cart.conf.office_id,go_office_id:shop.cart.conf.go_office_id,plane:JSON.stringify(shop.cart.conf.plane),meta:JSON.stringify(shop.cart.conf.meta),cod_at:'office',passGold:passGold,isCSForCustomer:shop.cart.conf.isAdminAddOrder};if(shop.district.isCityNotRequireWardInfo(city)){post.ward='';}
shop.cart.finishSubmit(post,step);},finishSubmit:function(post,step){var urlSubmit='act=cart&code=finish';if(shop.cart.isPlaneDeal()){urlSubmit='act=cart&code=finishPlane';}else if(shop.cart.isSizeColorDeal()){urlSubmit='act=cart&code=finishSizeColor';}
shop.ajax_popup(urlSubmit,"POST",post,function(j){if(j.err==0){if(step!=undefined){if(step==1){shop.cart.logRD(shop.cart.conf.cart.cart.id,2,'hoàn thành đơn hàng',2);}else{shop.cart.logRD(shop.cart.conf.cart.cart.id,9,'hoàn thành đơn hàng đặt mua tại cửa hàng',1);}}else{shop.cart.logRD(shop.cart.conf.cart.cart.id,8,'hoàn thành đơn hàng',1);}
shop.cart.logAdmicro('15');if(j.soha_gold==1){post.paymentType=1;}
switch(post.paymentType){case 0:case 6:shop.cart.stepFinish();shop.redirect(j.url);break;case 1:if(shop.cart.isPlaneDeal()||shop.cart.isSizeColorDeal()){shop.cart.stepFinish();shop.redirect(j.url);}else{shop.cart.conf.cart=j;jQuery('body').append(shop.cart.theme.paymentViSa());jQuery('#checkoutSoHa').submit();}
break;case 2:if(shop.is_exists(j.more_gold)){shop.cart.conf.card_post=post;shop.cart.conf.customer.gold=j.gold;shop.cart.conf.customer.more_gold=j.more_gold;shop.cart.conf.cart.total=j.total;alert("Tài khoản ví của bạn không đủ Tiền để thực hiện đơn hàng này",'Thông báo lỗi',-1);}else{shop.cart.stepFinish();shop.redirect(j.url);}
break;}}else{switch(j.msg){case'pause':j.msg='Sản phẩm tạm thời hết hàng';shop.hide_overlay_popup('pop-XACNHAN-v201404');shop.cTheme.systemAlert(j.msg);break;case'invalid_quantity':j.msg='Sản phẩm đã bán hết';if(j.quantity>0){j.msg='Chỉ còn '+j.quantity+' sản phẩm';}
alert(j.msg)
break;case'invalid_info':j.msg='Thông tin không hợp lệ! Quý khách vui lòng kiểm tra lại các thông tin Họ tên, Email, Số điện thoại';alert(j.msg);break;case'invalid_min':j.msg='Quý khách phải mua tối thiểu '+shop.cart.conf.cart.cart.min_order+' sản phẩm';alert(j.msg);break;case'invalid_max':j.msg='Quý khách chỉ được mua tối đa '+shop.cart.conf.cart.cart.max_order+' sản phẩm';alert(j.msg);break;case'full_item_gold':j.msg='Quý khách chỉ được mua tối đa 5 sản phẩm trong chương trình giờ vàng giá sốc!';shop.hide_overlay_popup('pop-XACNHAN-v201404');shop.cTheme.systemAlert(j.msg);break;case'buy_item_gold':j.msg='Quý khách chỉ được mua sản phẩm này 1 lần trong chương trình giờ vàng giá sốc!';shop.hide_overlay_popup('pop-XACNHAN-v201404');shop.cTheme.systemAlert(j.msg);break;case'time_item_gold':var startdate=new Date(shop.cart.conf.cart.cart.startTime*1000),startday=startdate.getDate(),startmonth=startdate.getMonth()+1;var enddate=new Date(shop.cart.conf.cart.cart.endTime*1000),endday=enddate.getDate(),endmonth=enddate.getMonth()+1;j.msg='Chương trình giờ vàng giá sốc chỉ áp dụng từ 11h30 - 13h30 từ'+' ngày '+(startday>9?'':'0')+(startday>0?startday:0)+'/'+(startmonth>9?'':'0')+(startmonth>0?startmonth:0)+'/'+startdate.getFullYear()+' đến ngày '+(endday>9?'':'0')+(endday>0?endday:0)+'/'+(endmonth>9?'':'0')+(endmonth>0?endmonth:0)+'/'+enddate.getFullYear()+'!';shop.hide_overlay_popup('pop-XACNHAN-v201404');break;case'active_phone':case'active_email':shop.hide_overlay_popup('cart-confirm');if(shop.cart.conf.cart.payment_id=='cod'){var email=(j.msg=='active_email'?0:1),phone=(j.msg=='active_phone'?0:1);shop.cTheme.showActivePhoneWarning(email,phone,shop.cart);}else if(j.msg=='active_email'&&shop.cart.conf.cart.payment_id=='mcard'){alert('Quý khách vui lòng kích hoạt Email trước khi chọn mua hàng bằng Ví MuaChung');shop.customer.register.sendActiveEmail(shop.cart.conf.customer.email,1);}
break;case'cus_not_found':j.msg='Hiện tại Quý khách đang không đăng nhập.<br />Vui lòng tắt cửa sổ, mua lại';alert(j.msg);break;case'blacklist':j.msg='Đặt hàng không thành công! Hãy liên hệ với CSKH của MuaChung để biết thêm chi tiết.';shop.hide_overlay_popup('pop-XACNHAN-v201404');shop.hide_overlay_popup('popOrderLenVPTT1');shop.cTheme.systemAlert(j.msg);break;default:alert(j.msg);}}});},theme:{extra:function(id,title,extra,item_id){if(extra){var extra_html='';for(var i=0;i<extra.length;i++){extra_html+=shop.join('<div class="'+(i%2==0?'bgBuyPop':'bgBuyPopOdd')+'">')('<div class="contentBuyPop fl">')('<div class="newTitle">'+extra[i].price_title+'</div>')('<div class="detailBuyPop">Giá gốc <b>'+shop.numberFormat(extra[i].price,0,'','.')+'đ</b> - Giảm <strong>'+shop.numberFormat(extra[i].price_promotion,0,'','.')+'%</strong> - Tiết kiệm <strong>'+shop.numberFormat(extra[i].price_save_money,0,'','.')+'đ</strong></div>')('</div>')('<div class="fr">')('<a href="javascript:void(0)" class="buyPopBlock" onclick="shop.cart.processExtra('+item_id+','+i+')"><span><span>Giá <b>'+shop.numberFormat(extra[i].price_save,0,'','.')+'đ</b></span></span></a>')('<div class="c"></div>')('</div>')('<div class="c"></div>')('</div>')();}
return shop.popupSite(id,title,'<div class="content" style="padding:20px">'+extra_html+'</div>');}
return'';},stepThree:function(id,title){var paymentViSa='',data=shop.cart.conf.cart.cart,note='',t='',logo='',bt_checkout='ĐẶT HÀNG',shipping_fee=shop.cLib.getShipFee(shop.cart),shipping_fee_f=shop.numberFormat(shipping_fee)+' đ',ship='',num=shop.cart.conf.cart.numberOtp,total=num*data.price;if((shop.cart.conf.shipping.active||shop.cart.conf.shipping.COD)&&shop.cart.conf.shipping.check&&shipping_fee>0){ship=shop.join('<tr>')('<td valign="top" align="center" class="item bRight">2</td>')('<td valign="top" class="item bRight" colspan="2">Phí giao tận nơi</td>')('<td valign="top" align="right" class="item bRight">'+shipping_fee_f+'</td>')('<td valign="top" align="center" class="item bRight">'+num+'</td>')('<td valign="top" align="right" class="item">'+shop.numberFormat(num*shipping_fee)+' đ</td>')('</tr>')();total+=num*shipping_fee;}
if(shop.cart.isPlaneDeal()){total=shop.cart.conf.plane.nbParent*data.price+shop.cart.conf.plane.nbChildren*data.price_baby;}
if(shop.cart.conf.cart.payment_id=='go2tour'){bt_checkout='ĐĂNG KÝ';t='Thanh toán tại '+(shop.cart.conf.cart.cart.type_tour==1?('Khách sạn '+shop.cart.conf.cart.cart.tour_caption):('Trung tâm tour '+shop.cart.conf.cart.cart.tour_caption));}else if(shop.cart.conf.cart.payment==1){t="Thanh toán Online";logo='<a href="'+PAY_GATE_SITE+'" target="_blank" title="'+PAY_GATE_SITE_NAME+'"><img src="style/images/logo/'+PAY_GATE_LOGO+'" height="97" width="196" border="0" /></a>';note=shop.join('<div class="mLeft25" style="width:470px">')('<div>')('<div><strong style="color:red">Chú ý:</strong> Quý khách phải có <b>thẻ Visa/Master</b> đã kích hoạt thanh toán online</div>')('<div class="mTop5">hoặc <b>thẻ ATM đã đăng kí sử dụng internet banking</b> với ngân hàng phát hành thẻ</div>')('</div>')('<div class="mTop10">Thanh toán Online được đảm bảo bởi <a href="'+PAY_GATE_SITE+'" target="_blank" title="'+PAY_GATE_SITE_NAME+'">'+PAY_GATE+'</a></div>')('</div>')();bt_checkout='THANH TOÁN';}else if(shop.cart.conf.cart.payment==2){var moreGold='',suggest='',total_fix=total-0;if(shop.cart.conf.customer.gold<total_fix){moreGold=total_fix-shop.cart.conf.customer.gold;moreGold=shop.numberFormat(moreGold,0,'','.');moreGold='Quý khách phải nạp thêm: <b style="color:red">'+moreGold+'</b> đ';suggest='nap them';bt_checkout='';}else{moreGold=shop.cart.conf.customer.gold-total_fix;moreGold=shop.numberFormat(moreGold,0,'','.');moreGold='Sau khi thanh toán Quý khách còn: <b style="color:red">'+moreGold+'</b> đ';bt_checkout='THANH TOÁN';}
t="Thanh toán bằng Ví MuaChung";note=shop.join('<div class="mLeft25" style="width:720px">')('<div>- Hiện tại của Quý khách đang có: <b>'+shop.numberFormat(shop.cart.conf.customer.gold,0,'','.')+'</b> đ</div>')('<div class="mTop5">- Đơn hàng này có giá trị tương ứng với: <b>'+shop.numberFormat(total,0,'','.')+'</b> đ</div>')('<div class="mTop5 mBottom10">- '+moreGold+'</div>'+(suggest!=''?'<a href="javascript:void(0)" onclick="shop.gold.rechargeStep1()" id="fl" class="blueButton"><span><span>NẠP TIỀN</span></span></a><div class="c"></div>':''))('</div>')();}else if(shop.cart.conf.cart.payment_id=='cod'){t="MuaChung giao hàng và thu tiền tận nơi";if(shop.cart.conf.shipping.codShipType=='office'){t="Lên văn phòng MuaChung nhận hàng/phiếu và trả tiền"}else if(shop.cart.conf.shipping.codShipType=='coupon'){t="MuaChung giao phiếu và thu tiền tận nơi"}}else if(shop.cart.conf.cart.payment_id=='coo'){var office=shop.cLib.getOffice(shop.cart.conf.office_id,shop.cart)
t="Lên văn phòng MuaChung nhận hàng/phiếu và trả tiền";note=shop.join('<div style="width:720px"><b style="color:red">Văn Phòng: </b>'+office.name+' - ĐC: '+office.address+' - ĐT: '+office.tel+'</div>')();}
var regulations=shop.cart.conf.user.type=='guest'?shop.join('<div class="mTop10" style="font-size:16px;width:758px">')('<input type="checkbox" id="check-regulations" class="checkbox" checked />')('<label for="check-regulations">')('<strong>Tôi đã đọc và đồng ý với các <a href="trang-the-le.html" target="_blank">điều khoản</a> và <a href="trang-quy-dinh-refund.html"  target="_blank">quy định</a> của MuaChung.vn</strong>')('</label>')('</div>')():'';var newWardInfo='';if(!shop.district.isCityNotRequireWardInfo(shop.cart.conf.user.city)){newWardInfo='/'+shop.cart.conf.user.ward;}
var address='<div class="mTop5"><strong>Địa chỉ '+(shop.cart.conf.cart.payment_id=='coo'?'đăng kí':'nhận hàng')+':</strong> <span class="cff9200">'+shop.cart.conf.user.address+' ('+shop.cart.conf.user.street+newWardInfo+'/'+shop.cart.conf.user.district+'/'+city_list[shop.cart.conf.user.city].title+')'+'</span>';if(shop.cart.conf.user.note!=''&&shop.cart.conf.cart.payment_id!='coo'){address+='</div><div class="mTop5"><strong>Ghi chú nhận hàng:</strong> <span class="cff9200">'+shop.cart.conf.user.note+'</span>';}
address+='<a href="javascript:void(0)" onclick="shop.cart.stepOne()" class="blueButton" id="fr"><span><span>SỬA THÔNG TIN CÁ NHÂN</span></span></a></div>';if(shop.cLib.isMultiPrice(shop.cart.conf.cart.cart.id,shop.cart)&&shop.is_exists(data.extra)){data.title+=' ('+shop.cart.conf.extra[shop.cart.conf.cart.cart.id][data.extra].price_title+')';}
var vatInfo='';var vatOne=shop.cart.conf.cart.cart.vat*data.price/100;vatOne=vatOne%500==0?vatOne:(Math.floor(vatOne/500)+1)*500;var totalVat=vatOne*num;if(totalVat>0&&shop.cart.conf.cart.cart.vat_type==0){vatInfo=shop.join('<tr>')('<td valign="top" align="center" class="item bRight">2</td>')('<td valign="top" class="item bRight" colspan="2">Thuế GTGT và phí dịch vụ</td>')('<td valign="top" align="right" class="item bRight">'+shop.numberFormat(vatOne)+' đ</td>')('<td valign="top" align="center" class="item bRight">'+num+'</td>')('<td valign="top" align="right" class="item">'+shop.numberFormat(num*vatOne)+' đ</td>')('</tr>')();total+=totalVat;}else if(shop.cart.conf.cart.cart.fee_ncc>0){vatOne=shop.cart.conf.cart.cart.fee_ncc;totalVat=vatOne*num;vatInfo=shop.join('<tr>')('<td valign="top" align="center" class="item bRight">2</td>')('<td valign="top" class="item bRight" colspan="2">Thuế GTGT và phí dịch vụ</td>')('<td valign="top" align="right" class="item bRight">'+shop.numberFormat(vatOne)+' đ</td>')('<td valign="top" align="center" class="item bRight">'+num+'</td>')('<td valign="top" align="right" class="item">'+shop.numberFormat(num*vatOne)+' đ</td>')('</tr>')();total+=totalVat;}
var nbCoin=Math.round(total/1000);if(shop.cart.isPlaneDeal()){total=0;var planeList='';var nbParent=shop.cart.conf.plane.nbParent;planeList+=shop.join('<tr>')('<td valign="top" align="center" class="item bRight">1</td>')('<td valign="top" class="item bRight">'+data.title+'</td>')('<td valign="top" align="center" class="item bRight">Phiếu người lớn</td>')('<td valign="top" align="right" class="item bRight">'+data.price_f+'</td>')('<td valign="top" align="center" class="item bRight">'+nbParent+'</td>')('<td valign="top" align="right" class="item">'+shop.numberFormat(nbParent*data.price,0,'','.')+' đ</td>')('</tr>')();var nbChildren=shop.cart.conf.plane.nbChildren;var priceBaby=parseInt(shop.cart.conf.cart.cart.price_baby);if(nbChildren>0){planeList+=shop.join('<tr>')('<td valign="top" align="center" class="item bRight">2</td>')('<td valign="top" class="item bRight">'+data.title+'</td>')('<td valign="top" align="center" class="item bRight">Phiếu trẻ em</td>')('<td valign="top" align="right" class="item bRight">'+shop.numberFormat(priceBaby,0,'','.')+' đ</td>')('<td valign="top" align="center" class="item bRight">'+nbChildren+'</td>')('<td valign="top" align="right" class="item">'+shop.numberFormat(nbChildren*priceBaby,0,'','.')+' đ</td>')('</tr>')();}
total+=nbParent*parseInt(shop.cart.conf.cart.cart.price);total+=nbChildren*priceBaby;nbCoin=Math.round(total/1000);}
var boxEnterPassGold='';if(shop.cart.conf.cart.payment_id=='mcard'){if(!shop.cart.conf.isAdminAddOrder||(shop.cart.conf.isAdminAddOrder&&!shop.cart.conf.isAdminAddOrderGold)){boxEnterPassGold=shop.join('<div class="box-gradien pBottom10 pTop15 mTop10">')('<div class="title">Xác nhận: <span style="font-size:12px;font-weight:normal;text-transform:none">Thanh toán bằng Ví MuaChung</span></div>')('<div>Để đảm bảo tính an toàn, vui lòng nhập mật khẩu tài khoản của bạn: <input type="password" id="order_gold_passconfirm" /></div>')('</div>')();}}
return shop.popupSite(id,title,shop.join('<div class="content" style="padding:10px 20px">')('<div class="box-gradien pBottom10 pTop15" style="*width:713px">')('<div class="title">Thông tin khách hàng</div>')('<div class="content" id="pTop10">')('<div><strong>Họ tên:</strong> <span class="cff9200">'+shop.cart.conf.user.fullname+'</span></div>')('<div class="mTop5"><strong>Email:</strong> <span class="cff9200">'+shop.cart.conf.user.email+'</span></div>')('<div class="mTop5"><strong>Điện thoại di động:</strong> <span class="cff9200">'+shop.cart.conf.user.mobile_phone+'</span></div>')(address+'<div class="c"></div>')('</div>')('</div>')('<div class="box-gradien pBottom10 pTop15 mTop10">')('<div class="title">Hình thức thanh toán: <span style="font-size:12px;font-weight:normal;text-transform:none">'+t+'</span></div>')('<div class="content">')('<div class="fl">'+logo+'</div>')('<div class="fl">'+note+'</div>')('<div class="c"></div>')('</div>')('</div>')('<div class="box-gradien mTop10" id="box-gradien2">')('<div class="title mTop10 mLeft10">Thông tin sản phẩm</div>')('<div class="content" id="pTop5">')('<table class="cart-finish" cellpadding="0" cellspacing="0" width="100%" border="0">')('<thead><tr>')('<th class="head bRight" width="25">STT</th>')('<th class="head bRight">Sản phẩm</th>')('<th class="head bRight" width="70">Đơn vị</th>')('<th class="head bRight" width="80">Đơn Giá</th>')('<th class="head bRight" width="25">SL</th>')('<th class="head" width="80">Thành Tiền</th>')('</tr></thead>')(!shop.cart.isPlaneDeal()?shop.join('<tr>')('<td valign="top" align="center" class="item bRight">1</td>')('<td valign="top" class="item bRight">'+data.title+'</td>')('<td valign="top" align="center" class="item bRight">'+data.code+'</td>')('<td valign="top" align="right" class="item bRight">'+data.price_f+'</td>')('<td valign="top" align="center" class="item bRight">'+num+'</td>')('<td valign="top" align="right" class="item">'+shop.numberFormat(num*data.price,0,'','.')+' đ</td>')('</tr>')():planeList)(vatInfo)(ship+'<tr>')('<td align="right" class="item total-all" colspan="6">Tổng tiền = <span id="total-all">'+shop.numberFormat(total,0,'','.')+' đ</span>')('<br />')('<span style="color:#ff6600;font-weight:normal">Được thưởng '+nbCoin+' điểm khi thanh toán</span>')('</td>')('</tr></table>')('</div>')('</div>'+regulations)(boxEnterPassGold)('<div align="center" class="mTop10">'+(bt_checkout!=''?'<a href="javascript:void(0)" onclick="shop.cart.processStepThree()" class="blueButton  mLeft10" id="fr"><span><span>'+bt_checkout+'</span></span></a>':''))(shop.cart.isPlaneDeal()?'<a href="javascript:void(0)" onclick="shop.cart.showPlaneForm(true)" id="fr" class="blueButton"><span><span><b>&laquo;</b> QUAY LẠI</span></span></a>':'<a href="javascript:void(0)" onclick="shop.cart.stepTwo()" id="fr" class="blueButton"><span><span><b>&laquo;</b> QUAY LẠI</span></span></a>')('<div class="c"></div>')('</div>')('</div>')());},paymentViSa:function(){return shop.join('<form id="checkoutSoHa" method="post" action="'+shop.cart.conf.cart.url+'">')('<input type="hidden" value="'+shop.cart.conf.cart.quantity+'" name="quantity" />')('<input type="hidden" value="'+shop.cart.conf.cart.order_id+'" name="id" />')('<input type="hidden" value="'+shop.cart.conf.cart.total+'" name="total" />')('<input type="hidden" value="'+shop.cart.conf.cart.good_name+'" name="good" />')('<input type="hidden" value="'+shop.cart.conf.cart.item_ids+'" name="item_ids" />')('<input type="hidden" value="'+shop.cart.conf.user.fullname+'" name="fullname" />')('<input type="hidden" value="'+shop.cart.conf.user.mobile_phone+'" maxlength="50" name="mobiphone" />')('<input type="hidden" value="'+shop.cart.conf.user.email+'" maxlength="50" name="email" />')('<input type="hidden" value="'+shop.cart.conf.user.id+'" maxlength="50" name="uid" />')('</form>')();},newPrice:function(id,r){var vat=parseInt(shop.cart.conf.cart.cart.vat);var price=parseInt(shop.cart.conf.cart.cart.price),num=shop.cart.conf.cart.numberOtp,radio=shop.get_ele("ship_"+id),check=false,ship_fee=shop.cLib.getShipFee(shop.cart);if(radio&&radio.checked){check=true;}else if(!r){check=true;radio.checked=true;}
shop.cart.conf.shipping.codShipType=id;shop.cart.conf.cart.priceAndShip=num*price;if(id=='product'){shop.cart.conf.shipping.check=true;shop.cart.conf.cart.priceAndShip+=num*parseInt(ship_fee);}else{shop.cart.conf.shipping.check=false;}
var number=num;if(vat>0&&shop.cart.conf.cart.cart.vat_type==0){var oneVat=vat*price/100;oneVat=oneVat%500==0?oneVat:((Math.floor(oneVat/500)+1)*500);$('#total_vat').html(shop.numberFormat(oneVat*number)+' đ');shop.cart.conf.cart.priceAndShip+=oneVat*number;}else if(shop.cart.conf.cart.cart.fee_ncc>0){var oneVat=shop.cart.conf.cart.cart.fee_ncc;$('#total_vat').html(shop.numberFormat(oneVat*number)+' đ');shop.cart.conf.cart.priceAndShip+=oneVat*number;}
var p=jQuery(radio).parent().parent();if(!jQuery('.rightInfo',p).hasClass('rightInfoClicked')){jQuery('.shipGuideActive').addClass('hidden').removeClass('shipGuideActive').hide();jQuery('.shipGuide',p).slideDown().removeClass('hidden').addClass('shipGuideActive');}
if(!shop.cart.isPlaneDeal()){jQuery('#sizeColorTotal02').html(shop.numberFormat(number*price)+" đ");jQuery('#bgAllPrice').html(shop.numberFormat(shop.cart.conf.cart.priceAndShip)+" đ");jQuery('#nbCoin').html(shop.numberFormat(Math.round(shop.cart.conf.cart.priceAndShip/1000)));jQuery('#total_includeVAT').html(shop.numberFormat(shop.cart.conf.cart.priceAndShip)+" đ");jQuery('#moneyOffice').html(shop.numberFormat(num*price/100)+" đ");}},price:function(number){shop.cart.conf.cart.numberOtp=number;var price=parseInt(shop.cart.conf.cart.cart.price);shop.cart.conf.cart.priceAndShip=number*price,real_ship=shop.cLib.getShipFee(shop.cart);var vat=parseInt(shop.cart.conf.cart.cart.vat);if(shop.cart.conf.shipping.fee>0){jQuery('#feePrice').html(shop.numberFormat(number*real_ship)+' đ');if(shop.cart.conf.shipping.check){shop.cart.conf.cart.priceAndShip+=number*real_ship;}}
if(vat>0&&shop.cart.conf.cart.cart.vat_type==0){var oneVat=vat*price/100;oneVat=oneVat%500==0?oneVat:((Math.floor(oneVat/500)+1)*500);$('#total_vat').html(shop.numberFormat(oneVat*number)+' đ');shop.cart.conf.cart.priceAndShip+=oneVat*number;}else if(shop.cart.conf.cart.cart.fee_ncc>0){var oneVat=shop.cart.conf.cart.cart.fee_ncc;$('#total_vat').html(shop.numberFormat(oneVat*number)+' đ');shop.cart.conf.cart.priceAndShip+=oneVat*number;}
jQuery('#numPrice').html(shop.numberFormat(number*price)+" đ");jQuery('#sizeColorTotal02').html(shop.numberFormat(number*price)+" đ");jQuery('#bgAllPrice').html(shop.numberFormat(shop.cart.conf.cart.priceAndShip)+" đ");jQuery('#nbCoin').html(shop.numberFormat(Math.round(shop.cart.conf.cart.priceAndShip/1000)));jQuery('#total_includeVAT').html(shop.numberFormat(shop.cart.conf.cart.priceAndShip)+" đ");jQuery('#moneyOffice').html(shop.numberFormat(number*price/100)+" đ");},changeCity:function(district,city){var cityTitle='Quận/Huyện:';if(city==67||city==68||city==30){cityTitle='Quận/Phường:';}
jQuery('#disTitle').html(cityTitle);}}};shop.cAddress={conf:{o:null,book:null,currentAddress:{fullname:'',email:'',phone:'',type:'guest',address:'',street:'',ward:'',city:0,district:'',note:'',cod_at:'',district_id:0}},stepAddress:function(cart){var cod_at=$('#cartRegisterForm input[name="cart_cod_at"]:checked').val();if(typeof cod_at=='undefined'||cod_at==''){var msg='Vui lòng chọn nhận hàng ở Nơi làm việc hay Nhà riêng';var browseCity=shop.cLib.getCity(true,0);if(browseCity==22){msg='Vui lòng chọn thời gian nhận hàng Trong hay Ngoài giờ hành chính';}
alert(msg);return;}
shop.cart.conf.user.cod_at=cod_at;shop.cAddress.conf.o=cart;shop.ajax_popup('act=cart&code=loadbook',"GET",{},function(j){if(j.err!=0){alert('Quý khách phải đăng nhập để thực hiện chức năng này');}else{shop.cAddress.conf.book=j.data;shop.show_overlay_popup('customer-address','Quản lý thông tin mua hàng',shop.cAddress.theme.stepAddress('customer-address','Quản lý thông tin mua hàng'),{background:{'background-color':'transparent'},border:{'background-color':'transparent','padding':'0px'},title:{'display':'none'},content:{'padding':'0px','width':'660px','font-size':'12px'}});}});},doStepAddress:function(back){var cart=shop.cAddress.conf.o;if(back){cart.stepOne();}else{var check=0,book=shop.cAddress.conf.book;jQuery(".radio_book").each(function(){if(check==0&&this.checked){check=this.value;}});if(check==0){alert('Qúy khách chưa chọn thông tin mua hàng');return;}
if(shop.is_exists(book[check])){if(new String(book[check].fullname).match(/['"><=&?!~%+{}[\]|`()@#$^*-/\\,.]/i)!=null){alert('Họ tên không được chứa các ký tự đặc biệt');return;}
cart.conf.user.email=book[check].email;cart.conf.user.fullname=book[check].fullname;cart.conf.user.mobile_phone=book[check].phone;cart.conf.user.address=book[check].address;cart.conf.user.street=book[check].street;cart.conf.user.city=book[check].city;cart.conf.user.district_id=book[check].district_id;cart.conf.user.district=book[check].district;cart.conf.user.ward=book[check].ward;shop.cLib.guest.save(cart.conf.user,shop.cart);cart.stepTwo(cart.conf.user.district_id,cart.conf.user.city);}else{alert('Không xác nhận được thông tin! Quý khách vui lòng tắt cửa sổ và thao tác lại');}}},doAddNew:function(){shop.cAddress.conf.o.stepOne(true);},removeUI:function(id){jQuery('.event'+id).remove();shop.cAddress.conf.book[id]=null;delete shop.cAddress.conf.book[id];},removeBook:function(id){if(confirm('Quý khách thực sự muốn xóa thông tin này ?')){shop.ajax_popup('act=cart&code=delBook',"GET",{id:id},function(j){if(j.err!=0){switch(j.msg){case'not_login':alert('Quý khách phải đăng nhập để thực hiện chức năng này');break;case'not_existed':alert('Không tìm thấy thông tin này');shop.cAddress.removeUI(id);break;case'db':alert('Xóa không thành công, vui lòng thử lại');break;}}else{shop.cAddress.removeUI(id);}});}},theme:{stepAddress:function(id,title,cart){var book=shop.cAddress.conf.book,html='';if(book){html='<table cellpadding="0" cellspacing="0" border="0">';for(var i in book){if(shop.is_exists(city_list[book[i].city])){html+=shop.join('<tr class="event'+i+'">')('<td valign="top"><input type="radio" name="radio_book" class="radio_book" id="radio_book'+book[i].id+'" value="'+book[i].id+'" /></td>')('<td valign="top" width="585" style="padding:0 0 7px;color:#000">')('<div style="border-bottom:2px solid #ccc;padding:0 0 7px">')('<a href="javascript:void(0)" onclick="shop.cAddress.removeBook('+i+')" class="blueButton mTop5" id="fr"><span><span> Xóa </span></span></a>')('<table cellpadding="0" cellspacing="2" border="0">')('<tr>')('<td><b>Họ tên: </b></td>')('<td>'+book[i].fullname+'</td>')('</tr>')('<tr>')('<td><b>ĐT di động: </b></td>')('<td>'+book[i].phone+'</td>')('</tr>')('<tr>')('<td><b>Email: </b></td>')('<td>'+book[i].email+'</td>')('</tr>')('<tr>')('<td><b>Địa chỉ: </b></td>')('<td>'+book[i].address+'</td>')('</tr>')('<tr>')('<td><b>Đường/Phố: </b></td>')('<td>'+book[i].street+'</td>')('</tr>')('<tr>')('<td><b>Xã/Phường: </b></td>')('<td>'+book[i].ward+'</td>')('</tr>')('<tr>')('<td><b>Quận/Huyện: </b></td>')('<td>'+book[i].district+'</td>')('</tr>')('<tr>')('<td><b>Tỉnh/Thành</b></td>')('<td>'+city_list[book[i].city].title+'</td>')('</tr>')('</table>')('<div class="c"></div>')('</div>')('</td>')('</tr>')();}}
html+='</table>';}
return shop.popupSite(id,title,shop.join('<div class="content p20">')(html+'<div class="mTop10">')('<a href="javascript:shop.cAddress.doAddNew()" class="addBookCtrl fl">Thêm thông tin mới</a>')('<a href="javascript:void(0)" onclick="shop.cAddress.doStepAddress()" class="blueButton mLeft10" id="fr"><span><span>TIẾP TỤC <b>&raquo;</b></span></span></a>')('<a href="javascript:void(0)" onclick="shop.cAddress.doStepAddress(true)" class="blueButton" id="fr"><span><span><b>&laquo;</b> QUAY LẠI</span></span></a>')('<div class="c"></div>')('</div>')('<div class="c"></div>')('</div>')());}}};shop.cTheme={showMap:function(map,obj){},labelMe:{mousedown:false,mouseDIV:{over:function(obj){jQuery(obj).addClass('over-bg')},out:function(obj){jQuery(obj).removeClass('over-bg')},down:function(obj,ckb,cb){ckb=ckb?ckb:'.checkbox';if(!shop.cTheme.labelMe.mousedown){var check=jQuery(ckb,obj).attr("checked");jQuery(ckb,obj).attr("checked",!check);if(cb)cb();}},up:function(){shop.cTheme.labelMe.mousedown=false}},mouseCheckboxDown:function(){shop.cTheme.labelMe.mousedown=true}},choosePayment:function(obj,cart){var browseCity=shop.cLib.getCity(true,0);if(!jQuery(obj).hasClass(obj.id+'NoActive')){if(cart.conf.user.type=='guest'&&(obj.id=='mcard'||obj.id=='cod'||obj.id=='coo')&&!cart.conf.isAdminAddOrder){shop.get_ele('radio_'+obj.id).checked=false;var title=(obj.id=='mcard')?'Ví MuaChung':'COD';LOGIN_TO_ORDER=1;shop.customer.loginMixReg.show();}else{jQuery('.pay_active').removeClass('pay_active').removeClass('clicked');jQuery(obj).addClass('pay_active clicked');if(obj.id=='atm'){jQuery('.bank').slideDown();}else{jQuery('.bank').slideUp();}
shop.get_ele('radio_'+obj.id).checked=true;jQuery('.paymentGuide').hide();jQuery('.paymentGuide',obj).show();}}else{shop.get_ele('radio_'+obj.id).checked=false;var id=jQuery('.clicked').attr('id');if(id){shop.get_ele('radio_'+id).checked=true;}}},finish:function(id,title){return shop.popupSite(id,title,shop.join('<div class="content" style="padding:15px 20px 25px;font-size:18px" align="center">')('<b>Hệ thống đang cập nhật đơn hàng... </b><br /><br />')('<div id="floatingBarsG"><div class="blockG" id="rotateG_01"></div><div class="blockG" id="rotateG_02"></div><div class="blockG" id="rotateG_03"></div><div class="blockG" id="rotateG_04"></div><div class="blockG" id="rotateG_05"></div><div class="blockG" id="rotateG_06"></div><div class="blockG" id="rotateG_07"></div><div class="blockG" id="rotateG_08"></div></div>')('Quý khách vui lòng <b style="color:red">không tắt trình duyệt</b>')('</div>')());},finish_v_new:function(id,title){html="";html=shop.join('<div class="bl_3_box_popup">')('<div id="floatingBarsG" class="fl"><div class="blockG" id="rotateG_01"></div><div class="blockG" id="rotateG_02"></div><div class="blockG" id="rotateG_03"></div><div class="blockG" id="rotateG_04"></div><div class="blockG" id="rotateG_05"></div><div class="blockG" id="rotateG_06"></div><div class="blockG" id="rotateG_07"></div><div class="blockG" id="rotateG_08"></div></div>')('<div class="fl mLeft50">')('<div>Hệ thống đang cập nhật...</div>')('<div>Vui lòng <span style="color:#ff0404">không tắt trình duyệt</span></div>')('</div>')('<div class="c"></div>')('</div>')();return html;},showActivePhoneWarning:function(email,phone,cart){if(phone==0){shop.customer.active.phone(true);}else{var msg='';if(email==0){msg+='<div>- <b style="color:red">Kích hoạt Email</b>,  bấm <a href="javascript:shop.customer.register.sendActiveEmail(\''+cart.conf.customer.email+'\', 1)">vào đây</a> để nhận Email kích hoạt.</div>';}
if(phone==0){msg+='<div class="mTop5">- <b style="color:red">Kích hoạt số điện thoại</b>, vui lòng nhắn tin theo cú pháp: <b style="color:red">CHUNG</b> gửi <b style="color:red">8001</b> (500đ/sms)</div>';}
shop.show_overlay_popup('mc-comment-result','Hệ thống',shop.popupSite('mc-comment-result','Hệ thống',shop.join('<div class="content" style="padding:10px">')('<div><b>Cám ơn Quý khách đã chọn mua hàng!</b></div>')('<div class="mTop10 mBottom5">Để mua hàng qua <b>COD</b>, Quý khách cần hoàn thiện các bước sau: </div>')('<div class="f11" style="margin:10px 10px 0;background-color: #FFFEDE;border: 1px solid #FFEDBE;padding: 5px">'+msg+'</div>')('<div class="mTop15">')('<div style="width:60px;margin:0 auto">')('<a id="fr" class="blueButton mLeft10" onclick="shop.hide_overlay_popup(\'mc-comment-result\')" href="javascript:void(0)"><span><span>Đóng</span></span></a>')('<div class="c"></div>')('</div>')('</div>')('</div>')()),{background:{'background-color':'transparent'},title:{'display':'none'},border:{'background-color':'transparent','padding':'0px'},content:{'padding':'0px','width':'500px'}});}},systemAlert:function(msg,timeShow){var key=shop.get_uuid();if($('.show-alert-temp-active').size()<1){$('#show-alert-temp .format-messages').html(msg);if(timeShow!='over'){$('#show-alert-temp').show('fade',0,callback());}else{$('#show-alert-temp').show('fade',0);}
$('#header').focus();$('#show-alert-temp').addClass('show-alert-temp-active');$('#showProvincecopy').html($('#showProvinceRight').html());$('#showProvincecopy .popup-address').attr('style','left: -715px;');}else{showTipErr();}}};function callback(){setTimeout(function(){$("#show-alert-temp").fadeOut();$("#show-alert-temp").removeClass('show-alert-temp-active');},7000);};shop.cLib={getAllCity:function(type,cart){switch(type){case 1:return shop.cookie.get(shop.header.city.conf.city_cookie);case 2:return cart.conf.user.city;case 3:return jQuery('.currentBg').attr('id');default:return cart.conf.cart.cart.province_id;}},getCity:function(deal_city,province){var cookie_city=shop.cookie.get(shop.header.city.conf.city_cookie),url_city=jQuery('.currentBg').attr('id');if(province==0){return cookie_city;}
if(deal_city){return url_city;}
return cookie_city;},getOffice:function(oid,cart){var city=shop.cLib.getCity(true,cart.conf.cart.cart.province_id);if(cart.conf.office&&shop.is_exists(cart.conf.office[city])){var office=cart.conf.office[city];for(var i in office){if(office[i].id==oid){return office[i];}}}
return false;},getShipFee:function(cart){var ship=parseInt(cart.conf.shipping.fee);if(ship>0&&cart.conf.shipping.in_area==0){ship+=parseInt(cart.conf.shipping.more_fee);}
return ship;},inArea:function(cart){return cart.conf.shipping.in_area==1},isCOD:function(cart){return cart.conf.shipping.COD},isGOLD:function(cart){return cart.conf.user.type=='customer'},isMultiPrice:function(id,cart){return shop.is_exists(cart.conf.extra[id])&&cart.conf.extra[id].length>1;},guest:{cookie_name:{fullname:'guest_fullname',email:'guest_email',mobile_phone:'guest_mobile_phone',address:'guest_address',street:'guest_street',ward:'guest_ward',district:'guest_district',city:'guest_city',note:'guest_note',cod_at:'guest_cod_at'},update:function(u,cart){if(u){if(shop.is_exists(u.fullname)&&u.fullname!=''){cart.conf.user.fullname=u.fullname;}
if(shop.is_exists(u.email)&&u.email!=''){cart.conf.user.email=u.email;}
if(shop.is_exists(u.mobile_phone)&&u.mobile_phone!=''){cart.conf.user.mobile_phone=u.mobile_phone;}
if(shop.is_exists(u.type)&&(u.type=='guest'||u.type=='customer')){cart.conf.user.type=u.type;}
if(shop.is_exists(u.address)&&u.address!=''){cart.conf.user.address=u.address;}
if(shop.is_exists(u.district)&&u.district!=''){cart.conf.user.district=u.district;}
if(shop.is_exists(u.street)&&u.street!=''){cart.conf.user.street=u.street;}
if(shop.is_exists(u.ward)&&u.ward!=''){cart.conf.user.ward=u.ward;}
if(shop.is_exists(u.note)&&u.note!=''){cart.conf.user.note=u.note;}
if(shop.is_exists(u.city)&&u.city!=''){cart.conf.user.city=u.city;}}},restore:function(cart){var guest=shop.cLib.guest.cookie_name,u={fullname:shop.cookie.get(guest.fullname),email:shop.cookie.get(guest.email),mobile_phone:shop.cookie.get(guest.mobile_phone),address:shop.cookie.get(guest.address),street:shop.cookie.get(guest.street),ward:shop.cookie.get(guest.ward),district:shop.cookie.get(guest.district),city:shop.cookie.get(guest.city),note:shop.cookie.get(guest.note)};shop.cLib.guest.update(u,cart);},save:function(u,cart){if(u){var year=86400*30*12,guest=shop.cLib.guest.cookie_name;if(shop.is_exists(u.fullname)){shop.cookie.set(guest.fullname,u.fullname,year,'/');}
if(shop.is_exists(u.email)){shop.cookie.set(guest.email,u.email,year,'/');}
if(shop.is_exists(u.mobile_phone)){shop.cookie.set(guest.mobile_phone,u.mobile_phone,year,'/');}
if(shop.is_exists(u.type)){cart.conf.user.type=u.type;}
if(shop.is_exists(u.address)&&u.address!=''){shop.cookie.set(guest.address,u.address,year,'/');}
if(shop.is_exists(u.street)&&u.street!=''){shop.cookie.set(guest.street,u.street,year,'/');}
if(shop.is_exists(u.ward)&&u.ward!=''){shop.cookie.set(guest.ward,u.ward,year,'/');}
if(shop.is_exists(u.district)&&u.district!=''){shop.cookie.set(guest.district,u.district,year,'/');}
if(shop.is_exists(u.note)&&u.note!=''){shop.cookie.set(guest.note,u.note,year,'/');}
if(shop.is_exists(u.city)&&u.city!=''){shop.cookie.set(guest.city,u.city,year,'/');}
if(shop.is_exists(u.cod_at)&&u.cod_at!=''){shop.cookie.set(guest.cod_at,u.cod_at,year,'/');}}}},cardSuggest:function(number,cardList,rate,bug){if(number>0){var stop=0,temp=0,idx=0,need={},i=0;number=Math.ceil(number/rate);while(stop==0){if(number<cardList[0]){stop=1;if(number>0){if(shop.is_exists(need[cardList[0]])){need[cardList[0]]++;}else{need[cardList[0]]=1;}}}else{for(i=0;i<cardList.length;i++){if((number<cardList[i])||(i==cardList.length-1)){idx=i;if(number<cardList[i]){idx=i-1;}
if(number<cardList[i]&&number>cardList[idx]){idx=i;number=0;if(shop.is_exists(need[cardList[idx]])){need[cardList[idx]]++}else{need[cardList[idx]]=1;}}else{temp=Math.floor(number/cardList[idx]);number=number-temp*cardList[idx];need[cardList[idx]]=temp;}
break;}}}}
if(bug){bug='';for(i in need){bug+='<div class="mTop5 mLeft10">- <b>'+need[i]+'</b> thẻ mệnh giá <span style="color:red">'+shop.numberFormat(i,0,'','.')+'</span> đ</div>';}
jQuery('body').prepend(bug);}
return need;}
return false;}};shop.md5=function(a){function m(a){var b=l(a);return b}function l(a){var b=d(a);var f=1732584193;var g=4023233417;var l=2562383102;var m=271733878;for(var n=0;n<b.length;n+=16){var o=f;var p=g;var q=l;var r=m;f=h(f,g,l,m,b[n+0],7,3614090360);m=h(m,f,g,l,b[n+1],12,3905402710);l=h(l,m,f,g,b[n+2],17,606105819);g=h(g,l,m,f,b[n+3],22,3250441966);f=h(f,g,l,m,b[n+4],7,4118548399);m=h(m,f,g,l,b[n+5],12,1200080426);l=h(l,m,f,g,b[n+6],17,2821735955);g=h(g,l,m,f,b[n+7],22,4249261313);f=h(f,g,l,m,b[n+8],7,1770035416);m=h(m,f,g,l,b[n+9],12,2336552879);l=h(l,m,f,g,b[n+10],17,4294925233);g=h(g,l,m,f,b[n+11],22,2304563134);f=h(f,g,l,m,b[n+12],7,1804603682);m=h(m,f,g,l,b[n+13],12,4254626195);l=h(l,m,f,g,b[n+14],17,2792965006);g=h(g,l,m,f,b[n+15],22,1236535329);f=i(f,g,l,m,b[n+1],5,4129170786);m=i(m,f,g,l,b[n+6],9,3225465664);l=i(l,m,f,g,b[n+11],14,643717713);g=i(g,l,m,f,b[n+0],20,3921069994);f=i(f,g,l,m,b[n+5],5,3593408605);m=i(m,f,g,l,b[n+10],9,38016083);l=i(l,m,f,g,b[n+15],14,3634488961);g=i(g,l,m,f,b[n+4],20,3889429448);f=i(f,g,l,m,b[n+9],5,568446438);m=i(m,f,g,l,b[n+14],9,3275163606);l=i(l,m,f,g,b[n+3],14,4107603335);g=i(g,l,m,f,b[n+8],20,1163531501);f=i(f,g,l,m,b[n+13],5,2850285829);m=i(m,f,g,l,b[n+2],9,4243563512);l=i(l,m,f,g,b[n+7],14,1735328473);g=i(g,l,m,f,b[n+12],20,2368359562);f=j(f,g,l,m,b[n+5],4,4294588738);m=j(m,f,g,l,b[n+8],11,2272392833);l=j(l,m,f,g,b[n+11],16,1839030562);g=j(g,l,m,f,b[n+14],23,4259657740);f=j(f,g,l,m,b[n+1],4,2763975236);m=j(m,f,g,l,b[n+4],11,1272893353);l=j(l,m,f,g,b[n+7],16,4139469664);g=j(g,l,m,f,b[n+10],23,3200236656);f=j(f,g,l,m,b[n+13],4,681279174);m=j(m,f,g,l,b[n+0],11,3936430074);l=j(l,m,f,g,b[n+3],16,3572445317);g=j(g,l,m,f,b[n+6],23,76029189);f=j(f,g,l,m,b[n+9],4,3654602809);m=j(m,f,g,l,b[n+12],11,3873151461);l=j(l,m,f,g,b[n+15],16,530742520);g=j(g,l,m,f,b[n+2],23,3299628645);f=k(f,g,l,m,b[n+0],6,4096336452);m=k(m,f,g,l,b[n+7],10,1126891415);l=k(l,m,f,g,b[n+14],15,2878612391);g=k(g,l,m,f,b[n+5],21,4237533241);f=k(f,g,l,m,b[n+12],6,1700485571);m=k(m,f,g,l,b[n+3],10,2399980690);l=k(l,m,f,g,b[n+10],15,4293915773);g=k(g,l,m,f,b[n+1],21,2240044497);f=k(f,g,l,m,b[n+8],6,1873313359);m=k(m,f,g,l,b[n+15],10,4264355552);l=k(l,m,f,g,b[n+6],15,2734768916);g=k(g,l,m,f,b[n+13],21,1309151649);f=k(f,g,l,m,b[n+4],6,4149444226);m=k(m,f,g,l,b[n+11],10,3174756917);l=k(l,m,f,g,b[n+2],15,718787259);g=k(g,l,m,f,b[n+9],21,3951481745);f=e(f,o);g=e(g,p);l=e(l,q);m=e(m,r)}return c(f)+c(g)+c(l)+c(m)}function k(a,b,c,d,e,f,h){return g(c^(b|~d),a,b,e,f,h)}function j(a,b,c,d,e,f,h){return g(b^c^d,a,b,e,f,h)}function i(a,b,c,d,e,f,h){return g(b&d|c&~d,a,b,e,f,h)}function h(a,b,c,d,e,f,h){return g(b&c|~b&d,a,b,e,f,h)}function g(a,b,c,d,g,h){return e(f(e(e(b,a),e(d,h)),g),c)}function f(a,b){return a<<b|a>>>32-b}function e(a,b){return(a&2147483647)+(b&2147483647)^a&2147483648^b&2147483648}function d(a){var b=(a.length+8>>6)+1;var c=new Array(b*16);for(var d=0;d<b*16;d++)c[d]=0;for(d=0;d<a.length;d++)c[d>>2]|=a.charCodeAt(d)<<d%4*8;c[d>>2]|=128<<d%4*8;c[b*16-2]=a.length*8;return c}function c(a){var c="";for(var d=0;d<=3;d++)c+=b.charAt(a>>d*8+4&15)+b.charAt(a>>d*8&15);return c}var b="0123456789abcdef";return m(a)};shop.cart.loadWardToSuggest=function(ele){var currentWard=shop.cart.conf.user.ward&&!shop.cart.conf.addbook?shop.cart.conf.user.ward:'';var dId=0;if(isNaN(ele.value)){dId=ele;}else{dId=ele.value;}
if($('#cart_city').val()!=29)return;shop.show_loading();CURRENT_WARD_LIST=[];$.ajax({async:false,type:"POST",url:"ajax.php?act=customer&code=loadWard",data:{district_id:dId},timeout:4000,cache:true,dataType:"json",success:function(obj){var data=obj.data;for(var index in data){CURRENT_WARD_LIST.push(data[index]);}
$el=$("#cart_newWard");$el.empty();$el.append($("<option></option>").attr("value",'').text('--Chọn xã/phường--'));$.each(CURRENT_WARD_LIST,function(key,value){if(value==currentWard)isMe=true;else isMe=false;$el.append($("<option></option>").attr("value",value).attr("selected",isMe).text(value));});},error:function(){}});shop.hide_loading();}
var listStreetSuggest={};shop.cart.loadStreetToSuggest=function(ele){var cache={};$("#cart_street").autocomplete({minLength:2,source:function(request,response){var term=request.term;if(term in cache){response(cache[term]);return;}
$.getJSON("ajax.php",{city_id:function(){return $('#cart_city').val();},act:'customer',code:'loadStreetDynamic',q:request.term},function(data,status,xhr){cache[term]=data;listStreetSuggest=cache[term];response(data);});},select:function(event,ui){shop.cart.loadDistrictBykeyword(ui.item.id);}});};shop.cart.loadDistrictBykeyword=function(key){$('#listDistrict').val(key);shop.cart.loadWardToSuggest(key);};shop.cart.loadDistrictByStreetName=function(key){if(Object.keys(listStreetSuggest).length>0){for(var i in listStreetSuggest){if(listStreetSuggest[i].value.toLowerCase()==$.trim(key.toLowerCase())){$('#listDistrict').val(listStreetSuggest[i].id);return;}}}};shop.cart.logRD=function(id,stepId,stepName,stepType,paymentType,shipType){var params={};if(RD_UUID===''){RD_UUID=shop.cart.getUUID();}
try{if(IS_CUSTOMER_LOGIN>0){params={sitekey:'mc',productID:id,userId:IS_CUSTOMER_LOGIN,email:CUSTOMER_EMAIL,urlDetail:encodeURIComponent(location.href)};}else{params={sitekey:'mc',productID:id,userId:0,email:'',urlDetail:encodeURIComponent(location.href)};}
params.extraFields={mc_stepType:stepType,mc_step:stepId,mc_stepName:encodeURIComponent(stepName),mc_uuid:RD_UUID};if(paymentType!=undefined){if(paymentType=='visa'){paymentType=1;}
if(paymentType=='mcard'){paymentType=2;}
if(paymentType=='cod'){paymentType=3;}
params.extraFields={mc_stepType:stepType,mc_step:stepId,mc_stepName:encodeURIComponent(stepName),mc_payment_type:paymentType,mc_uuid:RD_UUID};}
if(shipType!=undefined){if(shipType=='coupon'){shipType=2;}else{shipType=1;}
params.extraFields={mc_stepType:stepType,mc_step:stepId,mc_stepName:encodeURIComponent(stepName),mc_ship_type:shipType,mc_uuid:RD_UUID};}
oRDLog4MC.order(params);}catch(e){}}
shop.cart.getUUID=function(){var s=[],itoh='0123456789ABCDEF';for(var i=0;i<36;i++)s[i]=Math.floor(Math.random()*0x10);s[14]=4;s[19]=(s[19]&0x3)|0x8;for(var i=0;i<36;i++)s[i]=itoh[s[i]];s[8]=s[13]=s[18]=s[23]='-';return s.join('');}
shop.cart.logAdmicro=function(stepNumText){try{_cpabd.cpabd_param.iid='70';_cpabd.cpabd_param.st=stepNumText;_cpabd.step();}catch(e){}}
shop.cart.cleanCookieAutoPopupOrder=function(){shop.cookie.set('meta_size','bla',-100,'/');shop.cookie.set('meta_color','bla',-100,'/');shop.cookie.set('item_quantity','bla',-100,'/');}
shop.cart.autoPopupOrder=function(){var isTour=document.URL.indexOf('/du-lich/')!=-1;var arrSize=[],arrColor=[];var cookieMetaSize=shop.cookie.get('meta_size');var cookieMetaColor=shop.cookie.get('meta_color');try{if(cookieMetaSize.length>0){arrSize=eval(cookieMetaSize);}
if(cookieMetaColor.length>0){arrColor=eval(cookieMetaColor);}}catch(ex){}
var ready=false;if(arrColor.length>0&&arrSize.length>0){for(i in arrColor){if(i=='indexOf')continue;var colorId=arrColor[i].id;var sizeId=arrSize[i].id;var quantity=arrColor[i].quantity;$('#metaColorId').val(colorId);$('#metaColorId-'+colorId).addClass('v7_BD_SC_Color_Active');$('#metaSizeId').val(sizeId);$('#metaSizeId-'+sizeId).addClass('v7_BD_SC_Size_Active');$('#oneItemQuantityInput').val(quantity);$('#oneItemQuantity option[value="'+quantity+'"]').attr('selected','selected');$('.show-val span').text(quantity);ready=true;}}else if(arrColor.length>0){for(i in arrColor){if(i=='indexOf')continue;var colorId=arrColor[i].id;var quantity=arrColor[i].quantity;$('#metaColorId').val(colorId);$('#metaColorId-'+colorId).addClass('v7_BD_SC_Color_Active');$('#oneItemQuantity option[value="'+quantity+'"]').attr('selected','selected');$('.show-val span').text(quantity);ready=true;}}else if(arrSize.length>0){for(i in arrSize){if(i=='indexOf')continue;var sizeId=arrSize[i].id;var quantity=arrSize[i].quantity;$('#metaSizeId').val(sizeId);$('#metaSizeId-'+sizeId).addClass('v7_BD_SC_Size_Active');$('#oneItemQuantity option[value="'+quantity+'"]').attr('selected','selected');$('.show-val span').text(quantity);ready=true;}}else{var q=shop.cookie.get('item_quantity');if(q){if(!isTour){$('#oneItemQuantity option[value="'+q+'"]').attr('selected','selected');$('.show-val span').text(q);}
ready=true;}}
if(ready){STOP_TRACE_DATMUA=1;shop.cart.cleanCookieAutoPopupOrder();if(isTour){$('div.btn-order').trigger('click');}else{$('div.btn-order').trigger('click');}}}
shop.cart.goToOffice2Buy=function(){var itemId='';var arrMatch=location.href.match(/[0-9]+\.html/);itemId=arrMatch[0].replace(/\.html/,'');location.href=BASE_URL+'thanh-toan-tai-van-phong.html?item_id='+itemId;return;var id='cart-go-office',title='Hướng dẫn mua hàng';var htmlOList='',htmlMapList='';$.ajax({async:false,url:'ajax.php?act=item&code=get_office',type:'POST',data:{id_office:0,id_province:0},dataType:'json',success:function(j){if(j.err==0){var office=j.office,i=1,off=false;var inlineOrNone='';for(var o in office){off=office[o];var map=off.map;var name=decodeURIComponent(off.name);var address=decodeURIComponent(off.address);var oid=off.id;htmlOList+=shop.join('<div class="bg_adrview'+(i==1?' bg_adrviewa':'')+'" style="padding-bottom:5px;font-size:12px;margin-bottom:10px" id="officeDiv-'+oid+'">')('<span onclick="shop.cart.showOfficeMap('+off.id+');" style="color: #0070C0;cursor: pointer;font-size: 14px;">'+name+'</span> <span class="cooWish_storeStatus">&nbsp;</span>')('<br>')(address)('</div>')();inlineOrNone=(i==1)?'inline':'none';htmlMapList+=shop.join('<img width="435" height="260" src="'+map+'" id="officeMap-'+oid+'" style="display: '+inlineOrNone+';">')();i++;}}}});var browseCity=shop.cLib.getCity(true,0);var arrMatch=city_list[browseCity].support.match(/hotline";[^;]+/);arrMatch=arrMatch[0].match(/[0-9\(\) ]{5,}/);var hotline=arrMatch[0];var tpl=shop.popupSite(id,title,shop.join('<div style="padding:20px 20px;color:#333333" class="content">')('<div style="text-align: center;font-size:16px;line-height:150%;background-color: #F2F2F2; padding: 10px 5px">')('<div style="color:red">')('Quý khách vui lòng đến VP Muachung để xem hàng mẫu và đặt mua sản phẩm này')('<br />Sau khi Quý khách thanh toán, Muachung sẽ giao hàng trong vòng 3-5 ngày')('</div>')('<div style="padding-bottom: 5px; border-bottom: 1px solid #E8E8E8; padding-top: 5px;">')('</div>')('<div style="padding-top:10px;font-size:14px">')('Bấm <b>Thích</b> (cạnh nút Đặt mua) để lưu mã sản phẩm bạn muốn mua sẽ giúp Muachung phục vụ bạn tốt hơn')('</div>')('</div>')('<div style="margin-top:20px; float:left; width: 379px">')(htmlOList)('<div style="font-size:16px;border-top:1px solid #E8E8E8;padding-top:10px">')('HỖ TRỢ: <span style="color:red;font-weight: bold">'+hotline+'</span>')('</div>')('</div>')('<div style="margin-top:10px;float:right">')(htmlMapList)('</div>')('<div style="clear:both"></div>')('</div>')());shop.show_overlay_popup(id,title,tpl,{background:{'background-color':'transparent'},border:{'background-color':'transparent','padding':'0px'},title:{'display':'none'},content:{'padding':'0px','width':'878px','font-size':'14px'},release:function(){}});}
shop.cart.showOfficeMap=function(id){$('div[id^="officeDiv"]').removeClass('bg_adrviewa');$('div[id="officeDiv-'+id+'"]').addClass('bg_adrviewa');$('img[id^="officeMap"]').hide();$('img[id="officeMap-'+id+'"]').show();}
shop.cart.scrollToSelectSizeColor=function(){jQuery('html,body').animate({scrollTop:$('#lblDetailQuantity').offset().top},1000);}
shop.cart.choosePayment=function(obj,cart){var guest=cart.conf.user;if(cart.conf.user.type=='guest'&&(obj.id=='mcard'||obj.id=='cod')&&!cart.conf.isAdminAddOrder){LOGIN_TO_ORDER=1;Log=1;shop.customer.login.showLoginForm("Để tiếp tục mua hàng bạn cần đăng nhập");shop.cart.logRD(shop.cart.conf.cart.cart.id,3,'thông báo đăng nhập',1);}else{jQuery('.bl_3_StepInfoBuild_Payment_Select').removeClass('bl_3_StepInfoBuild_Payment_Select');jQuery(obj).addClass('bl_3_StepInfoBuild_Payment_Select');jQuery('input[type="radio"]').each(function(){jQuery(this).attr('checked',false);});jQuery('input[type="radio"]',obj).attr('checked',true);}};shop.cart.check2FinishLenVP=function(step){var sodienthoai=$('#phoneMuaHang').val();if(!shop.is_phone(sodienthoai)){alert('Vui lòng nhập đúng số điện thoại của bạn');$('#phoneMuaHang').focus();return;}
shop.cart.conf.user.mobile_phone=sodienthoai;var officeId=$('#popOrderLenVPTT input[name="radio_ship"]:checked').val();if(typeof officeId==='undefined'){alert('Vui lòng chọn văn phòng');return;}
shop.cart.conf.office_id=officeId;var msg=shop.cart.getCanBuyProductMessage();if(msg!=='ok'){alert(msg);return;}
shop.cart.processStepThree(step);}
shop.cart.tplVanPhong='';shop.cart.stepLenVanPhong=function(step){if(step==1){shop.cart.logRD(shop.cart.conf.cart.cart.id,1,'đặt mua tại cửa hàng',2);}else{shop.cart.logRD(shop.cart.conf.cart.cart.id,4,'đặt mua tại cửa hàng',1);}
shop.cart.conf.cart.payment_id='coo';shop.cart.conf.cart.payment=0;shop.cart.conf.shipping.codShipType='office';shop.cart.conf.shipping.check=false;shop.cart.conf.user.cod_at='office';var khach=shop.cart.conf.customer;var sanpham=shop.cart.conf.cart.cart;var cityBrowse=shop.cLib.getCity(true,0);var officeList=shop.cart.conf.office[cityBrowse];if(!(shop.cart.conf.BUY_TYPE=='vanphong'&&IS_CUSTOMER_LOGIN==0)){if(khach.active==0||khach.active_phone==0){shop.cTheme.showActivePhoneWarning(shop.cart.conf.customer.active,shop.cart.conf.customer.active_phone,shop.cart);return;}}
var guest=shop.cart.conf.user;if(sanpham.province_id=='0'){var canBuyProduct=false;var reasonCannotBuyProduct='Không xác định';var enable_province=[];var enableProvinceNameList=[];var tmp_disable_province=shop.cart.conf.cart.cart.disable_province;var nbDisableProvince=0;for(var pop in tmp_disable_province){nbDisableProvince++;break;}
if(nbDisableProvince>0){for(var tmpKey in city_list){if(city_list[tmpKey]['status']==1){var id=city_list[tmpKey].id;var isDisableProvince=false;for(var pop in tmp_disable_province){if(tmp_disable_province[pop]==id){isDisableProvince=true;break;}}
if(!isDisableProvince){enable_province.push(id);enableProvinceNameList.push(city_list[id].title);}}}
for(tmpKey in enable_province){if(enable_province[tmpKey]==cityBrowse){canBuyProduct=true;break;}}
if(!canBuyProduct){reasonCannotBuyProduct='Rất tiếc. Sản phẩm chỉ bán ở '+enableProvinceNameList.join(', ');shop.hide_overlay_popup('pop-CHON-HTTT-v201404');shop.cTheme.systemAlert(reasonCannotBuyProduct);return;}}}else if(sanpham.province_id!=cityBrowse){shop.hide_overlay_popup('pop-CHON-HTTT-v201404');shop.cTheme.systemAlert('Sản phẩm chỉ bán ở '+city_list[sanpham.province_id].title);return;}
if(!(shop.cart.conf.BUY_TYPE=='vanphong'&&IS_CUSTOMER_LOGIN==0)){if(guest.district_id==0){var callback=function(){var districtList=shop.district.listDistrictDropdown;for(var i in districtList){if(districtList[i].title==khach.district){guest.district_id=i;shop.cart.conf.shipping.in_area=districtList[i].in_area;break;}}};shop.district.loadDistrict(khach.city,callback);}}
var id='popOrderLenVPTT',title='Hidden title';var dsVanPhong='';var i;var disable_office=shop.cart.conf.cart.cart.disable_office;var isTicket=shop.cart.conf.cart.cart.type==1;for(i in officeList){var tinhtranghang='',color='#666666',class_tinhtrang='fc-orange';var vanphong=officeList[i];if(typeof vanphong==='function')continue;if(typeof shop.cart.conf.store!=='undefined'&&typeof shop.cart.conf.store[vanphong.id]!=='undefined'){if(shop.cart.conf.store[vanphong.id].total>0){tinhtranghang='Còn hàng';color='#FE1A19';class_tinhtrang='fc-green';}else{tinhtranghang='Hàng đang về';class_tinhtrang='fc-orange';}}else{tinhtranghang='Hàng đang về';class_tinhtrang='fc-green';}
var checked='';if(parseInt(vanphong.id)==parseInt(shop.cart.conf.SelectedOffice)){checked='checked';}else{checked='';}
var disabled='';if($.inArray(vanphong.id,disable_office)>=0||(!isTicket&&vanphong.id==21)){disabled='hide';}else{disabled='';}
dsVanPhong+=shop.join('<label class="address-item '+disabled+'" for="office'+vanphong.id+'">')('<input '+checked+' class="radio-opt" type="radio" value="'+vanphong.id+'" id="office'+vanphong.id+'" name="radio_ship">')('<span class="fw-b fs-14 addres-shop-name">'+vanphong.name+'</span>')('<span class="product-status fc-orange">'+(!isTicket?'<span style="color:'+color+'"> ('+tinhtranghang+')</span>':'')+'</span>')('<span class="rs address-val fc-gray-d">'+vanphong.address+'</span>')('<span class="rs address-val fc-gray-d">Giờ làm việc: '+vanphong.support+'</span>')('<i class="icon-radio-p"></i>')('</label>')();}
var dsSoLuong='';var num=parseInt(shop.cart.conf.cart.numberOtp);var minQuan=parseInt(shop.cart.conf.cart.cart.min_order);var maxQuan=parseInt(shop.cart.conf.cart.cart.max_order);for(i=minQuan;i<=maxQuan;i++){dsSoLuong+="<option "+((num==i)?'selected':'')+" value='"+i+"'>"+i+"</option>";}
var tongtienNum=0,tongtienText='0đ';var price=parseInt(sanpham.price);var vat=parseInt(shop.cart.conf.cart.cart.vat),oneVat=0;if(vat>0&&shop.cart.conf.cart.cart.vat_type==0){oneVat=vat*price/100;oneVat=oneVat%500==0?oneVat:((Math.floor(oneVat/500)+1)*500);}else if(shop.cart.conf.cart.cart.fee_ncc>0){oneVat=shop.cart.conf.cart.cart.fee_ncc;}
tongtienNum=(price+oneVat)*num;tongtienText=shop.numberFormat(tongtienNum)+'đ';var tpl='';tpl+=shop.join('<div class="mod-detail popup_special"  id="popOrderLenVPTT1">')('<div class="popup-address">')();tpl+=shop.join('<div class="pa-content clearfix" id="popOrderLenVPTT">')();if(step==1){tpl+=shop.join('<a onclick="shop.cart.logRD(shop.cart.conf.cart.cart.id, -1, \'đóng đặt mua \', 2);shop.hide_overlay_popup('+"'popOrderLenVPTT1'"+')" class="classic-popup-close" href="javascript:void(0)">x</a>')();}else{tpl+=shop.join('<a onclick="shop.cart.logRD(shop.cart.conf.cart.cart.id, -4, \'đóng đặt mua \', 1);shop.hide_overlay_popup('+"'popOrderLenVPTT1'"+')" class="classic-popup-close" href="javascript:void(0)">x</a>')();}
tpl+=shop.join('<div class="col-address">')('<div class="head-col">Đặt mua tại cửa hàng</div>')('<div class="list-address">')(dsVanPhong)('</div>')('</div>')('<div class="col-order">')('<div class="head-col"></div>')('<div class="col-order-content">')('<div class="ta-r">')('<p class="rs desc-order">Đặt mua thoải mái, không mua không sao</p>')('</div>')('<label for="phoneMuaHang" class="lbl-for-phone">')('<span>Điện thoại</span>')('<input type="text" class="txt-phone" placeholder="Nhập số điện thoại của bạn vào đây..." id="phoneMuaHang" name="phone" value="'+(IS_CUSTOMER_LOGIN>0?khach.mobile_phone:'')+'"/>')('</label>')('<div class="buy-number">')('<span class="lbl-buy-number">Số lượng</span>')('<div class="xxxDropdown">')('<label for="buy_number" class="show-val">')('<span>1</span> ')('</label>')('<select id="soluongVer1404" onchange="shop.cart.calculateMoney(\'vanphong\');" style="opacity: 1 !important">')(dsSoLuong)('</select>')('</div>')('</div>')(' <div class="btn btn-red btn-order" onclick="shop.cart.check2FinishLenVP('+step+');">Đặt hàng</div>')('<div class="order-warning fs-i"><span class="fc-red1">*</span> Lưu ý: Đặt hàng trước trên website giúp Muachung phục vụ quý khách tốt hơn. Tuy nhiên, hàng hóa liên tục được chuyển về các cửa hàng nên Muachung không đảm bảo luôn giữ hàng được cho Quý khách. Quý khách vui lòng kiểm tra tình trạng còn hàng trên website trước khi đến cửa hàng.</div>')('</div>')('</div>')('</div>')('</div>')();tpl+=shop.join('</div>')('</div>')();shop.cart.tplVanPhong=tpl;var options=shop.cart.createPopupOptions('675px');shop.show_overlay_popup('popOrderLenVPTT1',title,tpl,options);};shop.cart.stepZeroV201404=function(){var khach=shop.cart.conf.user;var hasEnoughInfo=true;if(IS_CUSTOMER_LOGIN==0){if(khach.email==''||khach.mobile_phone==''||khach.city==0||khach.district==''){hasEnoughInfo=false;}}else{if(khach.email==''||khach.mobile_phone==''||khach.city==0||khach.district==''){hasEnoughInfo=false;}}
if(!hasEnoughInfo||shop.cart.conf.isAdminAddOrder){shop.cart.stepEditShippingInfoV201404();return;}
if(khach.district_id==0){var callback=function(){var districtList=shop.district.listDistrictDropdown;for(var i in districtList){if(districtList[i].title==khach.district){khach.district_id=i;shop.cart.conf.shipping.in_area=districtList[i].in_area;break;}}};shop.district.loadDistrict(khach.city,callback);}
var id='pop-ThongTinLienHe-v201404';var title='Thông tin liên hệ';var content=shop.cart.theme.stepZeroV201404(id,title);var options=shop.cart.createPopupOptions('900px');shop.show_overlay_popup(id,title,content,options);};shop.cart.theme.stepZeroV201404=function(id,title){var khach=shop.cart.conf.user;return shop.join('<div class="bl_3_BoxGen bl_3_BuyStore">')('<div class="bl_3_BoxHeader">')('<div class="bl_3_Step">')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_step_Active_Border">')('<div class="bl_3_step_Num bl_3_step_Num_Online">1</div>')('<div class="bl_3_step_Title_Online">')('<div>Chọn</div>')('<div><b>Hình thức thanh toán</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_step_Active">')('<div class="bl_3_step_Num bl_3_step_Num_Online">2</div>')('<div class="bl_3_step_Title_Online">')('<div>Nhập</div>')('<div><b>Thông tin cá nhân</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline">')('<div class="bl_3_step_Num bl_3_step_Num_Online">3</div>')('<div class="bl_3_step_Title_Online">')('<div>Chọn</div>')('<div><b>Hình thức nhận hàng</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_Nobackground">')('<div class="bl_3_step_Num bl_3_step_Num_Online">4</div>')('<div class="bl_3_step_Title_Online">')('<div>Xác nhận</div>')('<div><b>Đơn hàng</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="c"></div>')('</div>')('<a onclick="shop.hide_overlay_popup(\''+id+'\');" class="bl_3_Btn_Close" href="javascript:void(0)"></a>')('</div>')('<div class="bl_3_BoxBody">')('<div class="bl_3_StepInfo">')('<div class="bl_3_StepInfoBuild_Online">')('<div class="bl_3_StepInfoOnline_Title">Thông tin liên hệ</div>')('<div class="bl_3_StepInfoOnline_Contach">')('<div class="bl_3_StepInfoOnline_Line">')('<div class="bl_3_StepInfoOnline_LineTitle">Họ và tên: </div>')('<div class="bl_3_StepInfoOnline_LineText">'+khach.fullname+'</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_StepInfoOnline_Line">')('<div class="bl_3_StepInfoOnline_LineTitle">Điện thoại: </div>')('<div class="bl_3_StepInfoOnline_LineText">'+khach.mobile_phone+'</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_StepInfoOnline_Line">')('<div class="bl_3_StepInfoOnline_LineTitle">Email: </div>')('<div class="bl_3_StepInfoOnline_LineText">'+khach.email+'</div>')('<div class="c"></div>')('</div>')('</div>')('<div class="bl_3_StepInfoOnline_Title mTop20">')('<div>Địa chỉ giao nhận</div>')('</div>')('<div class="bl_3_StepInfoOnline_Contach">')('<div class="bl_3_StepInfoOnline_Line">')('<div class="bl_3_StepInfoOnline_LineTitle">Địa chỉ:</div>')('<div class="bl_3_StepInfoOnline_LineText">'+khach.address+'</div>')('<div class="c"></div>')('</div>')(khach.city==29?shop.join('<div class="bl_3_StepInfoOnline_Line">')('<div class="bl_3_StepInfoOnline_LineTitle">Xã/Phường:</div>')('<div class="bl_3_StepInfoOnline_LineText">'+khach.ward+'</div>')('<div class="c"></div>')('</div>')():'')('<div class="bl_3_StepInfoOnline_Line">')('<div class="bl_3_StepInfoOnline_LineTitle">Đường/Phố:</div>')('<div class="bl_3_StepInfoOnline_LineText">'+khach.street+'</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_StepInfoOnline_Line">')('<div class="bl_3_StepInfoOnline_LineTitle">Quận/Huyện: </div>')('<div class="bl_3_StepInfoOnline_LineText">'+khach.district+'</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_StepInfoOnline_Line">')('<div class="bl_3_StepInfoOnline_LineTitle">Tỉnh thành: </div>')('<div class="bl_3_StepInfoOnline_LineText">'+city_list[khach.city].title+'</div>')('<div class="c"></div>')('</div>')('</div>')('<div class="mTop20" style="'+(shop.is_ie()?'width:95%':'')+'">')('<a class="bl_3_StepInfoConfirm_charge fl mTop5" href="javascript:void(0)" onclick="shop.cart.stepEditShippingInfoV201404();"></a>')('<a class="bl_StepInfoOnline_continue" href="javascript:void(0)" onclick="shop.cart.processStepZeroV201404();"></a>')('<a class="bl_StepInfoOnline_back mRight15" href="javascript:void(0)" onclick="shop.cart.stepOneV201404();"></a>')('<div class="c"></div>')('</div>')('</div>')('<div class="c"></div>')('</div>')('</div>')('</div>')()};shop.cart.theme.stepOneV201404=function(id,title){var isTicket=shop.cart.conf.cart.cart.type==1;var browseCity=shop.cLib.getCity(true,0);var gold_only=shop.cart.conf.gold_only,no_cod=shop.cart.conf.no_cod,dis_cod=shop.cart.conf.dis_cod,change_province=0,only_coo=shop.cart.conf.only_coo;var is_thienxa=shop.cart.conf.cart.cart.item_type==10;if(shop.cart.conf.DisableCODProvinces!=''&&shop.cart.conf.DisableCODProvinces!='undefined'){for(var i in shop.cart.conf.DisableCODProvinces){if(shop.cart.conf.DisableCODProvinces[i]==browseCity){dis_cod=1;}}}
if(shop.cart.conf.ChangeProvinces!=null&&shop.cart.conf.ChangeProvinces.length>0){for(var i in shop.cart.conf.ChangeProvinces){if(shop.cart.conf.ChangeProvinces[i]==browseCity){change_province=1;}}}
if(shop.cart.isFreeDeal()){var isHotel=shop.cart.conf.cart.cart.type_tour==1;var payAt=isHotel?('Khách sạn '+shop.cart.conf.cart.cart.tour_caption):('Trung tâm tour '+shop.cart.conf.cart.cart.tour_caption);var type='go2tour';shop.cart.conf.cart.payment_id=type;shop.cart.conf.cart.payment=6;var tourFree=shop.join('<div class="paymentChooseType sendCoo'+(type=='go2tour'?' pay_active clicked':'')+'" id="go2tour" style="padding-left:10px;background:none">')('<div class="arrowRight pBottom10" style="background:none">')('<div class="radioBox"><input type="radio" name="radio_pay" id="radio_go2tour" value="go2tour" '+(type=='go2tour'?'checked':'')+' style="display:none" /></div>')('<div class="paymentContent">')('<div class="paymentTitle" style="font-size:15px">Thanh toán tại '+payAt+'</div>')('<div class="paymentText" style="font-size:15px;height:0px">&nbsp;</div>')('</div>')('<div class="c"></div>')('<ul style="font-size:15px;padding-left:5px" class="paymentText paymentGuide'+(type=='go2tour'?'':' hidden')+'">')('<li style="list-style:none">'+'Sau khi Quý khách đăng ký trên Muachung, '+(isHotel?'Khách sạn':'Trung tâm tour')+' sẽ liên hệ với Quý khách để hướng dẫn thanh toán và đặt phòng'+'</li>')('</ul>')('</div>')('</div>')();return shop.join('<div class="bl_3_BoxGen bl_3_BuyStore">')('<div class="bl_3_BoxHeader">')('<div class="bl_3_Step">')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_step_Active">')('<div class="bl_3_step_Num bl_3_step_Num_Online">1</div>')('<div class="bl_3_step_Title_Online">')('<div>Chọn</div>')('<div><b>Hình thức thanh toán</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline">')('<div class="bl_3_step_Num bl_3_step_Num_Online">2</div>')('<div class="bl_3_step_Title_Online">')('<div>Nhập</div>')('<div><b>Thông tin cá nhân</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline">')('<div class="bl_3_step_Num bl_3_step_Num_Online">3</div>')('<div class="bl_3_step_Title_Online">')('<div>Chọn</div>')('<div><b>Hình thức nhận hàng</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_Nobackground">')('<div class="bl_3_step_Num bl_3_step_Num_Online">4</div>')('<div class="bl_3_step_Title_Online">')('<div>Xác nhận</div>')('<div><b>Đơn hàng</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="c"></div>')('</div>')('<a onclick="shop.hide_overlay_popup(\''+id+'\'); shop.cart.logRD(shop.cart.conf.cart.cart.id, -1, \'đóng chọn hình thức thanh toán\', 1);" class="bl_3_Btn_Close" href="javascript:void(0)"></a>')('</div>')('<div class="bl_3_BoxBody">')('<div class="bl_3_StepBuildFrom_Payment">')('<div class="bl_3_StepInfo">')('<div class="bl_3_StepInfoBuild_Payment" style="padding-top:0">')('<div class="bl_3_StepInfoBuild_PaymentType bl_3_StepInfoBuild_Payment_Select" id="go2tour">')('<div class="bl_3_StepInfoBuild_Payment_Gold ">')('<div class="bl_3_StepInfoBuild_Payment_Radio">')('<input type="radio" name="radio_ship" id="payment_gold" value="go2tour" checked>')('<label for="payment_gold"><span></span></label>')('</div>')('<div class="bl_3_StepInfoBuild_Payment_RadioContent">')('<div class="bl_3_StepInfoBuild_Payment_Tit">Thanh toán tại '+payAt+'</div>')('<div class="bl_3_StepInfoBuild_Payment_Notice">Sau khi Quý khách đăng ký trên Muachung, '+(isHotel?'Khách sạn':'Trung tâm tour')+' sẽ liên hệ với Quý khách để hướng dẫn thanh toán và đặt phòng</div>')('</div>')('<div class="c"></div>')('</div>')('</div>')('</div>')('</div>')('<div align="right" class="mTop20 mRight25">')('<a class="bl_StepInfoOnline_continue" href="javascript:void(0)" onclick="shop.cart.processStepOneV201404();"></a>')('<div class="c"></div>')('</div>')('</div>	')('</div>')('</div>')();}
return shop.join('<div class="bl_3_BoxGen bl_3_BuyStore">')('<div class="bl_3_BoxHeader">')('<div class="bl_3_Step">')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_step_Active">')('<div class="bl_3_step_Num bl_3_step_Num_Online">1</div>')('<div class="bl_3_step_Title_Online">')('<div>Chọn</div>')('<div><b>Hình thức thanh toán</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline">')('<div class="bl_3_step_Num bl_3_step_Num_Online">2</div>')('<div class="bl_3_step_Title_Online">')('<div>Nhập</div>')('<div><b>Thông tin cá nhân</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline">')('<div class="bl_3_step_Num bl_3_step_Num_Online">3</div>')('<div class="bl_3_step_Title_Online">')('<div>Chọn</div>')('<div><b>Hình thức nhận hàng</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_Nobackground">')('<div class="bl_3_step_Num bl_3_step_Num_Online">4</div>')('<div class="bl_3_step_Title_Online">')('<div>Xác nhận</div>')('<div><b>Đơn hàng</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="c"></div>')('</div>')('<a onclick="shop.hide_overlay_popup(\''+id+'\'); shop.cart.logRD(shop.cart.conf.cart.cart.id, -1, \'đóng chọn hình thức thanh toán\', 1);" class="bl_3_Btn_Close" href="javascript:void(0)"></a>')('</div>')('<div class="bl_3_BoxBody">')('<div class="bl_3_StepBuildFrom_Payment">')('<div class="bl_3_StepInfo">')('<div class="bl_3_StepInfoBuild_Payment" style="padding-top:0">')((PAY_WITH_SOHAPAY&&!shop.cart.conf.isAdminAddOrder&&!gold_only&&!only_coo)?shop.join('<div class="bl_3_StepInfoBuild_PaymentType'+(shop.cart.conf.cart.payment_id=='visa'?' bl_3_StepInfoBuild_Payment_Select':'')+'" id="visa">')('<div class="bl_3_StepInfoBuild_Payment_ATM ">')('<div class="bl_3_StepInfoBuild_Payment_Radio">')('<input type="radio" name="radio_ship" id="payment_Atm" value="visa"'+(shop.cart.conf.cart.payment_id=='visa'?' checked':'')+'>')('<label for="payment_Atm"><span></span></label>')('</div>')('<div class="bl_3_StepInfoBuild_Payment_RadioContent">')('<div class="bl_3_StepInfoBuild_Payment_Tit">Thanh toán online qua Thẻ ATM, Visa/Master hoặc internet banking</div>')('<div class="bl_3_StepInfoBuild_Payment_Notice" style="position:relative">')(isTicket?'Nhận ngay mã số phiếu, không mất thêm bất kỳ phí nào khác. Áp dụng cho tất cả ngân hàng.':'Ưu tiên giao hàng trước, không mất thêm phí. Áp dụng cho tất cả các ngân hàng.')('</div>')('</div>')('<div class="c"></div>')('</div>')('</div>')():'')((PAY_WITH_GOLD&&!only_coo&&(!shop.cart.conf.isAdminAddOrder||(shop.cart.conf.isAdminAddOrder&&shop.cart.conf.isAdminAddOrderGold)))?shop.join('<div class="bl_3_StepInfoBuild_PaymentType'+(shop.cart.conf.cart.payment_id=='mcard'?' bl_3_StepInfoBuild_Payment_Select':'')+'" id="mcard">')('<div class="bl_3_StepInfoBuild_Payment_Gold ">')('<div class="bl_3_StepInfoBuild_Payment_Radio">')('<input type="radio" name="radio_ship" id="payment_gold" value="mcard"'+(shop.cart.conf.cart.payment_id=='mcard'?' checked':'')+'>')('<label for="payment_gold"><span></span></label>')('</div>')('<div class="bl_3_StepInfoBuild_Payment_RadioContent">')('<div class="bl_3_StepInfoBuild_Payment_Tit">Thanh toán bằng tiền từ ví Muachung</div>')(isTicket?shop.join('<div class="bl_3_StepInfoBuild_Payment_Notice"> Nạp tiền sẵn vào ví để mua dễ dàng và nhanh chóng mọi lúc mọi nơi. Nhận ngay mã số phiếu, dùng ngay dịch vụ. <a onclick="return shop.cart.aboutGold(event);" target="_blank" href="/trang-mua-hang-bang-gold.html">Xem thêm</a></div>')():shop.join('<div class="bl_3_StepInfoBuild_Payment_Notice">Nạp tiền sẵn vào ví để mua dễ dàng và nhanh chóng mọi lúc mọi nơi. Ưu tiên nhận sản phẩm trước. <a onclick="return shop.cart.aboutGold(event);" target="_blank" href="/trang-mua-hang-bang-gold.html">Xem thêm</a></div>')())('</div>')('<div class="c"></div>')('</div>')('</div>')():'')((!only_coo&&!gold_only&&!no_cod&&!dis_cod)?shop.join('<div class="bl_3_StepInfoBuild_PaymentType'+(shop.cart.conf.cart.payment_id=='cod'?' bl_3_StepInfoBuild_Payment_Select':'')+'" id="cod">')('<div class="bl_3_StepInfoBuild_Payment_Cod">')('<div class="bl_3_StepInfoBuild_Payment_Radio">')('<input type="radio" name="radio_ship" id="payment_cod_1" value="cod"'+(shop.cart.conf.cart.payment_id=='cod'?' checked':'')+'>')('<label for="payment_cod_1"><span></span></label>')('</div>')('<div class="bl_3_StepInfoBuild_Payment_RadioContent">')('<div class="bl_3_StepInfoBuild_Payment_Tit">Muachung thu tiền tận nơi</div>')(!isTicket?shop.join('<div class="bl_3_StepInfoBuild_Payment_Notice bl_3_StepInfoBuild_Payment_NoticeFixWidth">Trong vòng <b>'+shop.cart.getDayWillCODDone(shop.cAddress.conf.currentAddress.city)+'</b> ngày làm việc, Muachung sẽ đến thu tiền và giao sản phẩm tại địa chỉ của Quý khách.</div>')():shop.join('<div class="bl_3_StepInfoBuild_Payment_Notice bl_3_StepInfoBuild_Payment_NoticeFixWidth">Trong vòng <b>'+shop.cart.getDayWillCODDone(shop.cAddress.conf.currentAddress.city)+'</b> ngày làm việc, Muachung sẽ đến thu tiền tại địa chỉ Quý khách. Quý khách sẽ được nhận mã số phiếu qua điện thoại và email, dùng ngay dịch vụ sau khi thanh toán.</div>')())('</div>')('<div class="c"></div>')('</div>')('</div>')():'')((shop.cart.conf.cart.cart.item_type==7||change_province)?'':shop.join('<div onclick="shop.cart.setBuyType(\'vanphong\');shop.cart.stepLenVanPhong(2)" class="bl_3_StepInfoBuild_PaymentType'+(shop.cart.conf.cart.payment_id=='office'?' bl_3_StepInfoBuild_Payment_Select':'')+'" id="office">')('<div class="bl_3_StepInfoBuild_Payment_Office">')('<div class="bl_3_StepInfoBuild_Payment_Radio">')('<input type="radio" name="radio_ship" id="payment_office_1" value="office"'+(shop.cart.conf.cart.payment_id=='office'?' checked':'')+'>')('<label for="payment_office_1"><span></span></label>')('</div>')('<div class="bl_3_StepInfoBuild_Payment_RadioContent" >')('<div class="bl_3_StepInfoBuild_Payment_Tit">Thanh toán bằng tiền mặt tại cửa hàng Muachung</div>')(isTicket?shop.join('<div class="bl_3_StepInfoBuild_Payment_Notice bl_3_StepInfoBuild_Payment_NoticeFixWidth">Khách hàng đến cửa hàng của Muachung tại '+city_list[browseCity].title+' để thanh toán và nhận mã số phiếu điện tử.</div>')():shop.join('<div class="bl_3_StepInfoBuild_Payment_Notice bl_3_StepInfoBuild_Payment_NoticeFixWidth">Khách hàng đến cửa hàng của Muachung tại '+city_list[browseCity].title+' để thanh toán và nhận sản phẩm.</div>')())('</div>')('<div class="c"></div>')('</div>')('</div>')())('</div>')('</div>')('<div align="right" class="mTop20 mRight25">')('<a class="bl_StepInfoOnline_continue" href="javascript:void(0)" onclick="shop.cart.processStepOneV201404();"></a>')('<div class="c"></div>')('</div>')('</div>	')('</div>')('</div>')();};shop.cart.theme.stepTwoV201404=function(id,title){var sanpham=shop.cart.conf.cart.cart;var guest=shop.cart.conf.user;var isTicket=shop.cart.conf.cart.cart.type==1;var isHang=shop.cart.conf.cart.cart.type==2;var isPhieuGiay=typeof shop.cart.conf.cart.cart.is_paper!=='undefined'&&shop.cart.conf.cart.cart.is_paper=='1';var httt=shop.cart.conf.cart.payment_id;var supportShip=shop.cart.conf.cart.cart.fee_shipping>=0&&shop.cart.conf.cart.cart.note!='';var isFreeShip=shop.cart.conf.cart.cart.fee_shipping=='0'&&shop.cart.conf.cart.cart.note!='';var isHangKhongShip=isHang&&shop.cart.conf.no_cod;var isNotSupportCOD=shop.cart.conf.dis_cod;var isSupportOnlyCOO=shop.cart.conf.only_coo;var isSupportOnlyGold=shop.cart.conf.gold_only;var is_cod=(httt=='cod');var is_ship=supportShip;var nhanHang=shop.cart.conf.shipping.codShipType=='product';var nhanPhieu=shop.cart.conf.shipping.codShipType=='coupon';if(shop.cart.isProvinceDeal()){var objFee=shop.cart.getPriceProvince(guest.city);if(objFee!==false){sanpham.price=sanpham.price_base+objFee.fee_local;sanpham.price_f=shop.numberFormat(sanpham.price)+'đ';sanpham.fee_shipping=objFee.fee_shipping;shop.cart.conf.shipping.fee=objFee.fee_shipping;}}
var textShipFee=isFreeShip?'Miễn phí':('Phí '+(shop.numberFormat(sanpham.fee_shipping)+'đ'));var isTicket=(shop.cart.conf.cart.cart.type==1);var nhanHangTaiVP=typeof shop.cart.conf.cart.cart.is_mc!=='undefined'&&shop.cart.conf.cart.cart.is_mc==0;var browseCity=shop.cLib.getCity(true,0);var officeList=shop.cart.conf.office[browseCity];var dsVanPhong='';if(nhanHangTaiVP){var i;for(i in officeList){var tinhtranghang='',color='#666666';var vanphong=officeList[i];if(typeof vanphong==='function')continue;if(typeof shop.cart.conf.store!=='undefined'&&typeof shop.cart.conf.store[vanphong.id]!=='undefined'){if(shop.cart.conf.store[vanphong.id].total>0){tinhtranghang='Còn hàng';color='#FE1A19';}else{tinhtranghang='Hàng đang về';}}else{tinhtranghang='Hàng đang về';}
dsVanPhong+=shop.join('<div id="lenVPLayHang" class="bl_3_StepInfo_Store">')('<div class="bl_3_StepInfo_Radio">')('<input type="radio" value="'+vanphong.id+'" id="x_office'+vanphong.id+'" name="payment_Store">')('</div>')('<div class="bl_3_StepInfo_Radio_Text">')('<div class="bl_3_StepInfo_NameStore_PaymentType"><label class="lblHand" for="x_office'+vanphong.id+'">'+vanphong.name+'</label><span style="color:'+color+'"> ('+tinhtranghang+')</span>')('</div>')('<div class="bl_3_StepInfo_Adr_PaymentType">'+vanphong.address+'</div>')('</div>')('<div class="c"></div>')('</div>')();}}
var options=[];var option='';var hasTwo=false,change_province=0;var noteDefault='Nếu Quý khách có yêu cầu đặc biệt, vui lòng thêm thông tin để Muachung phục vụ tốt hơn';if(shop.cart.conf.ChangeProvinces!=null&&shop.cart.conf.ChangeProvinces.length>0){for(var i in shop.cart.conf.ChangeProvinces){if(shop.cart.conf.ChangeProvinces[i]==guest.city){change_province=1;}}}
if(!is_cod){if(!isTicket){if(is_ship){var hangHayPhieuGiay='hàng';if(typeof shop.cart.conf.cart.cart.is_paper!=='undefined'&&shop.cart.conf.cart.cart.is_paper=='1'){hangHayPhieuGiay='phiếu giấy';}
option=shop.join('<div class="bl_3_StepInfoBuild_PaymentType'+(nhanHang?' bl_3_StepInfoBuild_Payment_Select':'')+'">')('<div class="bl_3_StepInfoBuild_Payment_Cod">')('<div class="bl_3_StepInfoBuild_Payment_Radio">')('<input type="radio" name="radio_ship" id="ship_product" value="product"'+(nhanHang?' checked':'')+'>')('<label for="ship_product"><span></span></label>')('</div>')('<div class="bl_3_StepInfoBuild_Payment_RadioContent">')('<div class="bl_3_StepInfoBuild_Payment_Tit">Giao '+hangHayPhieuGiay+' tại nhà <span>('+textShipFee+')</span></div>')('<div class="bl_3_StepInfoBuild_Payment_Notice bl_3_StepInfoBuild_Payment_NoticeFixWidth">Thời gian giao hàng từ '+shop.cart.getDayWillCODDone(shop.cAddress.conf.currentAddress.city)+' ngày làm việc</div>')('<div class="mTop10">')('<textarea class="bl_3_StepInfo_textarea" id="cart_note" name="note" title="'+noteDefault+'" onblur="if(this.value==\'\') this.value=this.title;jQuery(this).removeClass(\'black\')" onfocus="if(this.value==this.title) this.value=\'\';jQuery(this).addClass(\'black\')">'+(shop.cart.conf.user.note!=''?shop.cart.conf.user.note:noteDefault)+'</textarea>')('</div>')('</div>')('<div class="c"></div>')('</div>')('</div>')();options.push(option);hasTwo=true;}
hasTwo=true;if(!isPhieuGiay&&shop.cart.conf.cart.cart.couponName!=''&&!change_province){option=shop.join('<div class="bl_3_StepInfoBuild_PaymentType'+((!hasTwo||nhanPhieu)?' bl_3_StepInfoBuild_Payment_Select':'')+'">')('<div class="bl_3_StepInfoBuild_Payment_COO">')('<div class="bl_3_StepInfoBuild_Payment_Radio">')('<input type="radio" name="radio_ship" id="ship_coupon" value="coupon"'+((!hasTwo||nhanPhieu)?' checked':'')+'>')('<label for="ship_coupon"><span></span></label>')('</div>')('<div class="bl_3_StepInfoBuild_Payment_RadioContent">')('<div class="bl_3_StepInfoBuild_Payment_Tit">Đến nhận tại cửa hàng</div>')('<div class="bl_3_StepInfoBuild_Payment_Notice bl_3_StepInfoBuild_Payment_NoticeFixWidth">Muachung gửi Mã số phiếu để Quý khách tự đi lấy hàng</div>')('</div>')('<div class="c"></div>')('</div>')('</div>')();options.push(option);}}else{option=shop.join('<div style="border: none" class="bl_3_StepInfoBuild_PaymentType bl_3_StepInfoBuild_Payment_Select">')('<div class="bl_3_StepInfoBuild_Payment_SMS">')('<div class="bl_3_StepInfoBuild_Payment_Radio">')('<input type="radio" name="radio_ship" id="ship_coupon" value="coupon" checked>')('<label for="ship_coupon"><span></span></label>')('</div>')('<div class="bl_3_StepInfoBuild_Payment_RadioContent">')('<div class="bl_3_StepInfoBuild_Payment_Tit">Nhận mã số phiếu qua Email, SMS</div>')('<div class="bl_3_StepInfoBuild_Payment_Notice bl_3_StepInfoBuild_Payment_NoticeFixWidth">')('<div>Bạn sẽ nhận được mã số phiếu qua SMS và Email ngay sau khi thanh toán thành công.</div>')('<div>Hãy mang theo mã số này để cung cấp khi sử dụng dịch vụ.</div>')('</div>')('</div>')('<div class="c"></div>')('</div>')('</div>')();options.push(option);}}else{if(is_ship){var hangHayPhieuGiay='hàng';if(typeof shop.cart.conf.cart.cart.is_paper!=='undefined'&&shop.cart.conf.cart.cart.is_paper=='1'){hangHayPhieuGiay='phiếu giấy';}
option=shop.join('<div class="bl_3_StepInfoBuild_PaymentType bl_3_StepInfoBuild_Payment_Select">')('<div class="bl_3_StepInfoBuild_Payment_Cod">')('<div class="bl_3_StepInfoBuild_Payment_Radio">')('<input type="radio" name="radio_ship" id="ship_product" value="product" checked>')('<label for="ship_product"><span></span></label>')('</div>')('<div class="bl_3_StepInfoBuild_Payment_RadioContent">')('<div class="bl_3_StepInfoBuild_Payment_Tit">Giao '+hangHayPhieuGiay+' tại nhà <span>('+textShipFee+')</span></div>')('<div class="bl_3_StepInfoBuild_Payment_Notice bl_3_StepInfoBuild_Payment_NoticeFixWidth">Thời gian giao hàng từ '+shop.cart.getDayWillCODDone(shop.cAddress.conf.currentAddress.city)+' ngày làm việc</div>')('<div class="mTop10">')('<textarea class="bl_3_StepInfo_textarea" id="cart_note" name="note" title="'+noteDefault+'" onblur="if(this.value==\'\') this.value=this.title;jQuery(this).removeClass(\'black\')" onfocus="if(this.value==this.title) this.value=\'\';jQuery(this).addClass(\'black\')">'+(shop.cart.conf.user.note!=''?shop.cart.conf.user.note:noteDefault)+'</textarea>')('</div>')('</div>')('<div class="c"></div>')('</div>')('</div>')();options.push(option);}else{option=shop.join('<div style="border: none" class="bl_3_StepInfoBuild_PaymentType bl_3_StepInfoBuild_Payment_Select">')('<div class="bl_3_StepInfoBuild_Payment_Cod">')('<div class="bl_3_StepInfoBuild_Payment_Radio">')('<input type="radio" name="radio_ship" id="ship_coupon" value="coupon" checked>')('<label for="ship_coupon"><span></span></label>')('</div>')('<div class="bl_3_StepInfoBuild_Payment_RadioContent">')('<div class="bl_3_StepInfoBuild_Payment_Tit">Muachung giao phiếu và thu tiền <span>(Miễn phí)</span></div>')('<div class="bl_3_StepInfoBuild_Payment_Notice bl_3_StepInfoBuild_Payment_NoticeFixWidth">Trong vòng '+shop.cart.getDayWillCODDone(shop.cAddress.conf.currentAddress.city)+' ngày, Muachung sẽ đến địa chỉ của bạn để thu tiền và gửi mã số phiếu qua Email/SMS</div>')('<div class="mTop10">')('<textarea class="bl_3_StepInfo_textarea" id="cart_note2" name="note" title="'+noteDefault+'" onblur="if(this.value==\'\') this.value=this.title;jQuery(this).removeClass(\'black\')" onfocus="if(this.value==this.title) this.value=\'\';jQuery(this).addClass(\'black\')">'+(shop.cart.conf.user.note!=''?shop.cart.conf.user.note:noteDefault)+'</textarea>')('</div>')('</div>')('<div class="c"></div>')('</div>')('</div>')();options.push(option);}}
shop.cart.conf.nbReceiveOptions=options.length;options=options.join("\n");var backbt='<a class="bl_StepInfoOnline_back mRight15" href="javascript:void(0)" onclick="shop.cart.stepEditShippingInfoV201404();"></a>';return shop.join('<div class="bl_3_BoxGen bl_3_BuyStore">')('<div class="bl_3_BoxHeader">')('<div class="bl_3_Step">')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_step_Active_Border">')('<div class="bl_3_step_Num bl_3_step_Num_Online">1</div>')('<div class="bl_3_step_Title_Online">')('<div>Chọn</div>')('<div><b>Hình thức thanh toán</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_step_Active_Border">')('<div class="bl_3_step_Num bl_3_step_Num_Online">2</div>')('<div class="bl_3_step_Title_Online">')('<div>Nhập</div>')('<div><b>Thông tin cá nhân</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_step_Active">')('<div class="bl_3_step_Num bl_3_step_Num_Online">3</div>')('<div class="bl_3_step_Title_Online">')('<div>Chọn</div>')('<div><b>Hình thức nhận hàng</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_Nobackground">')('<div class="bl_3_step_Num bl_3_step_Num_Online">4</div>')('<div class="bl_3_step_Title_Online">')('<div>Xác nhận</div>')('<div><b>Đơn hàng</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="c"></div>')('</div>')('<a onclick="shop.cart.logRD(shop.cart.conf.cart.cart.id, -6, \'đóng chọn hình thức nhận hàng\', 1);shop.hide_overlay_popup(\''+id+'\');" class="bl_3_Btn_Close" href="javascript:void(0)"></a>')('</div>')('<div class="bl_3_BoxBody">')('<div class="bl_3_StepBuildFrom_Payment">')('<div class="bl_3_StepInfo">')('<div class="bl_3_StepInfoBuild_Payment" style="padding-top: 0px">')(options)('</div>')('</div>')('<div align="right" class="mTop15 mRight25">')('<a class="bl_StepInfoOnline_continue" href="javascript:void(0)" onclick="shop.cart.processStepTwoV201404();"></a>')(backbt)('<div class="c"></div>')('</div>')('</div>	')('</div>')('</div>')();};shop.cart.theme.stepThreeV201404=function(id,title){var sanpham=shop.cart.conf.cart.cart;var nhanHang=shop.cart.conf.shipping.codShipType=='product';var nhanPhieu=shop.cart.conf.shipping.codShipType=='coupon';var guest=shop.cart.conf.user;var customer=shop.cart.conf.customer;var httt=shop.cart.conf.cart.payment_id;if(shop.cart.isProvinceDeal()){var objFee=shop.cart.getPriceProvince(guest.city);if(objFee!==false){sanpham.price=sanpham.price_base+objFee.fee_local;sanpham.price_f=shop.numberFormat(sanpham.price)+'đ';sanpham.fee_shipping=objFee.fee_shipping;shop.cart.conf.shipping.fee=objFee.fee_shipping;}}
var isTicket=shop.cart.conf.cart.cart.type==1;var isHang=shop.cart.conf.cart.cart.type==2;var isPhieuGiay=typeof shop.cart.conf.cart.cart.is_paper!=='undefined'&&shop.cart.conf.cart.cart.is_paper=='1';var num=parseInt(shop.cart.conf.cart.numberOtp);var vatOne=0;if(sanpham.vat>0&&sanpham.vat_type==0){vatOne=sanpham.vat*sanpham.price/100;vatOne=vatOne%500==0?vatOne:(Math.floor(vatOne/500)+1)*500;}else if(sanpham.fee_ncc>0){vatOne=sanpham.fee_ncc;}
var shipOne=0;if(sanpham.fee_shipping>0&&nhanHang){shipOne=parseInt(sanpham.fee_shipping);}
var total=num*(parseInt(sanpham.price)+vatOne+shipOne);var textPointPlus=shop.numberFormat(Math.round(total/1000));var textHTTT='N/A';if(httt=='visa'){textHTTT='Thanh toán Online';}else if(httt=='mcard'){textHTTT='Ví MuaChung';}else if(httt=='cod'){textHTTT='Thu tiền tận nơi';}else if(httt=='go2tour'){textHTTT='Thanh toán tại '+(shop.cart.conf.cart.cart.type_tour==1?('Khách sạn '+shop.cart.conf.cart.cart.tour_caption):('Trung tâm tour '+shop.cart.conf.cart.cart.tour_caption));}
var textHinhThucNhanHang='Muachung giao phiếu và thu tiền';if(nhanHang){if(isPhieuGiay){if(httt=='cod'){textHinhThucNhanHang='Muachung giao phiếu';}else{textHinhThucNhanHang='Muachung giao phiếu';}}else{if(httt=='cod'){textHinhThucNhanHang='Muachung giao hàng tại nhà';}else{textHinhThucNhanHang='Muachung giao hàng tại nhà';}}}else if(nhanPhieu){if(isHang){textHinhThucNhanHang='Quý khách tự đi lấy hàng';}else{textHinhThucNhanHang='MuaChung gửi mã số phiếu qua SMS/Email';}}
var textGoldAfterOrder=shop.numberFormat(shop.cart.conf.customer.gold-total)+'đ';var hasEnoughGold=(shop.cart.conf.customer.gold-total)>=0;var info_user='';var newWardInfo='';var address='';if(!shop.district.isCityNotRequireWardInfo(shop.cart.conf.user.city)){newWardInfo='/'+shop.cart.conf.user.ward;}
if(shop.cart.conf.cart.cart.type==1&&(shop.cart.conf.cart.payment_id=='mcard'||shop.cart.conf.cart.payment_id=='visa')){info_user='<div class="bl_3_StepBuildFrom_Confirmed">'+'<div class="bl_3_StepBuild_Confirmed" onmouseover="shop.header.profileNew.menuHover(this,true,9)" onmouseout="shop.header.profileNew.menuHover(this,false,9)">'+'<div class="bl_3_StepBuild_Confirmed_Info">'+'<div class="bl_3_StepBuild_Confirmed_Content">'+'<div class="bl_3_StepInfoOnline_Title mBottom10">Thông tin Khách hàng</div>'+'<div class="bl_3_StepInfoConfirm_TitCon">Họ tên: <span>'+guest.fullname+'</span></div>'+'<div class="bl_3_StepInfoConfirm_TitCon">Email: <span>'+guest.email+'</span></div>'+'<div class="bl_3_StepInfoConfirm_TitCon">Điện thoại: <span>'+guest.mobile_phone+'</span></div>'+'</div>'+'<div class="bl_3_StepBuild_Confirmed_Update hidden v7_remove_Class">'+'<a class="bl_3_StepInfoConfirm_charge" href="javascript:void(0)" onclick="shop.cart.conf.nhap_ttcn_referer = \'xac-nhan\';shop.cart.stepEditShippingInfoV201404();"></a>'+'</div>'+'<div class="c"></div>'+'</div>'+'</div>';}else{address=shop.cart.conf.user.address+' ('+shop.cart.conf.user.street+newWardInfo+'/'+shop.cart.conf.user.district+'/'+city_list[shop.cart.conf.user.city].title+')';info_user='<div class="bl_3_StepBuildFrom_Confirmed">'+'<div class="bl_3_StepBuild_Confirmed" onmouseover="shop.header.profileNew.menuHover(this,true,9)" onmouseout="shop.header.profileNew.menuHover(this,false,9)">'+'<div class="bl_3_StepBuild_Confirmed_Info">'+'<div class="bl_3_StepBuild_Confirmed_Content">'+'<div class="bl_3_StepInfoOnline_Title mBottom10">Thông tin Khách hàng</div>'+'<div class="bl_3_StepInfoConfirm_TitCon">Họ tên: <span>'+guest.fullname+'</span></div>'+'<div class="bl_3_StepInfoConfirm_TitCon">Email: <span>'+guest.email+'</span></div>'+'<div class="bl_3_StepInfoConfirm_TitCon">Điện thoại: <span>'+guest.mobile_phone+'</span></div>'+'<div class="bl_3_StepInfoConfirm_TitCon">Địa chỉ: <span>'+address+'</span></div></div>'+'<div class="bl_3_StepBuild_Confirmed_Update hidden v7_remove_Class">'+'<a class="bl_3_StepInfoConfirm_charge" href="javascript:void(0)" onclick="shop.cart.conf.nhap_ttcn_referer = \'xac-nhan\';shop.cart.stepEditShippingInfoV201404();"></a>'+'</div>'+'<div class="c"></div>'+'</div>'+'</div>';}
var boxSoLuong='';var nMin=parseInt(sanpham.min_order);var nMax=parseInt(sanpham.max_order);for(var i=nMin;i<=nMax;i++){if(i==num){curSelect=' selected';}else{curSelect='';}
boxSoLuong+='<option value="'+i+'"'+curSelect+'>'+i+'</option>';}
var hasSize=shop.cart.conf.meta.size.length>0;var hasColor=shop.cart.conf.meta.color.length>0;var nbColumn=5+(hasSize?1:0)+(hasColor?1:0);var colorImg='',sizeText='';if(hasColor){var colorId=shop.cart.conf.meta.color[0].id;colorImg=$('#metaColorId-'+colorId).attr('src');}
if(hasSize){var sizeId=shop.cart.conf.meta.size[0].id;sizeText=$('#metaSizeId-'+sizeId).attr('title');;}
return shop.join('<div class="bl_3_BoxGen bl_3_BuyStore">')('<div class="bl_3_BoxHeader">')('<div class="bl_3_Step">')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_step_Active_Border">')('<div class="bl_3_step_Num bl_3_step_Num_Online">1</div>')('<div class="bl_3_step_Title_Online">')('<div>Chọn</div>')('<div><b>Hình thức thanh toán</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_step_Active_Border">')('<div class="bl_3_step_Num bl_3_step_Num_Online">2</div>')('<div class="bl_3_step_Title_Online">')('<div>Nhập</div>')('<div><b>Thông tin cá nhân</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_step_Active_Border">')('<div class="bl_3_step_Num bl_3_step_Num_Online">3</div>')('<div class="bl_3_step_Title_Online">')('<div>Chọn</div>')('<div><b>Hình thức nhận hàng</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_Nobackground bl_3_step_Active">')('<div class="bl_3_step_Num bl_3_step_Num_Online">4</div>')('<div class="bl_3_step_Title_Online">')('<div>Xác nhận</div>')('<div><b>Đơn hàng</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="c"></div>')('</div>')('<a onclick="shop.cart.logRD(shop.cart.conf.cart.cart.id, -7, \'đóng xác nhận đơn hàng\', 1);shop.hide_overlay_popup(\''+id+'\');" class="bl_3_Btn_Close" href="javascript:void(0)"></a>')('</div>')('<div class="bl_3_BoxBody">')(info_user)('<div class="bl_3_StepBuild_Confirmed"  onmouseover="shop.header.profileNew.menuHover(this,true,10)" onmouseout="shop.header.profileNew.menuHover(this,false,10)">')('<div class="bl_3_StepBuild_Confirmed_Info" >')('<div class="bl_3_StepBuild_Confirmed_Content" >')('<div class="bl_3_StepInfoOnline_Title">Hình thức thanh toán <span>'+textHTTT+'</span></div>')(httt=='mcard'?shop.join('<ul class="bl_3_StepInfoConfirm_Note">')('<li>')('<div class="bl_3_StepInfoConfirm_existent">Bạn đang có: <span>'+shop.numberFormat(shop.cart.conf.customer.gold)+'đ'+'</span></div>')('</li>')(hasEnoughGold?shop.join('<li id="goldInfo">')('<div class="bl_3_StepInfoConfirm_remaining">Số tiền còn lại sau khi thanh toán: <span>'+textGoldAfterOrder+'</span></div>')('</li>')():shop.join('<li id="goldInfo">')('<div class="bl_3_StepInfoConfirm_remaining" style="color:red">Bạn cần nạp thêm tiền vào ví để mua sản phẩm này</div>')('</li>')())('</ul>')():'')('<div id="goldRechargeButton" '+((httt=='mcard'&&!hasEnoughGold)?'':'style="display:none"')+' class="bl_3_StepInfoConfirm_Box_recharge_New">')('<a class="bl_3_StepInfoConfirm_recharge" href="javascript:void(0)" onclick="shop.gold.rechargeStep1()"></a>')('</div>')('</div>')('<div class="bl_3_StepInfoConfirm_Box_recharge v7_remove_Class m0 hidden">')('<a class="bl_3_StepInfoConfirm_charge bl_3_StepInfoOnline_EditInfoHover" href="javascript:void(0)" onclick="shop.cart.stepOneV201404();"></a>')('</div>')('<div class="c"></div>')('</div>')('</div>')('<div class="bl_3_StepBuild_Confirmed" onmouseover="shop.header.profileNew.menuHover(this,true,11)" onmouseout="shop.header.profileNew.menuHover(this,false,11)" >')('<div class="bl_3_StepBuild_Confirmed_Info">')('<div class="bl_3_StepBuild_Confirmed_Content">')('<div class="bl_3_StepInfoOnline_Title">Hình thức nhận hàng <span>'+textHinhThucNhanHang+'</span></div>')('</div>')(shop.cart.conf.nbReceiveOptions>1?shop.join('<div class="bl_3_StepInfoConfirm_Box_recharge m0 v7_remove_Class hidden">')('<a class="bl_3_StepInfoConfirm_charge bl_3_StepInfoOnline_EditInfoHover" href="javascript:void(0)" onclick="shop.cart.stepTwoV201404();"></a>')('</div>')():'')('<div class="c"></div>')('</div>')('</div>')('<div class="bl_3_StepBuild_Confirmed_Product">')('<div class="bl_3_StepBuild_Confirmed_Info">')('<div class="bl_3_StepInfoOnline_Title mBottom15">Thông tin sản phẩm</div>')('<table width="100%" border="0" cellspacing="0" cellpadding="0" class="bl_3_StepInfoConfirmed_Pro">')('<tbody><tr>')('<th class="bl_3_Step_TH bl_3_borderNone">Sản phẩm</th>')(hasColor?'<th width="55" class="bl_3_Step_TH" alight="center">Màu</th>':'')(hasSize?'<th width="45" class="bl_3_Step_TH" alight="center">Cỡ</th>':'')('<th class="bl_3_Step_TH">Giá bán</th>')('<th width="80" class="bl_3_Step_TH">Số lượng</th>')('<th width="80" class="bl_3_Step_TH">'+(shop.cart.conf.cart.cart.item_type=='2'?'Phí ship':'Thuế, Phí')+'</th>')('<th width="105" class="bl_3_Step_TH">Tổng tiền</th>')('</tr>')('<tr>')('<td class="bl_3_Step_TH bl_3_borderNone bl_3_Step_TH_Font">'+sanpham.title+(shop.cart.isSizeColorDeal()?(' - '+shop.cart.conf.metaInfo[0].sizecolor):'')+'</td>')(hasColor?'<td class="bl_3_Step_TH bl_3_Step_TH_Font" alight="center"><img style="border:1px solid #FFF" src="'+colorImg+'" width="35" height="35"/></td>':'')(hasSize?'<td class="bl_3_Step_TH bl_3_Step_TH_Font" alight="center">'+sizeText+'</td>':'')('<td class="bl_3_Step_TH bl_3_Step_TH_Font">'+sanpham.price_f+'/'+sanpham.code+'</td>')('<td class="bl_3_Step_TH bl_3_Step_TH_Font">')('<input type="hidden" id="shipBuocCuoi" value="'+(vatOne+shipOne)+'">')('<select id="soluongBuocCuoi" style="width:50px;padding:3px 5px" onchange="shop.cart.calculateMoney(\'xac-nhan\');">')(boxSoLuong)('</select>')('</td>')('<td class="bl_3_Step_TH bl_3_Step_TH_Font" id="tongshipBuocCuoi">'+shop.numberFormat(vatOne+shipOne)+'đ'+'</td>')('<td class="bl_3_Step_TH bl_3_Step_TH_Total" id="tongtienBuocCuoi">'+shop.numberFormat(total)+'đ'+'</td>')('</tr>')('<tr>')('<td colspan="'+nbColumn+'" align="right" style="border-top:1px solid #E0E8EC;background-color:#FFF;color:#ff5a00">')('<div class="mTop15 mBottom10 mRight15 f13" style="font-style: normal">Được thưởng <b>'+textPointPlus+'</b> điểm khi thanh toán <a style="font-size:13px;font-style:normal;color:#0E71B4;text-decoration:none" href="/thong-bao/p-43/tich-luy-diem-thuong-khi-mua-sam-tren-muachung-vn.html" target="_blank">Điểm thưởng là gì?</a></div>')('</td>')('</tr>')('</tbody></table>')((httt=='mcard'&&(!shop.cart.conf.isAdminAddOrder||(shop.cart.conf.isAdminAddOrder&&!shop.cart.conf.isAdminAddOrderGold)))?shop.join('<div class="bl_3_Step_Confirmed_Pass">')('Vui lòng <b>nhập mật khẩu</b> tài khoản để bảo đảm an toàn khi thanh toán bằng Ví Muachung')(' <input class="input_textfield" id="order_gold_passconfirm" type="password" name="pass">')('</div>')():'')(httt=='visa'&&guest.type=='guest'?shop.join('<div class="bl_3_Step_Confirmed_Pass">')('<label for="check-regulations">')('Tôi đã đọc và đồng ý với các <a href="trang-the-le.html" target="_blank">điều khoản</a> và <a href="trang-quy-dinh-refund.html"  target="_blank">quy định</a> của MuaChung.vn')('</label>')('<input type="checkbox" id="check-regulations" class="checkbox" checked />')('</div>')():'')('</div>')('</div>')('<div class="bl_3_StepBuild_Confirmed_Product">')('<div class="bl_3_StepBuild_Confirmed_Info">')('<div class="bl_3_StepBuild_Confirmed_Book">')('<a href="javascript:void(0)" class="fr m0 bt_3_StepInfo_BookBuy" onclick="shop.cart.processStepThreeV201404();"></a>')('<a class="bl_StepInfoOnline_back mRight15" style="margin-top:7px" href="javascript:void(0)" onclick="shop.cart.stepTwoV201404();"></a>')('<div class="c"></div>')('</div>')('<div class="c"></div>')('</div>')('</div>')('</div>')('</div>')('</div>')();};shop.cart.theme.stepEditShippingInfoV201404=function(id,title){var currentAddress=shop.cAddress.conf.currentAddress;var province_notice='',province_active={};var opt1='',opt2='';for(var i in city_list){if(city_list[i].status==1){opt1+='<option value="'+city_list[i].id+'"'+(currentAddress.city==i?' selected':'')+'>'+city_list[i].title+'</option>';province_active[i]=city_list[i].title;}else{opt2+='<option value="'+city_list[i].id+'"'+(currentAddress.city==i?' selected':'')+'>'+city_list[i].title+'</option>';}}
var cityList='<select class="bl_3_StepInfoOnline_SelectArd" name="city" id="cart_city" onchange="shop.cart.loadStreetToSuggest(this);shop.district.loadDistrictDropdown(this.value, \'listDistrict\', shop.cart.theme.changeCity, \''+currentAddress.district+'\')">';cityList+=shop.join('<option value="0">--- Chọn Tỉnh/Thành ---</option>')('<optgroup label="Tỉnh/Thành có VP MuaChung">'+opt1+'</optgroup>')('<optgroup label="Các Tỉnh/Thành khác">'+opt2+'</optgroup>')('</select>')();if(shop.cart.conf.cart.cart.disable_province.length>0){for(var i=0;i<shop.cart.conf.cart.cart.disable_province.length;i++){if(shop.is_exists(province_active[shop.cart.conf.cart.cart.disable_province[i]])){province_active[shop.cart.conf.cart.cart.disable_province[i]]=null;delete province_active[shop.cart.conf.cart.cart.disable_province[i]];}}
for(var i in province_active){if(province_notice!=''){province_notice+=', ';}
province_notice+='<span>'+province_active[i]+'</span>';}
if(province_notice!=''){shop.cart.conf.province_active=province_active;province_notice='<div class="province_notice">Chỉ áp dụng tại: '+province_notice+'</div>';}}
var diachi="";if(shop.cart.conf.cart.cart.type==1&&(shop.cart.conf.cart.payment_id=='mcard'||shop.cart.conf.cart.payment_id=='visa')){}else{diachi='<div class="bl_3_StepInfo_From_Title mTop10">Địa chỉ nhận hàng</div>'+'<div class="bl_3_StepInfo_From_TextField mTop15">'+'<div class="bl_3_StepInfo_Row">'+'<div class="bl_3_StepInfo_Row_Title">Số nhà:</div>'+'<div class="bl_3_StepInfo_Row_Input"><input type="text" id="cart_address" name="address" value="'+currentAddress.address+'"></div>'+'<div class="c"></div>'+'</div>'+'<div class="bl_3_StepInfo_Row">'+'<div class="bl_3_StepInfo_Row_Title">Đường/Phố</div>'+'<div class="bl_3_StepInfo_Row_Input"><input type="text" onchange="shop.cart.loadDistrictByStreetName(this.value)" onfocus="shop.cart.loadStreetToSuggest('+currentAddress.city+');"  id="cart_street" name="duongpho" value="'+currentAddress.street+'"></div>'+'<div class="c"></div>'+'</div>'+'<div class="bl_3_StepInfo_Row">'+'<div class="bl_3_StepInfo_Row_Title" id="wardTitle">Xã/Phường:</div>'+'<div class="bl_3_StepInfo_Row_Input">'+'<select id="cart_newWard" name="card_newWard" class="bl_3_StepInfoOnline_SelectArd"></select>'+'</div>'+'<div class="c"></div>'+'</div>'+'<div class="bl_3_StepInfo_Row">'+'<div class="bl_3_StepInfo_Row_Title" id="disTitle">Quận/Huyện:</div>'+'<div class="bl_3_StepInfo_Row_Input">'+'<select class="bl_3_StepInfoOnline_SelectArd" id="listDistrict" name="district" onchange="shop.cart.loadWardToSuggest(this);"></select>'+'</div>'+'<div class="c"></div>'+'</div>'+'<div class="bl_3_StepInfo_Row">'+'<div class="bl_3_StepInfo_Row_Title">Tỉnh thành:</div>'+'<div class="bl_3_StepInfo_Row_Input">'+cityList+'</div>'+'<div class="c"></div>'+'</div></div>';}
return shop.join('<div class="bl_3_BoxGen bl_3_BuyStore">')('<div class="bl_3_BoxHeader">')('<div class="bl_3_Step">')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_step_Active_Border">')('<div class="bl_3_step_Num bl_3_step_Num_Online">1</div>')('<div class="bl_3_step_Title_Online">')('<div>Chọn</div>')('<div><b>Hình thức thanh toán</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_step_Active">')('<div class="bl_3_step_Num bl_3_step_Num_Online">2</div>')('<div class="bl_3_step_Title_Online">')('<div>Nhập</div>')('<div><b>Thông tin cá nhân</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline">')('<div class="bl_3_step_Num bl_3_step_Num_Online">3</div>')('<div class="bl_3_step_Title_Online">')('<div>Chọn</div>')('<div><b>Hình thức nhận hàng</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_stepBuild_Online bl_3_step_BuyOnline bl_3_Nobackground">')('<div class="bl_3_step_Num bl_3_step_Num_Online">4</div>')('<div class="bl_3_step_Title_Online">')('<div>Xác nhận</div>')('<div><b>Đơn hàng</b></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="c"></div>')('</div>')('<a onclick="shop.cart.logRD(shop.cart.conf.cart.cart.id, -5, \'đóng thông tin cá nhân\', 1);shop.hide_overlay_popup(\''+id+'\');" class="bl_3_Btn_Close" href="javascript:void(0)"></a>')('</div>')('<div class="bl_3_BoxBody"><form name="cartRegisterForm" class="reg_cart_form">')('<div class="bl_3_StepInfo_Buid_Update">')('<div class="bl_3_StepInfo">')('<div class="bl_3_StepInfo_buidCus">')('<div class="bl_3_StepInfo_UpdateHeader">')('<div class="bl_3_StepInfo_TitFromUpdate">')('Sửa thông tin hiện tại')('</div>')('<div class="bl_3_StepInfo_Or_title">Hoặc</div>')('<div class="bl_3_StepInfo_TitFromUpdate bl_3_StepInfo_TitFromContact">')('Chọn địa chỉ trong danh bạ')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_StepInfo_Update_Body">')('<div class="bl_3_StepInfo_UpdateAllLeft">')('<div class="bl_3_StepInfo_Update_Border">')('<div id="cError"></div>')('<div class="bl_3_StepInfo_From_Title">Thông tin liên hệ</div>')('<div class="bl_3_StepInfo_From_TextField mTop15">')('<div class="bl_3_StepInfo_Row">')('<div class="bl_3_StepInfo_Row_Title">Họ và tên:</div>')('<div class="bl_3_StepInfo_Row_Input"><input type="text" maxlength="100" id="cart_fullname" name="fullname" value="'+currentAddress.fullname+'"><input type="hidden" id="cart_id" name="duongpho" value="'+currentAddress.id+'"></div>')('<div class="c"></div>')('</div>')('<div class="bl_3_StepInfo_Row">')('<div class="bl_3_StepInfo_Row_Title">Điện thoại:</div>')('<div class="bl_3_StepInfo_Row_Input bl_3_StepInfo_Row_Phone">')('<input type="text" id="cart_tel" maxlength="11" name="phone" value="'+currentAddress.phone+'">')('<span>Dùng liên hệ khi giao hàng</span>')('</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_StepInfo_Row">')('<div class="bl_3_StepInfo_Row_Title">Email:</div>')('<div class="bl_3_StepInfo_Row_Input"><input type="text" maxlength="150" id="cart_email" name="email" value="'+currentAddress.email+'"></div>')('<div class="c"></div>')('</div>')('</div>')(diachi)('</div>')('</div>')('<div class="bl_3_StepInfo_UpdateAllContact">')('<div class="bl_3_StepInfo_Update_Border">')('<div class="bl_3_StepInfo_List_Contact" id="contactList">')('<ul style="padding: 0;">')(IS_CUSTOMER_LOGIN>0?'Đang tải dữ liệu...':shop.join('<div style="text-align:center;margin-top: 45px;font-style: italic;font-size:14px">Bạn phải đăng nhập để sử dụng danh bạ</div>')('<a style="margin-left: 125px; margin-top: 25px;" href="javascript:void(0)" onclick="shop.customer.login.show()" class="v7_blueButton" id="fl">')('<span>')('<span>Đăng nhập</span>')('</span>')('</a>')())('</ul>')('</div>')('</div>')('</div>')('<div class="c"></div>')('</div>')('<div class="c"></div>')('</div>')('<div class="c"></div>')('</div>')('<div align="right" class="mTop25 mRight20">')('<a class="bl_StepInfoOnline_continue" href="javascript:void(0)" onclick="shop.cart.processStepEditShippingInfoV201404();"></a>')('<a onclick="shop.cart.stepOneV201404();" href="javascript:void(0)" class="fr mLeft20 bl_StepInfoOnline_back mRight15"></a>')('<div class="c"></div>')('</div>')('</div>')('</form></div>')('</div>')();};shop.cart.processStepZeroV201404=function(){var khach=shop.cart.conf.user;var city=khach.city;var street=khach.street;var district_id=khach.district_id;if(city=='22'&&shop.cart.conf.cart.payment_id!='coo'){var stop=false;shop.show_loading();$.ajax({async:false,type:"POST",url:"ajax.php?act=customer&code=getStreetId",data:{street:street,district_id:district_id,email:'',phone:''},timeout:4000,cache:true,dataType:"json",success:function(obj){if(city=='22'){if(obj.err==0){if(obj.id==0)stop=true;}else{stop=true;}}},error:function(){stop=true;}});shop.hide_loading();if(stop){alert('Mời quý khách Thay đổi tên Quận - đường phố để Muachung có thể giao hàng được tận nơi');shop.cart.stepEditShippingInfoV201404();return;}}
shop.cart.logRD(shop.cart.conf.cart.cart.id,2,'Nhập thông tin cá nhân',1);shop.cart.stepTwoV201404();};shop.cart.stepOneV201404=function(){if(shop.cart.isFreeDeal()){if(shop.cart.conf.user.type=='guest'){shop.customer.loginMixReg.show();return;}}
var id='pop-CHON-HTTT-v201404';var title='Chọn hình thức thanh toán';var content=shop.cart.theme.stepOneV201404(id,title);var fnRelease=function(){jQuery('#pop-CHON-HTTT-v201404 div.bl_3_StepInfoBuild_PaymentType').click(function(){shop.cart.choosePayment(this,shop.cart)})};shop.cart.logRD(shop.cart.conf.cart.cart.id,1,'chọn hình thức thanh toán',1);var options=shop.cart.createPopupOptions('900px','auto',fnRelease);options.onclose=function(){$('#datmua-alert').hide();};shop.show_overlay_popup(id,title,content,options);};shop.cart.processStepOneV201404=function(){var httt=$('#pop-CHON-HTTT-v201404 .bl_3_StepInfoBuild_Payment_Select').attr('id');if(typeof httt==='undefined'){shop.cart.alert('Bạn vui lòng chọn hình thức thanh toán để tiếp tục');return;}
shop.cart.conf.cart.payment_id=httt;shop.cart.conf.cart.payment=shop.cart.getPaymentNumber(httt);shop.cart.stepEditShippingInfoV201404();};shop.cart.stepTwoV201404=function(){var id='pop-CHON-HTNH-v201404';var title='Chọn hình thức nhận hàng';var content=shop.cart.theme.stepTwoV201404(id,title);var fnRelease=function(){if(jQuery('#'+id+' div.bl_3_StepInfoBuild_PaymentType').length==2){var nhanHang=shop.cart.conf.shipping.codShipType=='product';var nhanPhieu=shop.cart.conf.shipping.codShipType=='coupon';if(!nhanHang){$('#cart_note').hide();}
if(!nhanPhieu){$('#cart_note2').hide();}}
jQuery('#'+id+' div.bl_3_StepInfoBuild_PaymentType').click(function(){jQuery('.bl_3_StepInfoBuild_Payment_Select').removeClass('bl_3_StepInfoBuild_Payment_Select');jQuery(this).addClass('bl_3_StepInfoBuild_Payment_Select');jQuery('input[type="radio"]').each(function(){jQuery(this).attr('checked',false);});jQuery('input[type="radio"]',this).attr('checked',true);if(jQuery('#'+id+' div.bl_3_StepInfoBuild_PaymentType').length==2){var nhanGi=jQuery('input[type="radio"]:first',this).val();if(nhanGi=='product'&&$('#cart_note').length>0){$('#cart_note').show();}else if($('#cart_note').length>0){$('#cart_note').hide();}
if(nhanGi=='coupon'&&$('#cart_note2').length>0){$('#cart_note2').show();}else if($('#cart_note2').length>0){$('#cart_note2').hide();}}});};shop.cart.logRD(shop.cart.conf.cart.cart.id,6,'hình thức nhận hàng',1);var options=shop.cart.createPopupOptions('900px','auto',fnRelease);options.onclose=function(){$('#datmua-alert').hide();};shop.show_overlay_popup(id,title,content,options);};shop.cart.processStepTwoV201404=function(){var nhanGi=$('#pop-CHON-HTNH-v201404 .bl_3_StepInfoBuild_Payment_Select input[name="radio_ship"]').val();if(typeof nhanGi==='undefined'){shop.cart.alert('Vui lòng chọn hình thức nhận hàng');return;}
shop.cart.conf.shipping.codShipType=nhanGi;var ghichu='';shop.cart.conf.shipping.check=false;if(nhanGi=='product'){shop.cart.conf.shipping.check=true;var year=86400*30*12;}
var noteId='cart_note';if(nhanGi=='coupon'){noteId='cart_note2';}
if($('#'+noteId).length>0){ghichu=$('#'+noteId).val();if(typeof(ghichu)!=='undefined'&&ghichu!=''){if(ghichu.match(/[<>]/i)!=null){alert('Kí tự "<" & ">" không hợp lệ, vui lòng nhập lại');$('#'+noteId).focus();return;}}
shop.cookie.set(shop.cLib.guest.cookie_name.note,ghichu,year,'/');shop.cart.conf.user.note=ghichu;}
shop.cart.stepThreeV201404(nhanGi);};shop.cart.stepThreeV201404=function(xacnhan){var id='pop-XACNHAN-v201404';var title='Xác nhận đơn hàng';var content=shop.cart.theme.stepThreeV201404(id,title);var options=shop.cart.createPopupOptions('900px');shop.show_overlay_popup(id,title,content,options);shop.cart.logRD(shop.cart.conf.cart.cart.id,7,'xác nhận đơn hàng',1,'',xacnhan);};shop.cart.processStepThreeV201404=function(){if(shop.cart.conf.cart.cart.type==1&&(shop.cart.conf.cart.payment_id=='mcard'||shop.cart.conf.cart.payment_id=='visa')){}else{var msg=shop.cart.getCanBuyProductMessage();if(msg!=='ok'){alert(msg);return;}}
shop.cart.processStepThree();};shop.cart.stepEditShippingInfoV201404=function(objParams){var referer='';if(typeof objParams!=='undefined'){referer=typeof objParams.referer==='undefined'?'':objParams.referer;}
shop.cart.conf.referer_TTCN=referer;var id='pop-SUATTHT-v201404';var title='Sửa thông tin hiện tại';var book=shop.cAddress.conf.book;var currentAddress=shop.cAddress.conf.currentAddress;var content=shop.cart.theme.stepEditShippingInfoV201404(id,title);var fnRelease=function(){if(shop.cart.conf.cart.cart.type==1&&(shop.cart.conf.cart.payment_id=='mcard'||shop.cart.conf.cart.payment_id=='visa')){}else{shop.district.loadDistrictDropdown(currentAddress.city,'listDistrict',function(def){if(shop.is_exists(shop.district.listDistrictDropdown[def])&&shop.is_exists(shop.district.listDistrictDropdown[def].in_area)){shop.cart.conf.shipping.in_area=shop.district.listDistrictDropdown[def].in_area;}
shop.cart.loadWardToSuggest($('#listDistrict').get(0));},currentAddress.district);}
if(IS_CUSTOMER_LOGIN>0){var html='';if(Object.keys(book).length>0){var textselect='active';for(var i in book){if(currentAddress.id==book[i].id){textselect='active';}else{textselect='';}
if(shop.is_exists(city_list[book[i].city])){var addressFull=[];if(book[i].address!=''){addressFull.push(book[i].address);}
if(book[i].city==29){if(book[i].ward!=''){addressFull.push(book[i].ward);}}else{if(book[i].street!=''){addressFull.push(book[i].street);}}
if(book[i].district!=''){addressFull.push(book[i].district);}
addressFull.push(city_list[book[i].city].title);addressFull=addressFull.join(', ');html+=shop.join('<li title="Chọn địa chỉ" data-contact-id="'+i+'" href="javascript:void(0)" class="bl_3_StepInfo_Build_Contact '+textselect+' event'+book[i].id+'" >')('<div class="bl_3_StepInfo_Contact_Info" for="radio-select-'+book[i].id+'">')('<div class="bl_3_StepInfo_Contact_Row">')('<div class="bl_3_StepInfo_Contact_Info_Content">'+book[i].fullname+' - '+book[i].phone+'</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_StepInfo_Contact_Row">')('<div class="bl_3_StepInfo_Contact_Info_Content">'+book[i].email+'</div>')('<div class="c"></div>')('</div>')('<div class="bl_3_StepInfo_Contact_Row">')('<div class="bl_3_StepInfo_Contact_Info_Content">'+addressFull+'</div>')('<div class="c"></div>')('</div>')('</div>')('<div class="c"></div>')('<a href="javascript:void(0)" class="bl_3_StepInfo_Contact_DeleteRow" title="Xóa địa chỉ" onclick="shop.cAddress.removeBook('+book[i].id+');return false;"></a>')('</li>')();}}
$('#contactList ul').html(html);$('#contactList .bl_3_StepInfo_Build_Contact').click(function(){shop.error.close('#cart_fullname','.reg_cart_form');$('#contactList .bl_3_StepInfo_Build_Contact').removeClass('active');$(this).addClass('active');var contactId=$(this).attr('data-contact-id');var contact=shop.cAddress.conf.book[contactId];$('#cart_fullname').val(contact.fullname);$('#cart_tel').val(contact.phone);$('#cart_email').val(contact.email);$('#cart_id').val(contact.id);$('#cart_street').val(contact.street);$('#cart_address').val(contact.address);$('#cart_city').val(contact.city).trigger('change');setTimeout(function(){$('#listDistrict').val(contact.district_id).trigger('change');setTimeout(function(){$("#cart_newWard").val(contact.ward);},200);},200);$('.bl_StepInfoOnline_continue').focus();});}else{$('#contactList ul').html("Hiện tại bạn chưa có địa chỉ nào trong danh bạ!");}}};shop.cart.logRD(shop.cart.conf.cart.cart.id,5,'thông tin cá nhân',1,shop.cart.conf.cart.payment_id);var options=shop.cart.createPopupOptions('900px','auto',fnRelease);shop.show_overlay_popup(id,title,content,options);if($('#cart_fullname').val==''){$('#cart_fullname').focus();}else if($('#cart_tel').val==''){$('#cart_tel').focus();}else if($('#cart_email').val==''){$('#cart_email').focus();}else if($('#cart_address').val==''){$('#cart_address').focus();}else{$('.bl_StepInfoOnline_continue').focus();}};shop.cart.processStepEditShippingInfoV201404=function(){shop.cart.processStepOne();};shop.cart.createPopupOptions=function(width,height,fnRelease){var options={background:{'background-color':'transparent'},border:{'background-color':'transparent','padding':'0px'},title:{'display':'none'},content:{'padding':'0px','width':'900px','font-size':'12px'},release:function(){if(typeof ieUpdatePlaceholder!=="undefined"){ieUpdatePlaceholder();}}};if(typeof width!=='undefined'){options.content.width=width;}
if(typeof height!=='undefined'&&height!=='auto'){options.content.height=height;}
if(typeof fnRelease==='function'){options.release=fnRelease;}
return options;};shop.cart.getReceiveOptions=function(){var sanpham=shop.cart.conf.cart.cart;var isTicket=shop.cart.conf.cart.cart.type==1;var isHang=shop.cart.conf.cart.cart.type==2;var isPhieuGiay=typeof shop.cart.conf.cart.cart.is_paper!=='undefined'&&shop.cart.conf.cart.cart.is_paper=='1';var httt=shop.cart.conf.cart.payment_id;var supportShip=shop.cart.conf.cart.cart.fee_shipping>=0&&shop.cart.conf.cart.cart.note!='';var isFreeShip=shop.cart.conf.cart.cart.fee_shipping=='0'&&shop.cart.conf.cart.cart.note!='';var isHangKhongShip=isHang&&shop.cart.conf.no_cod;var isNotSupportCOD=shop.cart.conf.dis_cod;var isSupportOnlyCOO=shop.cart.conf.only_coo;var isSupportOnlyGold=shop.cart.conf.gold_only;var detail=[];if(httt=='visa'||httt=='mcard'){if(isTicket){detail.push("MuaChung gửi mã số phiếu qua SMS/Email");}else if(isHangKhongShip){detail.push("MuaChung gửi mã số phiếu qua SMS/Email. Quý khách tự đi lấy hàng");}else if(isPhieuGiay){detail.push("MuaChung giao phiếu giấy tận nơi");}else if(isHang){detail.push("MuaChung giao hàng tận nơi");detail.push("MuaChung gửi mã số phiếu qua SMS/Email. Quý khách tự đi lấy hàng");}}else if(httt=='cod'){if(isTicket){detail.push("MuaChung thu tiền và giao phiếu tận nơi");}else if(isHangKhongShip){detail.push("MuaChung thu tiền tận nơi. Quý khách tự đi lấy hàng");}else if(isPhieuGiay){detail.push("MuaChung thu tiền và giao vé tận nơi");}else if(isHang){detail.push("MuaChung thu tiền và giao hàng tận nơi");}}
alert(detail.join("\n"));};shop.cart.getPaymentNumber=function(pText){var pNum;if(pText=='visa'){pNum=1;}else if(pText=='mcard'){pNum=2;}else if(pText=='cod'){pNum=0;}else if(pText=='go2tour'){pNum=6;}else{pNum=-1;}
return pNum;};shop.cart.checkStopBuyProduct=function(){var canBuyProduct=false;var guest=shop.cAddress.conf.currentAddress;var reasonCannotBuyProduct='Không xác định!';var orderProvince=0;if(!(shop.cart.conf.BUY_TYPE=='vanphong')){orderProvince=shop.cart.conf.user.city;if(shop.cart.conf.cart.cart.province_id>0){if(orderProvince!=shop.cart.conf.cart.cart.province_id){reasonCannotBuyProduct='Rất tiếc. Sản phẩm chỉ bán ở '+city_list[shop.cart.conf.cart.cart.province_id]['title'];}else{canBuyProduct=true;}}else if(shop.cart.conf.cart.cart.province_id==0){var enable_province=[];var enableProvinceNameList=[];var tmp_disable_province=shop.cart.conf.cart.cart.disable_province;var nbDisableProvince=0;for(var pop in tmp_disable_province){nbDisableProvince++;break;}
if(nbDisableProvince>0){for(var tmpKey in city_list){if(city_list[tmpKey]['status']==1){var id=city_list[tmpKey].id;var isDisableProvince=false;for(var pop in tmp_disable_province){if(tmp_disable_province[pop]==id){isDisableProvince=true;break;}}
if(!isDisableProvince){enable_province.push(id);enableProvinceNameList.push(city_list[id].title);}}}
for(tmpKey in enable_province){if(enable_province[tmpKey]==orderProvince){canBuyProduct=true;break;}}
if(!canBuyProduct){reasonCannotBuyProduct='Rất tiếc. Sản phẩm chỉ bán ở '+enableProvinceNameList.join(', ');}}else{canBuyProduct=true;}}else if(shop.cart.conf.cart.cart.province_id<0){reasonCannotBuyProduct='Có lỗi xảy ra';}}else{canBuyProduct=true;}
if(!canBuyProduct){return reasonCannotBuyProduct;}
return'ok';}
shop.cart.getCanBuyProductMessage=function(){var canBuyProduct=false;var guest=shop.cart.conf.user;var district_id=guest.district_id;var city_id=guest.city;if(shop.cart.conf.BUY_TYPE!='vanphong'){if(typeof(guest.address)==='undefined'||guest.address==''||guest.address==null||typeof(guest.street)==='undefined'||guest.street==''||guest.street==null||district_id==0){return'Thông tin địa chỉ chưa chính xác! Quý khách vui lòng nhập lại';}}
var browseCity=shop.cLib.getCity(true,shop.cart.conf.cart.cart.province_id);var dealCity=shop.cLib.getCity(true,shop.cart.conf.cart.cart.province_id);if(shop.cart.conf.cart.payment_id=='cod'&&dealCity!=city_id){return('Sản phẩm này không áp dụng thu tiền tận nơi tại địa chỉ của Quý khách.\nVui lòng chọn hình thức thanh toán khác.');}
if(!(shop.cart.conf.BUY_TYPE=='vanphong')){if(!shop.is_exists(shop.district.listDistrictDropdown[district_id])){shop.district.loadDistrict(city_id,function(){shop.cart.conf.shipping.in_area=shop.district.listDistrictDropdown[district_id].in_area;});}else{shop.cart.conf.shipping.in_area=shop.district.listDistrictDropdown[district_id].in_area;}}
if(!shop.cart.conf.shipping.active&&shop.cart.conf.cart.payment_id=='cod'&&shop.cart.conf.shipping.in_area==0){return("Quận/Huyện Quý khách đang ở không hỗ trợ hình thức giao phiếu tận nơi");}
var reasonCannotBuyProduct='Không xác định!';var orderProvince=0;if(!(shop.cart.conf.BUY_TYPE=='vanphong')){orderProvince=shop.cart.conf.user.city;if(shop.cart.conf.cart.cart.province_id>0){if(orderProvince!=shop.cart.conf.cart.cart.province_id){reasonCannotBuyProduct='Rất tiếc. Sản phẩm chỉ bán ở '+city_list[shop.cart.conf.cart.cart.province_id]['title'];}else{canBuyProduct=true;}}else if(shop.cart.conf.cart.cart.province_id==0){var enable_province=[];var enableProvinceNameList=[];var tmp_disable_province=shop.cart.conf.cart.cart.disable_province;var nbDisableProvince=0;for(var pop in tmp_disable_province){nbDisableProvince++;break;}
if(nbDisableProvince>0){for(var tmpKey in city_list){if(city_list[tmpKey]['status']==1){var id=city_list[tmpKey].id;var isDisableProvince=false;for(var pop in tmp_disable_province){if(tmp_disable_province[pop]==id){isDisableProvince=true;break;}}
if(!isDisableProvince){enable_province.push(id);enableProvinceNameList.push(city_list[id].title);}}}
for(tmpKey in enable_province){if(enable_province[tmpKey]==orderProvince){canBuyProduct=true;break;}}
if(!canBuyProduct){reasonCannotBuyProduct='Rất tiếc. Sản phẩm chỉ bán ở '+enableProvinceNameList.join(', ');}}else{canBuyProduct=true;}}else if(shop.cart.conf.cart.cart.province_id<0){reasonCannotBuyProduct='Có lỗi xảy ra';}}else{canBuyProduct=true;}
if(!canBuyProduct){return reasonCannotBuyProduct;}
if(!(shop.cart.conf.BUY_TYPE=='vanphong')){var orderDistrict=shop.cart.conf.user.district_id;if(shop.cart.conf.cart.payment_id=='cod'){if(shop.district.listDistrictDropdown[orderDistrict].in_area!=1){var districtSupportCOD='';for(i in shop.district.listDistrictDropdown){if(shop.district.listDistrictDropdown[i].in_area==1){districtSupportCOD+=shop.district.listDistrictDropdown[i].title+', ';}}
if(districtSupportCOD.length>0){districtSupportCOD=districtSupportCOD.substr(0,districtSupportCOD.length-2);}
if(districtSupportCOD==''){reasonCannotBuyProduct='Tại tỉnh thành của quý khách, hiện chưa có quận/huyện nào MuaChung hỗ trợ thu tiền tận nơi';}else{reasonCannotBuyProduct='Quận/huyện quý khách vừa chọn không hỗ trợ thu tiền tận nơi. Vui lòng chọn '+districtSupportCOD;}
canBuyProduct=false;}}}
if(!canBuyProduct){return reasonCannotBuyProduct;}
if(shop.cart.conf.cart.payment_id!='coo'){if(orderProvince==14){if(',395,397,399,'.indexOf(','+orderDistrict+',')==-1){reasonCannotBuyProduct='Tại Cần Thơ chỉ hỗ trợ các quận Ninh Kiều, Cái Răng, Bình Thủy';canBuyProduct=false;}}}
if(!canBuyProduct){return reasonCannotBuyProduct;}
if(!(shop.cart.conf.BUY_TYPE=='vanphong')){if(shop.cart.conf.shipping.active){if(shop.district.listDistrictDropdown[orderDistrict].in_area!=1){districtSupportCOD='';for(i in shop.district.listDistrictDropdown){if(shop.district.listDistrictDropdown[i].in_area==1){districtSupportCOD+=shop.district.listDistrictDropdown[i].title+', ';}}
if(districtSupportCOD.length>0){districtSupportCOD=districtSupportCOD.substr(0,districtSupportCOD.length-2);}
if(districtSupportCOD==''){reasonCannotBuyProduct='Tại tỉnh thành của quý khách, hiện chưa có quận/huyện nào MuaChung hỗ trợ giao hàng';}else{reasonCannotBuyProduct='Quận/huyện quý khách vừa chọn không hỗ trợ giao hàng. Vui lòng chọn '+districtSupportCOD;}
canBuyProduct=false;}}}
if(!canBuyProduct){return reasonCannotBuyProduct;}
return'ok';};shop.cart.setSelectedOffice=function(op){shop.cart.conf.SelectedOffice=op;};shop.cart.setBuyType=function(stype){if(typeof stype==='undefined'||stype=='default'||stype=='auto'){shop.cart.conf.BUY_TYPE='v201404';}else if(stype=='vanphong'){shop.cart.conf.BUY_TYPE=stype;}};shop.cart.getDayWillCODDone=function(city){if(shop.cart.conf.ChangeProvinces!=null&&shop.cart.conf.ChangeProvinces.length>0){for(var i in shop.cart.conf.ChangeProvinces){if(shop.cart.conf.ChangeProvinces[i]==city){return'3-6';}}}
if(city==22||city==29)return'1-3';else return'2-7';};shop.cart.showBankList=function(event){if(event==1){jQuery('.bl_3_StepPopUpNganhang').removeClass('hidden');}else{jQuery('.v7_remove_Class').addClass('hidden');}};shop.cart.decreaseQuantity=function(){var vmin=$('option:first',$('#oneItemQuantity')).val();var cur=$('#oneItemQuantityInput').val();cur=parseInt(cur);if(isNaN(cur))cur=0;var vnew=cur-1;if(vnew>=vmin){$('#oneItemQuantityInput').val(vnew);$('#oneItemQuantity').val(vnew);}};shop.cart.increaseQuantity=function(){var vmax=$('option:last',$('#oneItemQuantity')).val();var cur=$('#oneItemQuantityInput').val();cur=parseInt(cur);if(isNaN(cur))cur=0;var vnew=cur+1;if(vnew<=vmax){$('#oneItemQuantityInput').val(vnew);$('#oneItemQuantity').val(vnew);}};shop.cart.alert=function(str){alert(str);};shop.cart.aboutGold=function(e){e.stopPropagation();return true;};shop.cart.requireSelectColorFirst=function(){$('#tipWarningColorText').html('Vui lòng chọn màu trước');$('#tipWarningColor').show();};shop.cart.hideSizeColorCheck=function(){$('#tipWarningColor').hide();$('#tipWarningSize').hide();};shop.cart.isProvinceDeal=function(){return shop.cart.conf.cart.cart.is_province_deal==1;};shop.cart.getPriceProvince=function(pId){var ret=false;var retArr={};var sanpham=shop.cart.conf.cart.cart;if(typeof sanpham.price_city[pId]!=='undefined'){var fee_local=sanpham.price_city[pId].fee_local;var fee_shipping=sanpham.price_city[pId].fee_shipping;retArr.fee_local=parseInt(fee_local);retArr.fee_shipping=parseInt(fee_shipping);ret=true;}else{}
return ret?retArr:ret;};var nhayIndex=0;var timerNhay;function showTipErr(){if(nhayIndex>=4){clearTimeout(timerNhay);nhayIndex=0;return;}
if(nhayIndex%2==0){$("#v8_tipshowErr_store").css("color","#ef532a");$("#v8_tipshowErr").css("color","#ef532a");$("#show-alert-temp .mod-detail").css("color","#ef532a");}else{$("#v8_tipshowErr").css("color","#111");$("#v8_tipshowErr_store").css("color","#111");$("#show-alert-temp .mod-detail").css("color","#111");}
nhayIndex++;timerNhay=setTimeout('showTipErr()',200);}
$(function(){if($('#hiddenMessage').val()!=''){shop.cTheme.systemAlert($('#hiddenMessage').val(),'over');}});