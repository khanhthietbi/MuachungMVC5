jQuery(document).ready(function(){jQuery('#comment-txt').elastic().height("18px");shop.comment.load();});shop.comment={customer:null,version:0,is_log:false,itemID:0,is_alert:false,is_promo:false,load:function(){if(shop.comment.customer.id>0){shop.comment.is_log=true;shop.comment.is_cm=true;shop.comment.theme.customerInfo();}
shop.comment.itemID=parseInt(shop.get_ele('item-id').value);},submit:function(sub,pid,uid,uname,special){if(!shop.comment.is_log){shop.customer.login.show();return;}
var contentID=sub?'sub-comment-txt':'comment-txt';var content=shop.util_trim(shop.get_ele(contentID).value);if(content==''||content=='Viết bình luận'){shop.show_popup_message('Bạn chưa nhập nội dung bình luận',"Thông báo",-1);shop.get_ele(contentID).focus();return;}
if(uname&&special){content='@'+uname+': '+content;}
var is_alert=0;if(shop.comment.is_promo){is_alert=9;}else if(shop.comment.is_alert){is_alert=1;}
shop.ajax_popup("act=comment&code=send","POST",{id:shop.comment.itemID,pid:pid?pid:0,content:encodeURIComponent(content),send_id:shop.comment.customer.id,send_name:shop.comment.customer.fullname,email:shop.comment.customer.email,avatar:shop.comment.customer.avatar,receiver_id:uid?uid:0,receiver_name:uname?uname:'',is_alert:is_alert},function(j){if(j.err==-1){switch(j.msg){case'no_perm':j.msg="Bạn không có quyền bình luận sản phẩm";break;case'invalid_time':j.msg="Bạn vui lòng bình luận sau 10 giây nữa";break;case'stop_time':j.msg="Sản phẩm đã bị khoá bình luận";break;case'happy_self':j.msg="Bạn không thể tự gửi bình luận cho mình";break;case'content_error':j.msg="Bạn chưa nhập nội dung bình luận";break;case'badword_error':j.msg="Nội dung bình luận vi phạm";break;default:j.msg="Lỗi! Không thể thực hiện được thao tác bình luận"}
shop.show_popup_message(j.msg,"Thông báo lỗi",-1);}else{if(j.lock_comment>0||j.is_active_phone<=0){var msg="";if(j.lock_comment>0){msg=(j.lock_note!='')?j.lock_note:'Sản phẩm đang ở chế độ kiểm duyệt';msg='<div align="center" style="color:red">'+msg+'</div>';shop.comment.showWarning(msg);}else{shop.comment.showActivePhoneWarning();}}else{shop.show_popup_message('Bạn đã bình luận thành công!',"Thông báo",1,"300px",'auto',1000);shop.comment.addNewComment(j,sub);}}});},showWarning:function(msg){shop.show_overlay_popup('mc-comment-result','Hệ thống',shop.popupSite('mc-comment-result','Hệ thống',shop.join('<div class="content" style="padding:10px">')('<div><b>Cám ơn bạn đã gửi bình luận!</b></div>')('<div class="mTop10 mBottom5">Tuy nhiên, bình luận cần được <span style="color:red">kiểm duyệt</span> với lý do: </div>')('<div class="f11" style="margin:10px 10px 0;background-color: #FFFEDE;border: 1px solid #FFEDBE;padding: 5px">'+msg+'</div>')('<div class="mTop15">')('<div style="width:60px;margin:0 auto">')('<a id="fr" class="blueButton mLeft10" onclick="shop.hide_overlay_popup(\'mc-comment-result\')" href="javascript:void(0)"><span><span>Đóng</span></span></a>')('<div class="c"></div>')('</div>')('</div>')('</div>')()),{background:{'background-color':'transparent'},title:{'display':'none'},border:{'background-color':'transparent','padding':'0px'},content:{'padding':'0px','width':'450px'}});},showActivePhoneWarning:function(){msg=shop.join('<div>- Số điện thoại của bạn chưa <span style="color:red">được kích hoạt</span>.</div>')('<div class="mTop5">- Để kích hoạt vui lòng nhắn tin theo cú pháp: <b style="color:red;font-size:16px">CHUNG</b> gửi <b style="color:red;font-size:16px">8001</b> (500đ/sms)</div>')();shop.comment.showWarning(msg);},hideFormComment:function(){var p=jQuery('#sub-comment-form').parent(),html='';jQuery('#sub-comment-form').remove();html=shop.util_trim(jQuery(p).html());if(html==null||html==undefined||html==''){jQuery(p).hide();}},addCommentForm:function(sub,obj,id,uid,uname){var parent=jQuery(obj).parent().parent();var html=shop.comment.theme.commentForm(id,uid,uname,sub);jQuery('#sub-comment-form').remove();jQuery(parent).append($(html));jQuery('#sub-comment-txt').focus().elastic().height("20px");return false;},addNewComment:function(j,sub){j.size=sub?32:50;var html=shop.comment.theme.newComment(j,sub);if(sub){jQuery('#sub-comment-form').remove();jQuery('#item'+j.parent_id+' .comment-sub-item').append(html);}else{jQuery('.first-item').removeClass('commentBlockWrite');jQuery('#comment-txt').val('');jQuery('#comment-content #comment-item-main').prepend(html);}},like:function(id,obj){shop.ajax_popup("act=comment&code=vote","POST",{id:id,uid:shop.comment.user.id},function(j){if(j.err==-1){switch(j.msg){case'no_perm':j.msg="Bạn không có quyền thực hiện thao tác này";break;case'happy_self':j.msg="Bạn không thể tự thích bình luận của mình";break;case'voted':j.msg="Bạn đã thích bình luận này rồi";break;default:j.msg="Lỗi! Không thể thực hiện được thao tác bình luận"}
shop.show_popup_message(j.msg,"Thông báo lỗi",-1);}else{var p=jQuery('#vote-point',jQuery(obj).parent());p.html(parseInt(p.html())+1);}});},viewMore:function(itemId){var start=currentStartComment;var num=limitComment;if(start>0&&num>0){shop.ajax_popup("act=comment&code=viewMore","POST",{itemId:itemId,start:start,num:num},function(j){commentContent=j.content;if(j.paging==true){jQuery('#pagingComment').html('<a href="javascript:void(0)" onclick="shop.comment.viewMore('+itemId+')"> Xem thêm các hỏi đáp/bình luận còn lại </a>');}
else{jQuery('#pagingComment').remove();}
var html='';var countCommentAppend=0;for(x in commentContent){if(commentContent[x].id!=undefined){html+=shop.comment.theme.buidComment(commentContent[x]);countCommentAppend++;}}
currentStartComment+=countCommentAppend;if(html!=''){jQuery('#comment-item-viewMore').append(html);}
var totalVisibleItems=$(".comment-item[id*=item]").size()+$(".cm-reply-item").size();if(totalVisibleItems>=totalComments){jQuery('#pagingComment').remove();}
return false;});}},ViewAllSub:function(parentId,totalSub,itemId){if(parentId>0&&totalSub>0){var data={parentId:parentId,totalSub:totalSub,itemId:itemId};shop.ajax_popup("act=comment&code=commentViewAllSub","POST",{parentId:parentId,totalSub:totalSub,itemId:itemId},function(j){jQuery('#viewAllSub'+parentId).remove();var html='';for(x in j){html+=shop.comment.theme.buildSubComment(j[x]);}
if(html!=''){jQuery('#comment-sub-item-'+parentId).html(html);}
return false;});}},theme:{buidComment:function(c){$(".comment-item.sys_comment_item.last-item").removeClass("last-item");var html='';html+=shop.join('<div class="comment-item sys_comment_item" id="item'+c.id+'">')();if(c.status==1){html+=shop.join('<div class="flex">')('<a class="thumb-left">')('<span title="'+c.sender_name+'" class="avatar-name" style="background: url('+c.avatar+')"></span>')('</a>')('<div class="flex-body">')('<div class="rs user-info-r clearfix">')();if(c.is_support){html+=shop.join('<i class="icon-v3 iMC" style="position: relative; top: 4px; margin-right: 4px;"></i>')();}
var buy='';if(c.type!=3){buy='<span class="user-is-buy-this '+((c.is_buy_this==2||c.is_buy_this==1)?'is-buy':'is-not')+'">'+((c.is_buy_this==1)?'Đã mua sản phẩm này':((c.is_buy_this==2)?'Đã đăng ký mua sản phẩm này':'Chưa mua sản phẩm này'))+'</span><span class="sep-usercm"> | </span>';}
html+=shop.join('<b>'+c.sender_name+'</b> <span class="fs-12 fc-gray-d">- '+c.created+'</span>')('</div>')('<div class="rs user-info-r clearfix">')(buy)('<span class="user-reg-date">Đăng ký ngày: '+c.reg_date+'</span>')('<span class="sep-usercm"> | </span>')('<span class="user-count-bought-item">Đã mua trên Muachung: <span>'+c.number_buy+'</span></span>')('</div>')('</div>')('</div>')();html+=shop.join('<div class="wrap-comment-info">')('<div class="rs cm-content"><span>'+c.content+'</span><div class="clearfix"></div>')();html+=shop.join('<div class="reply-link"><span onclick="shop.comment.addCommentForm(false, this, '+c.id+', '+c.sender_id+', \''+c.sender_name+'\')" title="Trả lời bình luận này">Trả lời</span></div>')();html+=shop.join('</div>')('</div>')();}else{html+=shop.join('<div class="wrap-comment-info"><div class="rs cm-content"><span>Bị ẩn vì bình luận không lịch sự</span></div></div>')();}
if(c.num_child>0){html+=shop.join('<!-- DS COMMENT CON -->')('<div class="comment-sub-item'+((!c.sub)?' hidden':'')+'" id="comment-sub-item-'+c.id+'">')();var visibleSubItems=0;for(s in c.sub){html+=shop.comment.theme.buildSubComment(c.sub[s])+'</div>';visibleSubItems++;}
var remainSubItems=c.num_child-visibleSubItems;if(remainSubItems>0){html+=shop.join('<div id="viewAllSub'+c.id+'" class="fr userCommentReplyContent"><a href="javascript:void(0)" onclick="shop.comment.ViewAllSub('+c.id+','+remainSubItems+','+c.item_id+')">Xem tất cả '+c.num_child+' bình luận</a></div>')();}
html+=shop.join('<div class="c"></div>')('</div>')();}
html+=shop.join('</div>')();return html;},buildSubComment:function(sub){var html='';if(sub.status==1){html+=shop.join('<div class="">')('<div class="cm-reply-item">')('<div class="top-mc-reply">')();if(sub.is_support==true){html+=shop.join('<i class="icon-v3 iMC"></i> ')();}
html+=shop.join('<span class="reply-mc-cskh">'+sub.sender_name+'</span> <span class="reply-cm-time">- '+sub.created+'</span>')('</div>')('<div class="content-reply-item">'+sub.content+'</div>')('<div class="reply-link"><span onclick="shop.comment.addCommentForm(true,this, '+sub.parent_id+', '+sub.sender_id+', \''+sub.sender_name+'\')" title="Trả lời bình luận này">Trả lời</span></div>')('</div>')();}else{if(sub.sender_name!=undefined){html+=shop.join('<div class="comment-item sys_comment_item">')('<div class="flex">')('<a class="thumb-left">')('<span class="avatar-name" title="'+sub.sender_name+'" style="background:url('+sub.avatar+');"></span>')('</a>')('<div class="flex-body">')('<div class="rs user-info-r clearfix">')();if(sub.is_support==true){html+=shop.join('<i class="icon-v3 iMC"></i>')();}
html+=shop.join('<b>'+sub.sender_name+'</b> <span class="fs-12 fc-gray-d">'+sub.created+'</span>')('</div>')('<div class="rs user-info-r clearfix">')('<span class="user-is-buy-this '+((sub.is_buy_this==2||sub.is_buy_this==1)?'is-buy':'is-not')+'">'+((sub.is_buy_this==1)?'Đã mua sản phẩm này':((sub.is_buy_this==2)?'Đã đăng ký mua sản phẩm này':'Chưa mua sản phẩm này'))+'</span>')('<span class="sep-usercm"> | </span>')('<span class="user-reg-date">Đăng ký ngày: '+sub.reg_date+'</span>')('<span class="sep-usercm"> | </span>')('<span class="user-count-bought-item">Đã mua trên Muachung: <span>'+sub.number_buy+'</span></span>')('</div>')('</div>')('</div>')('<div class="wrap-comment-info">')('<div class="rs cm-content"><span>'+sub.content+'</span></div>')();html+=shop.join('<div class="reply-link" onclick="shop.comment.addCommentForm(true,this, '+sub.parent_id+', '+sub.sender_id+', \''+sub.sender_name+'\')" title="Trả lời bình luận này">Trả lời</span></p>')('<div class="clearfix" style="margin-bottom: 5px; height: 0px;">&nbsp;</div>')();html+=shop.join('</div>')();}else{html+=shop.join('<div class="comment-item sys_comment_item" style="display: none">')('<div class="flex">')('<div class="flex-body">')('<div class="rs user-info-r clearfix">')('</div>')('<div class="rs user-info-r clearfix">')('</div>')('</div>')('</div>')('<div class="wrap-comment-info"></div>')();html+=shop.join('</div>')();}}
html+=shop.join('<div class="c"></div>')('<div class="comment-sub-append"></div>')('</div>')();return html;},customerInfo:function(){var html='<img src="'+shop.comment.customer.avatar+'" border="0" width="45" /></a>';jQuery('#login-name').html('<b>'+shop.comment.customer.fullname+'</b>');jQuery('#comment-customer .avatar div').css({position:'relative'}).html(html).hover(function(){shop.showTools(true,this);},function(){shop.showTools(false,this);});jQuery('#comment-customer .nick').html('<b>'+shop.comment.customer.fullname+'</b>');},commentForm:function(id,uid,uname,sub){return shop.join('<div id="sub-comment-form" class="form form-post-cm">')('<div class="wrap-comment-info clearfix">')('<input type="button" class="btn btn-s-md btn-blue btn-submit-cm" tabindex="25" value="Gửi" onclick="shop.comment.submit(true,'+id+','+uid+',\''+uname+'\','+sub+')">')('<label class="lbl-wrap-txt-cm" for="txt_question">')('<textarea id="sub-comment-txt" class="txt" tabindex="24" placeholder="Nhập câu hỏi tại đây..."></textarea>')('</label>')('</div>')('<div class="comment-sub-append"></div>')('</div>')();},newComment:function(j,sub){sub=sub?true:false;if(sub){return shop.join('<div class="cm-reply-item">')('<div class="top-mc-reply">')('<span class="reply-mc-cskh">'+shop.comment.customer.fullname+'</span>')('</div>')('<div class="content-reply-item">')('<span>'+j.content+'</span>')('</div>')('<div class="clearfix"></div>')('<div class="reply-link"><span onclick="shop.comment.addCommentForm(true,this, '+j.parent_id+', '+j.sender_id+', \''+j.sender_name+'\')" title="Trả lời bình luận này">Trả lời</span></div>')();}
else{var buy='';if(j.type!=3){buy='<span class="user-is-buy-this '+((j.is_buy_this==2||j.is_buy_this==1)?'is-buy':'is-not')+'">'+((j.is_buy_this==1)?'Đã mua sản phẩm này':((j.is_buy_this==2)?'Đã đăng ký mua sản phẩm này':'Chưa mua sản phẩm này'))+'</span><span class="sep-usercm"> | </span>';}
return shop.join('<div class="comment-item sys_comment_item">')('<div class="flex">')('<a class="thumb-left">')('<span class="avatar-name" title="'+shop.comment.customer.fullname+'" style="background:url('+shop.comment.customer.avatar+');"></span>')('</a>')('<div class="flex-body">')('<div class="rs user-info-r clearfix">')('<b>'+shop.comment.customer.fullname+'</b> <span class="fs-12 fc-gray-d">- vài giây trước</span>')('</div>')('<div class="rs user-info-r clearfix">')(buy)('<span class="user-reg-date">Đăng ký ngày: '+j.reg_date+'</span>')('<span class="sep-usercm"> | </span>')('<span class="user-count-bought-item">Đã mua trên Muachung: <span>'+j.number_buy+'</span></span>')('</div>')('</div>')('</div>')('<div class="wrap-comment-info">')('<div class="rs cm-content">')('<span>'+j.content+'</span>')('</div>')('<div class="clearfix"></div>')('<div class="reply-link"><span onclick="shop.comment.addCommentForm(true,this, '+j.parent_id+', '+j.sender_id+', \''+j.sender_name+'\')" title="Trả lời bình luận này">Trả lời</span></div>')();}}}};shop.smiley={emo:[':)',':(',';)',':D',';;)',';))',':-/',':x',':\">',':P',':-*','=((',':-O','X(',':>','B-)',':-S','#:-S','>:)',':((',':))',':|','/:)','=))','O:-)',':-B','=;','I-)','8-|','L-)',':-&',':-$','[-(',':O)','8-}','<:-P','(:|','=P~',':-?','#-o','=D>',':-SS','@-)',':^o',':-w',':-<','>:P','<):)','^#(^',':)]',':-c','~X(',':-h',':-t','8->','X_X',':!!','\\m/',':-q',':-bd','>:D<'],txtCtrl:'',init:function(){var emoticons='',arr_emo=shop.smiley.emo;for(i=0;i<arr_emo.length;i++){emoticons+=shop.join("<a href='javascript:void(0);' onclick ='shop.smiley.add("+i+")' alt='"+arr_emo[i]+"' title='"+arr_emo[i]+"' class='emoticons'>")("<img alt='"+arr_emo[i]+"' title='"+arr_emo[i]+"' src='"+BASE_URL+"style/images/smiley/"+(i+1)+".gif' border='0' />")('</a>')();}
jQuery("body").append("<div id='smiley_div' class='smiley_emotion'>"+emoticons+"</div>");},load:function(event,obj,addID){if(shop.get_ele('smiley_div')==undefined){var o=shop.smiley.getXY(event,obj);shop.smiley.txtCtrl=addID;shop.smiley.init();jQuery("#smiley_div").css({left:(o.x-400)+"px",top:(o.y+38)+"px"}).fadeIn('fast');}
else{jQuery("#smiley_div").fadeOut('fast',function(){jQuery("#smiley_div").remove();});}},getXY:function(e,obj){e=window.event||e;var t=20,h=234,w=394,ox=e.pageX+t,oy=e.pageY-t,max_x=jQuery(document).width();if(self.innerHeight){max_y=window.pageYOffset+jQuery(window).height();}else if(document.documentElement&&document.documentElement.clientHeight){max_y=document.documentElement.scrollTop+jQuery(window).height();}else if(document.body){max_y=document.body.scrollTop+jQuery(window).height();}
((e.pageX+w)>=max_x)&&(ox=e.pageX-w-t);((e.pageY+h)>max_y)&&(oy=e.pageY-h);return{x:ox,y:oy};},add:function(id){var obj=jQuery(shop.smiley.txtCtrl),val=obj.val();(val=='Viết bình luận')&&(val='');(val!='')&&(val+=' ');obj.val(val+unescape(shop.smiley.emo[id]+' ')).focus();jQuery("#smiley_div").fadeOut('fast',function(){jQuery("#smiley_div").remove();});}};shop.showTools=function(check,obj){var tmp='show_tools';if(!shop.is_exists(shop._store.variable[tmp])){shop._store.variable[tmp]={over:false,out:false}}
if(check){if(shop._store.variable[tmp].over==false){shop._store.variable[tmp].over=true;shop._store.variable[tmp].out=false;setTimeout(function(){if(!shop._store.variable[tmp].out){jQuery('.tools',obj).fadeTo("fast",0.7);}},50);}}else{if(shop._store.variable[tmp].out==false){shop._store.variable[tmp].out=true;shop._store.variable[tmp].over=false;setTimeout(function(){if(!shop._store.variable[tmp].over){jQuery('.tools',obj).fadeTo("fast",0);}},50);}}};